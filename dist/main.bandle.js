(()=>{"use strict";class e{constructor(e){this.root=e,this.root.dataset.view=this.constructor.name,this.root.hidden=!0}isActive(){return!this.root.hidden}hide(){this.root.hidden=!0}show(){this.root.hidden=!1,this.render()}render(){console.log(`[PAGE ${this.constructor.name}]\trender`),this.root.innerHTML=""}}class t{constructor(t){console.log(`[PAGE ${this.constructor.name}]\tinit`),this.view=new e(t)}isActive(){return console.log(`[PAGE ${this.constructor.name}]\tisActive`),this.view.isActive()}hide(){console.log(`[PAGE ${this.constructor.name}]\thide`),this.view.hide()}show(){console.log(`[PAGE ${this.constructor.name}]\tshow`),this.view.show()}redirect(e){return""}}class n{render(){return document.createElement("div")}}class r{constructor(){this.root=document.createElement("div"),this.view=new n,this.unsubscribes=[],console.log(`[VIEW ${this.constructor.name}]\tinit`)}render(){return console.log(`[VIEW ${this.constructor.name}]\trender`),document.createElement("div")}destroy(){console.log(`[VIEW  ${this.constructor.name}]\tdestroy`),this.view=null,this.unsubscribes.forEach((e=>{"function"==typeof e&&e()}))}}var i=/["&<>]/;class o extends n{render(){const e=document.createElement("div");return e.innerHTML='<div class="header"><a class="header__title-block" href="/"><div class="header__title" data-router="ignore">SaberNews</div></a><div class="header__content"><div class="header__nav-items"><a class="header__nav-item" data-test="test1">Популярное</a><a class="header__nav-item" data-test="test2">Новое</a><a class="header__nav-item">Подписки</a><a class="header__nav-item">Мероприятия</a><a class="header__nav-item">Группы</a></div><div class="search"><div class="search__row search__row_close" style="transition: all 0.5s;"><input class="search__input" type="text" placeholder="Найти"/><div class="search__row_group_dropdown"><input class="search__row_group_bar" type="text" placeholder="где?"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var o=typeof t;return"object"!==o&&"function"!==o||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=i.exec(t);if(!n)return e;var r,o,s,a="";for(r=n.index,o=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}o!==r&&(a+=t.substring(o,r)),o=r+1,a+=s}return o!==r?a+t.substring(o,r):a}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("readonly",!0,!0,!1)+'/><div class="search__row_group_dropdown-content"><div class="search__row_group_dropdown-item" data-search="articles">Статьи</div><div class="search__row_group_dropdown-item" data-search="author">Пользователи</div><div class="search__row_group_dropdown-item" data-search="tags">Теги</div></div></div><div class="search__row_btn"></div></div><button class="search__button search-icon"></button></div></div></div>',e.firstChild}}const s="LOGIN",a="LOGOUT",c="CHANGE_PAGE",l="CHANGE_DOC_TITLE",d="MODAL_OPEN",u="MODAL_CLOSE",p={ASK_NEW_CARDS:"ASK_NEW_CARDS",SAVE_NEW_CARDS:"SAVE_NEW_CARDS",CLEAR_CARDS:"CLEAR_CARDS",FORBID_CARDS_UPLOADING:"FORBID_CARDS_UPLOADING",ALLOW_CARDS_UPLOADING:"ALLOW_CARDS_UPLOADING",SET_LOADING_FLAG:"SET_LOADING_FLAG",UNSET_LOADING_FLAG:"UNSET_LOADING_FLAG"},g="SAVE_NEW_USER_ARTICLES",h="CLEAR_USER_ARTICLES",m="FORBID_USER_ARTICLES_UPLOADING",v="ALLOW_USER_ARTICLES_UPLOADING",f="SET_USER_ARTICLES_LOADING",_="SET_USER_INFO",y="SET_USER_LOADING",b="SAVE_NEW_CATEGORY_ARTICLES",w="CLEAR_CATEGORY_ARTICLES",S="FORBID_CATEGORY_ARTICLES_UPLOADING",E="ALLOW_CATEGORY_ARTICLES_UPLOADING",L="SET_CATEGORY_ARTICLES_LOADING",C="UNSET_CATEGORY_ARTICLES_LOADING",A="SELECT_CATEGORY",x="SAVE_NEW_CARDS_SEARCH",k="CLEAR_CARDS_SEARCH",T="FORBID_CARDS_UPLOADING_SEARCH",O="ALLOW_CARDS_UPLOADING_SEARCH",I="SET_LOADING_FLAG_SEARCH",R="SET_SEARCH_GROUP_SEARCH",N="SET_SEARCH_VALUE_SEARCH",q="ASK_NEW_COMMENTS_STREAM",P="SAVE_NEW_COMMENTS_STREAM",D="CLEAR_COMMENTS_STREAM",$="SET_UNAVAILABLE",M="SET_AVAILABLE",U="EDITOR_APPEND_TAG",F="EDITOR_REMOVE_TAG",H="EDITOR_EDIT_EXISTING_ARTICLE",B="EDITOR_CREATE_ARTICLE",J="EDITOR_SAVE_ARTICLE",G="EDITOR_PUBLISH_ARTICLE",j="EDITOR_CLEAR_ARTICLE",W="EDITOR_DELETE_ARTICLE",V="EDITOR_SAVE_PREVIEW",z="EDITOR_SAVE_CATEGORY",Y="READER_SAVE_ARTICLE",Z="READER_OPEN_ARTICLE",K="READER_SET_ARTICLE_LOADING",X="READER_SAVE_ARTICLE_COMMENTS",Q="READER_EDIT_ARTICLE_COMMENT",ee="READER_ADD_COMMENT_ANSWER",te="READER_ADD_NEW_COMMENT",ne="REDIRECT";const re={isAuthenticated:!1,login:"",avatarUrl:"",firstName:"UNAUTHORIZED",lastName:"UNAUTHORIZED",email:"UNAUTHORIZED",score:0},ie={page:"main",docTitle:"SaberProject"},oe={isAuthenticated:!1,isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1},se={user:{login:""},isLoading:!1,idLastLoaded:"",cards:[],isEndFound:!1},ae={currentCategory:"",isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1,tags:{}},ce={showRegister:!0},le={isAvailable:!0},de={currentId:0},ue={currentId:0},pe={},ge={comments:[]},he={isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1,value:"",group:"articles",description:"Статьи"},me=function e(t,n,...r){console.log("[STORE] createStore: ",r.map((e=>e.name)));let i=t(n,{type:"__INIT__"});const o={};return 0!==r.length?function(...e){return function(t){return function(n,r){const i=t(n,r);let o=()=>{console.error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")};const s={getState:i.getState,dispatch:(e,...t)=>o(e,...t)},a=e.map((e=>e(s)));return o=function(...e){return 0===e.length?arg:1===e.length?e[0]:e.reduce(((e,t)=>e(t(...args))))}(...a)(i.dispatch),{...i,dispatch:o}}}}(...r)(e)(t,n):{dispatch(e){i=t(i,e),o[e.type]=o[e.type]||[],o[e.type].forEach((t=>{console.log("subscribe trigger on",e.type),t(e.payload)}))},subscribe:(e,t)=>(console.log("create subscription to",e),o[e]=o[e]||[],o[e].push(t),function(){o[e].splice(o[e].indexOf(t))}),getState:()=>i}}(function(e){for(const t in e)"function"!=typeof e[t]&&(console.warn(`Reducers Combiner: ${t} is not a function.\n          It will not be called. It is a ${typeof e[t]}.`),delete e[t.name]);return function(t,n){t||(t={});for(const r in e){const i=e[r](t[r],n);if(JSON.stringify(i)!==JSON.stringify(t[r])){let e=t[r],o=i;if("mainPage"!==r&&"profilePage"!==r&&"search"!==r&&"categoryPage"!==r||(e={},Object.assign(e,t[r]),delete e.cards,o={},Object.assign(o,i),delete o.cards),"editor"===r){e={};for(const n in t[r])e[n]={},Object.assign(e[n],t[r][n]),e[n].img&&""!==e[n].img&&(e[n].img="data:image/png;base64,(контент картинки)");o={};for(const e in i)o[e]={},Object.assign(o[e],i[e]),o[e].img&&""!==o[e].img&&(o[e].img="data:image/png;base64,(контент картинки)")}if("reader"===r&&"__INIT__"!==n.type){e=JSON.parse(JSON.stringify(t[r])),o=JSON.parse(JSON.stringify(i));for(const t in e)"object"==typeof e[t]&&(e[t].text="текст вырезан в combinereducers");for(const t in o)"object"==typeof e[t]&&(o[t].text="текст вырезан в combinereducers")}console.log(`${r} | action: ${n.type}`,"\n\t| prev state:\n",{...e},"\n\t| new state:\n",{...o}),t[r]=i}}return t}}({router:function(e=pe,t){return t.type===ne?{...e}:e},authorization:function(e=re,t){switch(t.type){case s:return""===t.payload.login?(console.warn("Trying to set an empty login. LOGIN action ignored"),e):{...e,...t.payload,isAuthenticated:!0};case a:return re}return e},page:function(e=ie,t){switch(t.type){case c:return document.title=t.payload.docTitle,{...e,page:t.payload.page,docTitle:t.payload.docTitle};case l:return document.title=t.payload.docTitle,{...e,docTitle:t.payload.docTitle}}return e},mainPage:function(e=oe,t){switch(t.type){case p.SET_LOADING_FLAG:return{...e,isLoading:!0};case p.FORBID_CARDS_UPLOADING:return{...e,isEndFound:!0};case p.ALLOW_CARDS_UPLOADING:return{...e,isEndFound:!1};case p.SAVE_NEW_CARDS:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case p.CLEAR_CARDS:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1}}return e},profilePage:function(e=se,t){switch(t.type){case f:return{...e,isLoading:!0};case m:return{...e,isEndFound:!0};case v:return{...e,isEndFound:!1};case g:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case h:return{...e,cards:[],isLoading:!1,idLastLoaded:"",isEndFound:!1};case _:case y:return{...e,user:t.payload,isLoading:!1,idLastLoaded:"",cards:[],isEndFound:!1}}return e},categoryPage:function(e=ae,t){switch(t.type){case L:return{...e,isLoading:!0};case C:return{...e,isLoading:!1};case S:return{...e,isEndFound:!0};case E:return{...e,isEndFound:!1};case b:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case w:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1};case A:return{...e,currentCategory:t.payload}}return e},search:function(e=he,t){switch(t.type){case R:return{...e,group:t.payload.group,description:t.payload.description};case I:return{...e,isLoading:!0};case N:return{...e,value:t.payload};case T:return{...e,isEndFound:!0};case O:return{...e,isEndFound:!1};case x:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case k:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1}}return e},signupForm:function(e=ce,t){return"SWITCH_FORM_TYPE"===t.type?{...e,showRegister:t.payload}:e},api:function(e=le,t){switch(t.type){case M:return{...e,isAvailable:!0};case $:return{...e,isAvailable:!1}}return e},editor:function(e=de,t){switch(t.type){case H:return{...e,[t.payload.id]:{title:t.payload.title,text:t.payload.text,tags:t.payload.tags,category:t.payload.category,img:t.payload.img},currentId:t.payload.id};case j:return{...e,[t.payload.id]:{title:"",text:"",tags:[],category:"",img:""}};case W:const n={};return Object.assign(n,e),delete n[t.payload.id],n.currentId=0,n;case B:const r=Object.assign({},e);return 0 in r||(r[0]={title:"",text:"",tags:[],category:"",img:""}),r.currentId=0,r;case J:let i={};return t.payload.id in e?Object.assign(i,e[t.payload.id]):i={title:"",text:"",tags:[],category:"",img:""},i={...i,...t.payload},delete i.id,{...e,[t.payload.id]:i};case G:return{...e,[t.payload.id]:Object.assign({},e[0]),0:{title:"",text:"",tags:[],category:"",img:""},currentId:0};case U:const o=Object.assign({},e[e.currentId]);return o.tags.push(t.payload),{...e,[e.currentId]:o};case F:const s=Object.assign({},e[e.currentId]);return s.tags=s.tags.filter((e=>e!=t.payload)),{...e,[e.currentId]:s};case V:const a={...e[e.currentId]};return a.img=t.payload,{...e,[e.currentId]:a};case z:const c={...e[e.currentId]};return c.category=t.payload,{...e,[e.currentId]:c}}return e},reader:function(e=ue,t){switch(t.type){case Y:return{...e,[t.payload.id]:{...t.payload,commentsContent:[]}};case K:return t.payload.id in e&&"Загрузка"!==e[t.payload.id].title?e:{...e,[t.payload.id]:{title:"Загрузка",tags:[],datetime:"",category:"",author:{login:"",avatarUrl:"",firstName:"",lastName:"Загрузка",score:0},likes:0,comments:0,commentsContent:[],previewUrl:"",...t.payload,text:"Загрузка..."}};case Z:return{...e,currentId:t.payload};case te:const n=[...e[e.currentId].commentsContent];return n.push(t.payload),{...e,[e.currentId]:{...e[e.currentId],commentsContent:n}};case X:return t.payload.id in e?{...e,[t.payload.id]:{...e[t.payload.id],commentsContent:t.payload.comments}}:e;case ee:const r=e[e.currentId].commentsContent;if(0===t.payload.parentId)return{...e,[e.currentId]:{...[e.currentId],commentsContent:[...r,t.payload.comment]}};{const n=r.findIndex((({id:e})=>e===t.payload.parentId));if(-1!==n){const i=JSON.parse(JSON.stringify(r));return i[n].answers.push(t.payload.answer),{...e,[e.currentId]:{...e[e.currentId],commentsContent:i}}}console.warn("коментарий с таким айди",t.payload.parentId,"не найден")}return e;case Q:let i=-1;const o=e[e.currentId].commentsContent;let s=o.findIndex((({id:e})=>e===t.payload.id));if(-1===s&&(s=o.findIndex((({answers:e},n)=>{i=e.findIndex((({id:e})=>e===t.payload.id)),-1!==i&&(s=n)}))),-1!==s){console.warn("коментарий с айди найден",{commentsIdx:s,answerIdx:i});const n=JSON.parse(JSON.stringify(e[e.currentId].commentsContent));return-1!==i?n[s][i].text=t.payload.text:n[s].text=t.payload.text,{...e,[e.currentId]:{...[e.currentId],commentsContent:n}}}return console.warn("коментарий с таким айди",t.payload.id,"не найден"),e}return e},stream:function(e=ge,t){switch(t.type){case P:const n=t.payload;return 0===n.length?e:{...e,comments:e.comments.concat(n)};case D:return{...e,comments:[]};case q:return e}return e}}),{},(function({getState:e,dispatch:t}){return function(n){return function(r){return"function"==typeof r?r(t,e):n(r)}}}));function ve(e){return new Date(e).toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",timezone:"Russia/Moscow"})}function fe(e){return new Promise(((t,n)=>{"string"!=typeof e&&n(new Error("Передай мне строку, а не url: "+e)),""===e?n(new Error("Картинку не отправляем")):t()})).then((()=>fetch(e))).then((e=>e.blob()))}function _e(e){return new Promise((t=>{const n=new FileReader;n.onload=e=>t(e.target.result),n.readAsDataURL(e)}))}function ye(e){const t=document.createElement("a"),n=document.querySelector("#root");t.id="clickSimulator",t.href=e,n.appendChild(t),t.click(),n.removeChild(t)}function be(){for(;;){const e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),n=Math.floor(255*Math.random()),r=(299*e+587*t+114*n)/1e3;if(r<155&&r>40&&e>64&&t>40&&n>64)return"#"+e.toString(16)+t.toString(16)+n.toString(16)}}function we(){return document.documentElement.clientHeight}const Se={createInput:function(e,t,n,r=null,i=!1,o=null){const s=document.createElement("input");return s.type=e,s.name=n,s.id="input-"+n,s.placeholder=t,s.required=i,null!=r&&(s.title=r),null!=o&&(s.pattern=o),s},createLabel:function(e,t){const n=document.createElement("label");return n.textContent=t,n.htmlFor=e,n},createInputRow:function(e){const t=document.createElement("div");t.className="form-row";const n=document.createElement("div");n.className="tooltip",n.title=e.title;const r=document.createElement("div");return r.className="tooltip-sign",r.textContent="?","null"===e.title&&(n.style.visibility="hidden"),t.appendChild(e),n.appendChild(r),t.appendChild(n),t},getPageHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},getUserWindowWidth:function(){return document.documentElement.clientWidth},getUserWindowHeight:we,getCurrentPageYPos:function(){return window.pageYOffset},redirect:ye,htmlToString:function(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML},genRanHexColor:be,getFileBrowserStorageUrl:_e,recoverBlobWithUrl:fe,getRusDateTime:ve},Ee="http://localhost:8081/api/v1",Le={post:"POST",get:"GET"};function Ce(e){const t=Ee+(e.url||"/"),n={body:JSON.stringify(e.body),mode:"cors",credentials:"include",headers:{"Content-Type":"application/json"},method:e.method};console.log("ajax request",{url:t},": "+JSON.stringify(n));let r=0;return fetch(t,n).then((e=>(r=e.status,e.json()))).then((e=>(console.log("ajax resolved "+r+": "),console.log(e),{status:r,response:e}))).catch((e=>{console.warn(e)}))}const Ae={ok:200,notFound:404,badRequest:400,invalidSession:424},xe=e=>Ce({method:Le.get,...e}),ke=e=>Ce({method:Le.post,...e}),Te=function(e){const t=Ee+(e.url||"/"),n=new FormData;n.append("img",e.body);const r={body:n,mode:"cors",credentials:"include",method:Le.post};console.log("ajax file post request",{url:t},": "+JSON.stringify(r));let i=0;return fetch(t,r).then((e=>(i=e.status,e.json()))).then((e=>(console.log("ajax resolved "+i+": "),console.log(e),{status:i,response:e}))).catch((e=>{console.warn(e)}))},Oe=Ee;function Ie(e){"avatarUrl"in e&&!e.avatarUrl.startsWith(Oe)&&(e.avatarUrl=Oe+"/img/"+e.avatarUrl),"previewUrl"in e&&!e.previewUrl.startsWith(Oe)&&(e.previewUrl=Oe+"/img/"+e.previewUrl)}function Re(e){return Date.parse(e.replaceAll("/","-").replace(" ","T")+":00")}function Ne(e,t=null){const n={...e,datetimeMS:Re(e.dateTime),datetime:ve(Re(e.dateTime))};return delete n.dateTime,Ie(n.author),t&&(n.author=t),n}const qe=function(e,t){return t.forEach((e=>{!1 in e&&Ie(e.author),Ie(e)})),{type:x,payload:{idLastLoaded:e,cards:t}}},Pe=function(){return{type:k}},De=function(){return{type:I}},$e=function(){return{type:"UNSET_LOADING_FLAG_SEARCH"}},Me=function(){return{type:T}},Ue=function(){return{type:O}},Fe=function(e,t=""){return{type:R,payload:{group:e,description:t}}},He=function(e){return{type:N,payload:e}};class Be extends r{constructor(){super(),this.view=new o,this.isBlur=!1,this.isOpen=!1}render(){super.render(),this.root=this.view.render();const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".search__input"),n=this.root.querySelector(".search__row"),r=this.root.querySelector(".search__row_group_dropdown");r.querySelector(".search__row_group_dropdown-content").childNodes.forEach((e=>e.addEventListener("click",(e=>{r.querySelector(".search__row_group_bar").value=e.target.textContent,me.dispatch(Fe(e.target.dataset.search,e.target.textContent)),t.focus()})))),r.addEventListener("mouseover",(e=>t.removeEventListener("focusout",i))),r.addEventListener("mouseout",(e=>t.addEventListener("focusout",i))),e.addEventListener("click",(e=>{e.preventDefault(),this.isBlur||this.isOpen||this.openSearchField()})),t.addEventListener("keydown",(({keyCode:e,target:n})=>{13===e&&(me.dispatch(He(t.value)),t.blur(),ye("/search"),this.root.querySelector(".search__row_group_bar").value=me.getState().search.description)}));const i=e=>{console.log("{Header} searchField lost focus"),this.closeSearchField(),this.isBlur=!0;const t=1e3*parseFloat(n.style.transitionDuration);setTimeout((()=>this.isBlur=!1),t)};return t.addEventListener("focusout",i),this.root}closeSearchField(){const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".header__nav-items"),n=this.root.querySelector(".search__row");console.log("{Header} searchField close"),t.style.pointerEvents="all",e.classList.add("search-icon"),e.classList.remove("cross-icon"),n.classList.add("search__row_close"),n.classList.remove("search__row_open"),this.isOpen=!1}openSearchField(){const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".header__nav-items"),n=this.root.querySelector(".search__row"),r=this.root.querySelector(".search__input");console.log("{Header} searchField open"),t.style.pointerEvents="none",e.classList.remove("search-icon"),e.classList.add("cross-icon"),n.classList.remove("search__row_close"),n.classList.add("search__row_open"),r.focus(),r.select(),this.isOpen=!0}}function Je(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Ge(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Ge(e){var t=""+e,n=je.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var je=/["&<>]/;function We(e){var t,n="",r=e||{};return function(e,r,i,o,s){n=n+'<div class="sidebar"><div class="sidebar__nav-links"><a class="sidebar__nav-item" href="/editor">Добавить  <br/>запись</a><div class="sidebar__nav-buttons" id="sidebarTopBlockContent">'+(null==(t=s)?"":t)+'</div></div><div class="sidebar__content"><div class="sidebar__categories"><div class="sidebar__categories-title sidebar__item">Мнения</div><div class="sidebar__streams">'+(null==(t=o)?"":t)+'</div><div class="sidebar__categories-title sidebar__item"><a href="/categories">Категории</a></div>',e.isArray(r)&&(function(){var e=r;if("number"==typeof e.length)for(var o=0,s=e.length;o<s;o++){var a=e[o];n=o<i?n+'<div class="sidebar__categories-item sidebar__item"><a'+Je("href",`/categories/${a}`,!0,!1)+">"+Ge(null==(t=a)?"":t)+"</a></div>":n+'<div class="sidebar__categories-item sidebar__item" style="display: none"><a'+Je("href",`/categories/${a}`,!0,!1)+">"+Ge(null==(t=a)?"":t)+"</a></div>"}else for(var o in s=0,e)s++,a=e[o],n=o<i?n+'<div class="sidebar__categories-item sidebar__item"><a'+Je("href",`/categories/${a}`,!0,!1)+">"+Ge(null==(t=a)?"":t)+"</a></div>":n+'<div class="sidebar__categories-item sidebar__item" style="display: none"><a'+Je("href",`/categories/${a}`,!0,!1)+">"+Ge(null==(t=a)?"":t)+"</a></div>"}.call(this),n+='<div class="sidebar__categories-more sidebar__item"><div class="sidebar__categories-more-text">Показать ещё</div><button class="action-btns__arrow-icon icon-small__img sidebar__categories-more-btn rotate-180"></button></div>'),n+='</div><div class="sidebar-bottom_right"><div class="contacts"><div class="contacts__title">Контакты</div><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/yurij-lyubskij">Юра</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/Svetlanlka">Света</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/Denactive">Денис</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/MollenAR">Лёша</a></div></div></div></div>'}.call(this,"Array"in r?r.Array:"undefined"!=typeof Array?Array:void 0,"categoriesList"in r?r.categoriesList:"undefined"!=typeof categoriesList?categoriesList:void 0,"limit"in r?r.limit:"undefined"!=typeof limit?limit:void 0,"streams"in r?r.streams:"undefined"!=typeof streams?streams:void 0,"topBlockContent"in r?r.topBlockContent:"undefined"!=typeof topBlockContent?topBlockContent:void 0),n}function Ve(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=ze(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function ze(e){var t=""+e,n=Ye.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Ye=/["&<>]/;function Ze(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="stream-comment"'+Ve("id",`${r}`,!0,!1)+'><div class="stream-comment__author"><img class="stream-comment__author-photo"'+Ve("src",`${e.avatarUrl}`,!0,!1)+'/><div class="stream-comment__author-name">'+ze(null==(t=e.firstName)?"":t)+" "+ze(null==(t=e.lastName)?"":t)+'</div></div><div class="stream-comment__text">'+ze(null==(t=i)?"":t)+"</div></div>"}.call(this,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"id"in r?r.id:"undefined"!=typeof id?id:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0),n}class Ke extends n{constructor(){super(),this.root=document.createElement("div")}render(e,t,n,r){let i="";r.forEach((e=>{const t=Ze(e);i+=t}));const o=document.createElement("div");return o.innerHTML=We({topBlockContent:e,categoriesList:t,limit:n,streams:i}),this.root=o.firstChild,this.root}setTopBlockContent(e){const t=this.root.querySelector("#sidebarTopBlockContent");t?t.innerHTML=e:this.render(e)}addComments(e){const t=this.root.querySelector(".sidebar__streams");e.forEach((e=>{const n=Ze(e);t.insertAdjacentHTML("afterbegin",n)}))}}function Xe(e){var t=""+e,n=Qe.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Qe=/["&<>]/;function et(e){var t,n="",r=e||{};return function(e,r){n=n+'<div class="user-preview"><a class="user-preview__links" href="/profile"><div class="sidebar__nav-item" data-router="ignore">'+Xe(null==(t=r)?"":t)+'</div><img class="user-img user-preview__user-img"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' src="src"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),true)?' src="'+(t=Xe(t))+'"':" src='"+t.replace(/'/g,"&#39;")+"'"}(0,`${e}`)+' data-router="ignore"/></a><div class="profile-menu"><a class="profile-menu__item" href="/profile/settings">Настройки</a><a class="profile-menu__item" data-section="logout">Выйти</a></div></div>'}.call(this,"avatarUrl"in r?r.avatarUrl:"undefined"!=typeof avatarUrl?avatarUrl:void 0,"login"in r?r.login:"undefined"!=typeof login?login:void 0),n}function tt(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=nt(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function nt(e){var t=""+e,n=rt.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var rt=/["&<>]/;function it(e){var t,n="",r=e||{};return function(e,r,i,o,s){null!=i&&e-s!=void 0&&(n=n+'<a class="sidebar__nav-item"'+tt("href",`${i}`,!0,!1)+tt("data-section",`${r}`,!0,!1)+">"+nt(null==(t=o)?"":t)+"</a>"),null==i&&e-s!=void 0&&(n=n+'<a class="sidebar__nav-item"'+tt("data-section",`${r}`,!0,!1)+">"+nt(null==(t=o)?"":t)+"</a>"),null!=i&&e-s==void 0&&(n=n+'<a class="sidebar__nav-item"'+tt("href",`${i}`,!0,!1)+">"+nt(null==(t=o)?"":t)+"</a>")}.call(this,"data"in r?r.data:"undefined"!=typeof data?data:void 0,"data_section"in r?r.data_section:"undefined"!=typeof data_section?data_section:void 0,"href"in r?r.href:"undefined"!=typeof href?href:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"section"in r?r.section:"undefined"!=typeof section?section:void 0),n}const ot=function(e){return Ie(e),{type:s,payload:e}},st=function(){return{type:a}},at=function(e,t){return{type:c,payload:{page:e,docTitle:t}}},ct=function(){return{type:d}},lt=function(){return{type:u}},dt=function(e,t){return t.forEach((e=>{Ie(e),Ie(e.author)})),{type:p.SAVE_NEW_CARDS,payload:{idLastLoaded:e,cards:t}}},ut=function(){return{type:p.CLEAR_CARDS}},pt=function(){return{type:p.SET_LOADING_FLAG}},gt=function(){return{type:p.UNSET_LOADING_FLAG}},ht=function(){return{type:p.FORBID_CARDS_UPLOADING}},mt=function(){return{type:p.ALLOW_CARDS_UPLOADING}},vt=function(e,t){return{type:p.TOGGLE_AUTH,payload:{isAuthenticated:e,login:t}}},ft=function(e){return{type:y,payload:{firstName:"загрузка",lastName:"загрузка",avatarUrl:"",score:0,...e}}},_t=function(e){return Ie(e),{type:_,payload:e}},yt=function(e,t){return t.forEach((e=>{Ie(e),Ie(e.author)})),{type:g,payload:{idLastLoaded:e,cards:t}}},bt=function(){return{type:h}},wt=function(){return{type:f}},St=function(){return{type:"UNSET_USER_ARTICLES_LOADING"}},Et=function(){return{type:m}},Lt=function(){return{type:M}},Ct=function(){return{type:$}},At=function(){return{type:B}},xt=function(e,t){return Ie(t),Ie(t.author),{type:H,payload:{id:e,...t,tags:Array.isArray(t.tags)?t.tags:[]}}},kt=function(e){return{type:G,payload:{id:e}}},Tt=function(e,t){return Ie(t),{type:J,payload:{id:e,title:t.title,text:t.text,tags:Array.isArray(t.tags)?t.tags:[],img:t.img||"",category:t.category||""}}},Ot=function(e){return{type:W,payload:{id:e}}},It=function(e){return{type:U,payload:e}},Rt=function(e){return{type:F,payload:e}},Nt=function(e){return{type:V,payload:e}},qt=function(){return{type:V,payload:""}},Pt=function(e){return{type:z,payload:e}},Dt=function(){return{type:z,payload:""}},$t=["Маркетинг","Личный опыт","Вопросы","SaberDevs","Сервисы","Будущее","Финансы","Дизайн","Соцсети","Техника","Карьера","Медиа","Истории","Торговля","SEO","Офлайн","Видео","Офис","Офтоп","Транспорт","Право","Трибуна","Еда","Конкурсы","Приёмная","Миграция"];class Mt extends r{constructor(){super(),this.view=new Ke,this.unsubscribes.push(me.subscribe(s,(()=>{me.dispatch(((e,t)=>e(vt(!0,t().authorization.login)))),this.setSidebarUserPreview()})),me.subscribe(a,(()=>{me.dispatch(vt(!1,"")),this.setSidebarSignupButtons()}))),this.unsubscribes.push(me.subscribe(P,(e=>{this.addComments(e)})))}render(){super.render();const e=me.getState().authorization;let t="";e.isAuthenticated?t=et({login:e.login,avatarUrl:e.avatarUrl}):(t+=it({data_section:"loginModal",name:"Логин"}),t+=it({data_section:"signupModal",name:"Регистрация"}));const n=[...me.getState().stream.comments].reverse();this.root=this.view.render(t,$t,6,n),this.view.root.querySelector("a.sidebar__nav-item").addEventListener("click",(()=>me.dispatch(At())));const r=this.view.root.querySelectorAll(".sidebar__categories-item"),i=this.view.root.querySelector(".sidebar__categories-more-btn"),o=this.view.root.querySelector(".sidebar__categories-more-text");return Ut(r,i,o),this.view.root.querySelector(".sidebar__categories-more").addEventListener("click",(e=>{e.preventDefault(),Ut(r,i,o)})),this.root}setSidebarUserPreview(){const e=me.getState().authorization;this.view.setTopBlockContent(et(e))}setSidebarSignupButtons(){let e=it({data_section:"loginModal",name:"Логин"});e+=it({data_section:"signupModal",name:"Регистрация"}),this.view.setTopBlockContent(e)}addComments(e){this.view.addComments(e)}}function Ut(e,t,n){let r=!0;t.classList.contains("rotate-180")?(n.innerText="Показать ещё",t.classList.remove("rotate-180"),r=!0):(n.innerText="Скрыть",t.classList.add("rotate-180"),r=!1);for(let t=6;t<e.length;++t)e[t].style.display=r?"none":"block"}let Ft=null,Ht=null;function Bt(e,...t){null!==Ft&&null!==Ht||(Ft=new Be,Ht=new Mt);const n=document.createElement("div");n.className="background";const i=document.createElement("div");i.className="screen";const o=document.createElement("div");o.className="page";const s=document.createElement("div");s.className="page_title",s.textContent=e;const a=document.createElement("div");return a.className="content",t.forEach((e=>{e instanceof r?a.appendChild(e.render()):e instanceof HTMLElement?a.appendChild(e):console.warn(e,"is not BaseComponent nor HTMLElement")})),o.appendChild(Ft.render()),o.appendChild(s),o.appendChild(a),i.appendChild(o),i.appendChild(Ht.render()),n.appendChild(i),n}function Jt(e){var t,n="",r=e||{};return function(e){n=n+'<div class="feed"><div class="feed__preview">'+(null==(t=e)?"":t)+'</div><div class="feed__cards"></div><div id="feed__loading">&#11088;</div></div>'}.call(this,"preview"in r?r.preview:"undefined"!=typeof preview?preview:void 0),n}class Gt extends n{constructor(e,t,n){super(),this.composeCards=e,this.root=this.render(t,n)}render(e,t){const n=document.createElement("div");n.innerHTML=Jt({preview:e});const r=n.firstChild;return this.composeCards(r.querySelector(".feed__cards"),t),this.root=r,r}addCards(e){const t=this.root.querySelector(".feed__cards");t?(this.composeCards(t,e),this.showLoadingAnimation()):console.warn("cannot append cards till Feed is not rendered")}clear(){this.root.querySelector(".feed__cards").innerHTML=""}hideLoadingAnimation(){this.root.querySelector("#feed__loading").style.display="none"}showLoadingAnimation(){this.root.querySelector("#feed__loading").style.display="block"}}const jt=function(e){return Ie(e),Ie(e.author),{type:Y,payload:e}},Wt=function(e){return{type:Z,payload:e}},Vt=function(e){return Ie(e),"avatar"in e&&Ie(e.author),{type:K,payload:e}},zt=function(e,t){return Array.isArray(t)||(console.warn("API error. Server returned ",typeof t,"instead of comments"),t=[]),t||(t=[]),{type:X,payload:{id:e,comments:t}}},Yt=function(e,t){return{type:Q,payload:{id:e,text:t}}},Zt=function(e,t){return{type:ee,payload:{parentId:e,answer:t}}},Kt=function(e){return{type:te,payload:e}};function Xt(e,t){t.forEach((t=>{const n=e.querySelector("#card"+t.id);null!==n?(n.addEventListener("click",(e=>{e.preventDefault();const n=e.currentTarget;me.dispatch(Vt(t)),ye("/article/"+n.id.replace("card",""))})),n.querySelector(".author-name").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),me.dispatch(_t(t.author)),ye("/user/"+t.author.login)})),n.querySelectorAll(".tags__tag").forEach((e=>e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),console.warn("TODO: клик по тегу",e.currentTarget.textContent)}))))):console.warn("{Feed} card with id",t.id,"has mounted with error")}))}class Qt extends r{constructor(e,t,n,i,o,s,a,c,l=new r){console.log("{FEED} creation with params:"),console.log({storeName:t}),super(),this.innerComponent=l,this.storeName=t;const d=me.getState()[t].cards;this.view=new Gt(e,l.render().outerHTML,d),this.unsubscribes.push(me.subscribe(n,(({idLastLoaded:e,cards:n})=>{Array.isArray(n)?(this.view.addCards(n),Xt(this.view.root.querySelector(".feed__cards"),n),me.getState()[t].isEndFound&&(console.log(`{${t}FEED}              'end' found. isEndFound flag is true`),this.view.hideLoadingAnimation(),me.dispatch((e=>{setTimeout((()=>{console.log("{FEED} isEndFound flag is reset to false"),e(c())}),6e3)})))):console.warn("API ERROR! Server must return array of Cards","but returned",typeof n,":",{cards:n})})),me.subscribe(i,(()=>this.view.clear())),me.subscribe(s,(()=>this.view.showLoadingAnimation())),me.subscribe(o,(()=>this.view.hideLoadingAnimation())))}render(){super.render();const e=this.innerComponent.render().outerHTML,t=me.getState()[this.storeName].cards;return this.root=this.view.render(e,t),Xt(this.view.root.querySelector(".feed__cards"),t),me.getState()[this.storeName].isEndFound&&this.view.hideLoadingAnimation(),this.root}}function en(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=tn(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function tn(e){var t=""+e,n=rn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var nn=Object.prototype.hasOwnProperty,rn=/["&<>]/;function on(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)nn.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function sn(e){var t,n="",r={},i=e||{};return function(e,i,o,s,a,c,l,d,u,p,g){r.tagMixin=t=function(e,r,i=!1){this&&this.block,this&&this.attributes,n=n+'<div class="tags__tag-content"'+en("style",on(`background-color: ${r}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=e)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+en("style",on(`background-color: ${r}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=e)?"":t)+"</div>",n+="</div>"},n=n+'<div class="card"'+en("id",`card${c}`,!0,!1)+en("style",on(`background: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0.7)), to(rgba(0, 0, 0, 0.7))), url(${d});\nbackground: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url(${d});\nbackground-size: cover;\nbackground-repeat: no-repeat;`),!0,!1)+'><div class="card__top"><div class="card__top-left"><div class="card__time-category"><div class="card__time">'+tn(null==(t=a)?"":t)+'</div><div class="card__category">'+tn(null==(t=o)?"":t)+'</div></div><div class="tags">',e.isArray(u)&&function(){var e=u;if("number"==typeof e.length)for(var t=0,n=e.length;t<n;t++){var i=e[t];r.tagMixin(i.content,i.color)}else for(var t in n=0,e)n++,i=e[t],r.tagMixin(i.content,i.color)}.call(this),n=n+'</div></div><div class="card__author"><img class="card__author-photo"'+en("src",`${i.avatarUrl||"static/img/users/user_icon_loading.svg"}`,!0,!1)+'/><div class="author-name">',"object"==typeof i&&(n=n+'<div class="author-name__login">'+tn(null==(t=i.login)?"":t)+'</div><div class="author-name__username">'+tn(null==(t=i.firstName)?"":t)+" "+tn(null==(t=i.lastName)?"":t)+"</div>"),n=n+'</div></div></div><div class="card__content"><a class="preview__title">'+tn(null==(t=g)?"":t)+'</a><div class="card__description">'+tn(null==(t=p)?"":t)+'</div></div><div class="card__bottom"><div class="action-btns"><div class="icon action-btns_m-right"><div class="icon__text">'+tn(null==(t=l)?"":t)+'</div><button class="action-btns__likes-icon icon__img"></button></div><div class="icon"><div class="icon__text">'+tn(null==(t=s)?"":t)+'</div><button class="action-btns__comments-icon icon__img"></button></div></div></div></div>'}.call(this,"Array"in i?i.Array:"undefined"!=typeof Array?Array:void 0,"author"in i?i.author:"undefined"!=typeof author?author:void 0,"category"in i?i.category:"undefined"!=typeof category?category:void 0,"comments"in i?i.comments:"undefined"!=typeof comments?comments:void 0,"datetime"in i?i.datetime:"undefined"!=typeof datetime?datetime:void 0,"id"in i?i.id:"undefined"!=typeof id?id:void 0,"likes"in i?i.likes:"undefined"!=typeof likes?likes:void 0,"previewUrl"in i?i.previewUrl:"undefined"!=typeof previewUrl?previewUrl:void 0,"tags"in i?i.tags:"undefined"!=typeof tags?tags:void 0,"text"in i?i.text:"undefined"!=typeof text?text:void 0,"title"in i?i.title:"undefined"!=typeof title?title:void 0),n}function an(e,t){t.forEach((t=>{Ie(t),Ie(t.author);const n=document.createElement("div"),r=t.tags.map((e=>({content:e,color:be()})));n.innerHTML=sn({...t,tags:r}),e.appendChild(n.firstChild)}))}class cn extends e{constructor(e){super(e),this.pageComponents={feed:new Qt(an,"mainPage",p.SAVE_NEW_CARDS,p.CLEAR_CARDS,p.FORBID_CARDS_UPLOADING,p.ALLOW_CARDS_UPLOADING,ht,mt)}}render(){super.render(),this.root.appendChild(Bt("",this.pageComponents.feed))}}let ln=!1,dn=!1,un=!0,pn=!0,gn="",hn=()=>{},mn=()=>{};function vn(e){return console.log("[Modal] modal filling: "+JSON.stringify(e)),function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="modal__overlay" data-modal-close="true"><div class="modal__window"><div class="modal__content-block"><div class="modal__header"><a class="modal__close-btn icon__img" data-modal-close="true"></a></div><div class="modal__content">'+(null==(t=r)?"":t)+'</div></div><div class="modal__footer"><button class="modal__btn" id="modal__btn-ok" type="button" data-modal-close="true">'+(null==(t=i)?"":t)+'</button><button class="modal__btn" id="modal__btn-cancel" type="button" data-modal-close="true">'+(null==(t=e)?"":t)+"</button></div></div></div>"}.call(this,"cancel_sign"in r?r.cancel_sign:"undefined"!=typeof cancel_sign?cancel_sign:void 0,"content"in r?r.content:"undefined"!=typeof content?content:void 0,"ok_sign"in r?r.ok_sign:"undefined"!=typeof ok_sign?ok_sign:void 0),n}({title:e.title||"",content:e.content||"",ok_sign:e.btnOkSign||"Понятно",cancel_sign:e.btnCancelSign||"Отмена"})}const fn=function(e){const t=document.getElementById("modalroot");t.innerHTML=vn(e);const n=t.querySelector("#modal__btn-ok"),r=t=>{t.preventDefault(),"function"==typeof e.onConfirm?e.onConfirm():console.log("[Modal] confirm")};n.addEventListener("click",r),hn=()=>{n.removeEventListener("click",r)};const i=t.querySelector("#modal__btn-cancel"),o=t=>{t.preventDefault(),"function"==typeof e.onDecline?e.onDecline():console.log("[Modal] decline")};return i.addEventListener("click",o),mn=()=>{i.removeEventListener("click",o)},me.subscribe(u,(()=>{document.title=me.getState().page.docTitle})),me.subscribe(d,(()=>{document.title=gn})),t}({isEnteractive:!0,isCancelable:!0}),_n={animationTime:200,setDocTitle(e){gn=e},close(){if(dn)return void console.warn("[Modal] close: modal has been destroyed");me.dispatch(lt()),ln=!0;const e=fn.querySelector(".modal__overlay");e.classList.add("modal_close"),e.classList.remove("modal_open"),setTimeout((()=>{ln=!1}),200)},open(e=!0){if(dn)return void console.warn("[[Modal] open: modal has been destroyed");if(me.dispatch(ct()),ln)return void console.warn("[Modal] open: modal is in closing process");const t=fn.querySelector("#modal__btn-ok"),n=fn.querySelector("#modal__btn-cancel");t.className="modal__btn-ok",t.classList.add("modal__btn"),n.className="modal__btn-cancel",n.classList.add("modal__btn"),e||(t.style.display="none",n.style.display="none");const r=fn.querySelector(".modal__overlay");r.classList.remove("modal_close"),r.classList.add("modal_open"),e||setTimeout((()=>{this.close(),setTimeout((()=>{un&&(t.style.display="block"),pn&&(n.style.display="block")}),200)}),2e3)},getContent(){const e=fn.querySelector(".modal__content");return e||console.warn("[Modal] no .modal__content found"),e},setContent(e){console.log("[Modal]: setContent to ",e);const t=fn.querySelector(".modal__content");"string"==typeof e&&(t.innerHTML=e),e instanceof HTMLElement&&(t.innerHTML="",t.appendChild(e))},appendContent(e){console.log("[Modal]: appendContent:",e);const t=fn.querySelector(".modal__content");"string"==typeof e&&(t.innerHTML+=e),e instanceof HTMLElement&&t.appendChild(e)},setTitle(e){console.log("[Modal]: setTitle to ",e);let t=fn.querySelector(".modal__header");if("string"==typeof e&&(t.innerHTML=e),e instanceof HTMLElement){const n=document.createElement("div");t.className="modal__header",n.appendChild(e),t=n}},configurate(e){fn.innerHTML=vn(e);const t=fn.querySelector("#modal__btn-ok"),n=t=>{t.preventDefault(),"function"==typeof e.onConfirm?e.onConfirm():console.log("[Modal] confirm")};t.addEventListener("click",n),hn=()=>{t.removeEventListener("click",n)};const r=fn.querySelector("#modal__btn-cancel"),i=t=>{t.preventDefault(),"function"==typeof e.onDecline?e.onDecline():console.log("[Modal] decline")};r.addEventListener("click",i),mn=()=>{console.log("[Modal] clear Cancel Listener",{activeCancelEventListener:i}),r.removeEventListener("click",i)},e.isEnteractive||(t.style.display="none",r.style.display="none"),e.isCancelable||(r.style.display="none")},enableOkBtn(){fn.querySelector("#modal__btn-ok").style.display="block",un=!0},disableOkBtn(){fn.querySelector("#modal__btn-ok").style.display="none",un=!1},enableCancelBtn(){fn.querySelector("#modal__btn-cancel").style.display="block",pn=!0},disableCancelBtn(){fn.querySelector("#modal__btn-cancel").style.display="none",pn=!1},changeBtnOkSign(e){fn.querySelector("#modal__btn-ok").innerText=e},changeBtnCancelSign(e){fn.querySelector("#modal__btn-cancel").innerText=e},setOkBtnAction(e){hn();const t=fn.querySelector("#modal__btn-ok"),n=t=>{t.preventDefault(),"function"==typeof e?e():console.log("[Modal] confirm")};t.addEventListener("click",n),hn=()=>{t.removeEventListener("click",n)}},setCancelBtnAction(e){mn();const t=fn.querySelector("#modal__btn-cancel"),n=t=>{t.preventDefault(),"function"==typeof e?e():console.log("[Modal] confirm")};t.addEventListener("click",n),mn=()=>{t.removeEventListener("click",n)}}};function yn(e){e.target.dataset.modalClose&&_n.close()}fn.addEventListener("click",yn),Object.assign(_n,{destroy(){this.close(),fn.removeEventListener("click",yn),fn.innerHTML="",dn=!0}});const bn=_n;function wn({currentTarget:e}){const t=me.getState().mainPage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>we()||(console.log("[Main Page] scroll trigger"),me.dispatch(Sn))}async function Sn(){const e=me.getState().mainPage,t=me.getState().authorization;e.isEndFound||e.isLoading?console.log("[Main Page] can't load news asisEndFound state flag is true"):(me.dispatch(pt()),await xe({url:`/articles/feed?idLastLoaded=${e.idLastLoaded||""}&login=`+(t.isAuthenticated?t.login:"all")}).then((({status:t,response:n})=>{if(t===Ae.ok)return r=n.data,console.log("[Main Page] more news loaded!"),void me.dispatch(dt(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;t/500==1&&bn.setTitle(`Сервис временно не доступен: ${t}`),t/400==1&&bn.setTitle(`Ошибка ${t}`),bn.setContent(n.msg),bn.open(!1)})).catch((e=>console.warn(e.message))),me.dispatch(gt()))}function En(e){var t=""+e,n=Ln.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Ln=/["&<>]/;function Cn(e){var t,n="",r=e||{};return function(e,r,i,o,s,a){n=n+'<div class="profile"><div class="profile__info"><img class="profile__photo"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' src="src"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),true)?' src="'+(t=En(t))+'"':" src='"+t.replace(/'/g,"&#39;")+"'"}(0,`${e||"static/img/users/user_icon_loading.svg"}`)+'/><div class="profile__description"><div class="profile__username">'+En(null==(t=o)?"":t)+" "+En(null==(t=s)?"":t)+" ("+En(null==(t=a)?"":t)+')</div><div class="profile__aboutme">Обо мне:</div>'+En(null==(t=r)?"":t)+"</div></div>",i||(n+='<div class="profile__articles-title">Статьи</div>'),n+="</div>"}.call(this,"avatarUrl"in r?r.avatarUrl:"undefined"!=typeof avatarUrl?avatarUrl:void 0,"description"in r?r.description:"undefined"!=typeof description?description:void 0,"disableArticles"in r?r.disableArticles:"undefined"!=typeof disableArticles?disableArticles:void 0,"firstName"in r?r.firstName:"undefined"!=typeof firstName?firstName:void 0,"lastName"in r?r.lastName:"undefined"!=typeof lastName?lastName:void 0,"login"in r?r.login:"undefined"!=typeof login?login:void 0),n}class An extends n{constructor(){super(),this.root=document.createElement("div"),this.root.innerHTML="компонент profileCard"}render(e){const t=document.createElement("div");return t.innerHTML=Cn(e),this.root=t.firstChild,t.firstChild}}class xn extends r{constructor(){super(),this.view=new An,this.unsubscribes.push(me.subscribe(y,(e=>{this.setUser(e)})),me.subscribe(_,(e=>{this.setUser(e)})))}render(){super.render();const e=me.getState().profilePage.user;return this.root=this.view.render(e),this.root}setUser(e){this.root.innerHTML="",this.root.appendChild(this.view.render(e).firstChild)}}class kn extends e{constructor(e){super(e),this.pageComponents={profileCard:new xn,feed:new Qt(an,"profilePage",g,h,m,v,Et,(()=>(console.log("{profilePage feed} isEndFound is not been reset"),{type:"__EMPTY__"})))}}render(){super.render(),this.root.appendChild(Bt("",this.pageComponents.profileCard,this.pageComponents.feed))}}var Tn=/["&<>]/;function On(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=In(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function In(e){var t=""+e,n=Rn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Rn=/["&<>]/;function Nn(e){var t,n="",r=e||{};return function(e,r,i,o,s,a,c){n=n+'<div class="form__row"><div class="form__label">'+In(null==(t=r)?"":t)+'</div><div class="form__field">',null!=s&&null!=o&&a&&(n=n+'<input class="form__input"'+On("type",`${c}`,!0,!1)+On("name",`${i}`,!0,!1)+On("placeholder",`${s}`,!0,!1)+On("pattern",`${o}`,!0,!1)+On("required",`${a}`,!0,!1)+"/>"),null==s||null==o||a||(n=n+'<input class="form__input"'+On("type",`${c}`,!0,!1)+On("name",`${i}`,!0,!1)+On("placeholder",`${s}`,!0,!1)+On("pattern",`${o}`,!0,!1)+"/>"),null!=s&&null==o&&a&&(n=n+'<input class="form__input"'+On("type",`${c}`,!0,!1)+On("name",`${i}`,!0,!1)+On("placeholder",`${s}`,!0,!1)+On("required",`${a}`,!0,!1)+"/>"),null==s||null!=o||a||(n=n+'<input class="form__input"'+On("type",`${c}`,!0,!1)+On("name",`${i}`,!0,!1)+"/>"),null==s&&null!=o&&a&&(n=n+'<input class="form__input"'+On("type",`${c}`,!0,!1)+On("name",`${i}`,!0,!1)+On("pattern",`${o}`,!0,!1)+On("required",`${a}`,!0,!1)+"/>"),null!=s||null==o||a||(n=n+'<input class="form__input"'+On("type",`${c}`,!0,!1)+On("name",`${i}`,!0,!1)+On("pattern",`${o}`,!0,!1)+"/>"),null==s&&null==o&&a&&(n=n+'<input class="form__input"'+On("type",`${c}`,!0,!1)+On("name",`${i}`,!0,!1)+On("required",`${a}`,!0,!1)+"/>"),null!=s||null!=o||a||(n=n+'<input class="form__input"'+On("type",`${c}`,!0,!1)+On("name",`${i}`,!0,!1)+"/>"),1==e&&(n+='<a class="password__control-btn control-password"></a>'),n+="</div></div>"}.call(this,"eye"in r?r.eye:"undefined"!=typeof eye?eye:void 0,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"pattern"in r?r.pattern:"undefined"!=typeof pattern?pattern:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0,"required"in r?r.required:"undefined"!=typeof required?required:void 0,"type"in r?r.type:"undefined"!=typeof type?type:void 0),n}const qn={login:/^[a-zA-Z][a-zA-Z0-9_]{4,20}$/,password:/^\S{8,40}$/,firstName:/^[a-zA-Zа-яА-Я]{2,}$/,lastName:/^[a-zA-Zа-яА-Я]{1,}'?-?[a-zA-Zа-яА-Я]{1,}(\s[a-zA-Zа-яА-Я]{1,})?$/,cirillic:/[\u0401\u0451\u0410-\u044f]/};class Pn extends n{constructor(){super(),this.root=document.createElement("div"),this.appendWarning=e=>{const t=this.root.querySelector(".form__warning"),n=this.root.querySelector("#form-warning-label");t||console.warn("[SignupFormView]\n          appendWarning call while SignupForm was not rendered"),n.style.display="block",t.style.display="block",t.textContent=e}}render(e,t){let n="";n+=Nn({label:"Логин",type:"text",name:"login",required:!0}),e&&(n+=Nn({label:"e-mail",type:"email",name:"email",required:!0})),n+=Nn({label:"Пароль",type:"password",name:"password",required:!0,eye:!0}),e&&(n+=Nn({label:"Повтор пароля",type:"password",name:"password-repeat",required:!0,eye:!1}));const r=document.createElement("div");r.innerHTML=function(e){var t,n="",r=e||{};return function(e,r){n=n+'<form class="modal__form form"><div class="form__rows">'+(null==(t=e)?"":t)+'</div><div class="form__row"><div class="form__label" id="form-warning-label" style="display: none; color: transparent;">|</div><div class="form__input form__warning">Поля заполнены неверно</div></div><div class="form__row"><div class="form__label" style="color: transparent;">|</div><input class="form__input form__submit-btn" type="submit" name="btn-submit"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=Tn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("value",`${r}`,!0,!1)+"/></div></form>"}.call(this,"form_rows"in r?r.form_rows:"undefined"!=typeof form_rows?form_rows:void 0,"submit_btn_placeholder"in r?r.submit_btn_placeholder:"undefined"!=typeof submit_btn_placeholder?submit_btn_placeholder:void 0),n}({title:e?"Регистрация":"Вход",form_rows:n,submit_btn_placeholder:e?"Зарегистрироваться":"Войти"});const i=r.firstChild;return i.querySelector(".control-password").addEventListener("click",(({target:e})=>{const t=i.querySelector('input[name="password"]');"password"===t.getAttribute("type")?(e.classList.add("password__show"),t.type="text"):(e.classList.remove("password__show"),t.type="password")})),i.addEventListener("submit",(n=>{n.preventDefault();const r=i.querySelector(".form__warning"),o=this.root.querySelector("#form-warning-label");r.style.display="none",r.textContent="",o.style.display="none";const s=i.querySelector('input[name="login"]').value,a=i.querySelector('input[name="password"]').value,c=i.querySelector('input[name="email"]')?.value,l=i.querySelector('input[name="password-repeat"]')?.value;return qn.login.test(s)?qn.password.test(a)?e&&l!==a?(r.style.display="block",o.style.display="block",void(r.textContent="Удостоверьтесь, что пароли совпадают")):void t(e,s,a,c):(r.style.display="block",o.style.display="block",void(r.textContent="В качестве пароля используйте любую комбинацию непробельных символы длиной более 8")):(r.style.display="block",o.style.display="block",void(r.textContent="Логин - это латинские буквы, цифры инижнее подчеркивание (_). Длина логина - от 4 до 20 символов"))})),this.root=i,i}}class Dn extends r{constructor(e){super(),this.view=new Pn,this.showRegister=e}render(){var e;return super.render(),this.root=this.view.render(this.showRegister,(e=this.view.appendWarning,function(t,n,r,i){ke({url:t?"/user/signup":"/user/login",body:{login:n,email:i||"",password:r}}).then((({status:t,response:n})=>{if(t===Ae.ok)return me.dispatch(ot(n.data)),void bn.close();e(n.msg)}))})),this.root}}function $n(e){const t=document.createElement("a");t.textContent=e?"У меня уже есть аккаунт":"Создать аккаунт",t.href=e?"/login":"/register",t.classList.add("link"),t.addEventListener("click",(t=>{t.preventDefault(),bn.close(),setTimeout((()=>{$n(!e)}),bn.animationTime)}));const n=new Dn(e).render(),r=document.createElement("div");r.appendChild(n),r.appendChild(t),bn.setDocTitle("SaberProject | "+(e?"Sign Up":"Login")),bn.setTitle(e?"Регистрация":"Вход"),bn.setContent(r),bn.disableCancelBtn(),bn.disableOkBtn(),bn.open()}class Mn{static show(e=!1){$n(e)}static appendWarning(e){const t=bn.getContent();t&&(t.innerHTML+=e)}}function Un(e,t){"5"===(e/100+"")[0]&&bn.setTitle(`Сервис временно не доступен: ${e}`),"4"===(e/100+"")[0]&&(401===e?(bn.setTitle("Внимание"),t="Для этого действия необходима авторизация"):bn.setTitle(`Ошибка ${e}`)),bn.setContent(t),bn.open(!1)}class Fn{static signup(e){Mn.show(e)}static netOrServerError(e,t){Un(e,t)}static informativeMsg(e="",t=""){!function(e="",t=""){bn.setTitle(e),bn.setContent(t),bn.open(!1)}(e,t)}static confirm(e,t,n,r){!function(e,t,n,r=(()=>{})){bn.setTitle(e),bn.setContent(t),bn.changeBtnOkSign("Да"),bn.enableOkBtn(),bn.setOkBtnAction(n),bn.changeBtnCancelSign("Отмена"),bn.enableCancelBtn(),bn.setCancelBtnAction(r),bn.open(!0)}(e,t,n,r)}static warn(e,t,n){!function(e,t,n=(()=>{})){bn.setTitle(e),bn.setContent(t),bn.enableOkBtn(),bn.changeBtnOkSign("Понятно"),bn.setOkBtnAction(n),bn.disableCancelBtn(),bn.open(!0)}(e,t,n)}}function Hn({currentTarget:e}){const t=me.getState().profilePage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>Se.getUserWindowHeight()||(console.log("[Profile Page] scroll trigger"),me.dispatch(Bn))}async function Bn(){const e=me.getState().profilePage;e.isEndFound||e.isLoading?console.log("can't load usercards as isEndFound state flag is true"):(me.dispatch(wt()),await xe({url:`/articles/author?idLastLoaded=${e.idLastLoaded}&login=${e.user.login}`}).then((({status:t,response:n})=>{if(t===Ae.ok)return r=n.data,console.log("[ProfilePage] more user cards loaded!"),void me.dispatch(yt(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;Un(t,n.msg)})).catch((e=>console.warn(e.message))),me.dispatch(St()))}class Jn extends t{constructor(e){super(e),this.view=new kn(e),me.subscribe(a,(()=>{this.isActive()&&(console.log("[ProfilePage] Logout reaction"),-1!==document.URL.indexOf("/profile")&&Se.redirect("/"))})),me.subscribe(s,(()=>{this.isActive()&&(console.log("[ProfilePage] Login reaction"),-1===document.URL.indexOf("/profile")&&me.getState().profilePage.user.login===me.getState().authorization.login&&Se.redirect("/profile"))})),me.subscribe(G,(()=>{me.dispatch(bt())}))}show(){super.show();const e=me.getState().profilePage,t=me.getState().authorization;if(-1!==document.URL.indexOf("/profile"))me.dispatch(_t(t)),me.dispatch(bt());else{const n=document.URL.slice(document.URL.indexOf("user/")+5);if(console.warn("[ProfilePage] user from Url ",document.URL,n),""===n&&Se.redirect("/404"),n!==e.user.login){if(n===t.login)return void Se.redirect("/profile");me.dispatch(ft({login:n})),me.dispatch(bt()),xe({url:`/user?user=${n}`}).then((({status:e,response:t})=>{e!==Ae.ok?(Un(e,t.msg),Se.redirect("/")):me.dispatch(_t(t.data))})).catch((e=>console.warn(e.message)))}}me.dispatch(at("profile",`SaberProject | ${e.user.login}`)),0===me.getState().profilePage.cards.length&&me.dispatch(Bn);const n=this.view.root.querySelector(".content");n?n.addEventListener("scroll",Hn):console.warn("[ProfilePage] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",Hn):console.warn("[ProfilePage] нет дивака .content")}redirect(e){const t=me.getState().authorization;return-1===document.URL.indexOf("/profile")||t.isAuthenticated?"":"/login"}}function Gn(e){var t=""+e,n=jn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var jn=/["&<>]/;function Wn(e){var t=""+e,n=Vn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Vn=/["&<>]/;function zn(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Yn(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Yn(e){var t=""+e,n=Zn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Zn=/["&<>]/;function Kn(e){var t,n="",r=e||{};return function(e,r,i,o,s,a){n=n+'<div class="settings__row"><div class="settings__label">'+Yn(null==(t=e)?"":t)+'</div><div class="settings__field">',null!=o&&null!=i&&s&&(n=n+'<input class="settings__input"'+zn("type",`${a}`,!0,!1)+zn("name",`${r}`,!0,!1)+zn("placeholder",`${o}`,!0,!1)+zn("pattern",`${i}`,!0,!1)+zn("required",`${s}`,!0,!1)+"/>"),null==o||null==i||s||(n=n+'<input class="settings__input"'+zn("type",`${a}`,!0,!1)+zn("name",`${r}`,!0,!1)+zn("placeholder",`${o}`,!0,!1)+zn("pattern",`${i}`,!0,!1)+"/>"),null!=o&&null==i&&s&&(n=n+'<input class="settings__input"'+zn("type",`${a}`,!0,!1)+zn("name",`${r}`,!0,!1)+zn("placeholder",`${o}`,!0,!1)+zn("required",`${s}`,!0,!1)+"/>"),null==o||null!=i||s||(n=n+'<input class="settings__input"'+zn("type",`${a}`,!0,!1)+zn("name",`${r}`,!0,!1)+"/>"),null==o&&null!=i&&s&&(n=n+'<input class="settings__input"'+zn("type",`${a}`,!0,!1)+zn("name",`${r}`,!0,!1)+zn("pattern",`${i}`,!0,!1)+zn("required",`${s}`,!0,!1)+"/>"),null!=o||null==i||s||(n=n+'<input class="settings__input"'+zn("type",`${a}`,!0,!1)+zn("name",`${r}`,!0,!1)+zn("pattern",`${i}`,!0,!1)+"/>"),null==o&&null==i&&s&&(n=n+'<input class="settings__input"'+zn("type",`${a}`,!0,!1)+zn("name",`${r}`,!0,!1)+zn("required",`${s}`,!0,!1)+"/>"),null!=o||null!=i||s||(n=n+'<input class="settings__input"'+zn("type",`${a}`,!0,!1)+zn("name",`${r}`,!0,!1)+"/>"),n+="</div></div>"}.call(this,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"pattern"in r?r.pattern:"undefined"!=typeof pattern?pattern:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0,"required"in r?r.required:"undefined"!=typeof required?required:void 0,"type"in r?r.type:"undefined"!=typeof type?type:void 0),n}class Xn extends n{render(){let e="";e+=Kn({label:"Имя",type:"text",name:"username"}),e+=Kn({label:"Фамилия",type:"text",name:"surname"}),e+=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="settings__row"><div class="settings__label">'+Wn(null==(t=e)?"":t)+'</div><div class="settings__field"><textarea class="settings__input"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' name="name"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),1)?' name="'+(t=Wn(t))+'"':" name='"+t.replace(/'/g,"&#39;")+"'"}(0,`${r}`)+">"+Wn(null==(t=i||"")?"":t)+"</textarea></div></div>"}.call(this,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0),n}({label:"О себе",name:"description"}),e+=Kn({label:"Фото",type:"file",name:"photo",placeholder:"Загрузите фото"});const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="settings"><div class="settings__links"><a class="settings__other-page"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' href="href"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),1)?' href="'+(t=Gn(t))+'"':" href='"+t.replace(/'/g,"&#39;")+"'"}(0,`${r}`)+">"+Gn(null==(t=i)?"":t)+'</a></div><form class="settings__form"><div class="settings__rows">'+(null==(t=e)?"":t)+'<div class="settings__row"><div class="settings__label" id="settings-warning-label" style="color: transparent;">|</div><div class="settings__field"><div class="settings__input settings__warning">Поля заполнены неверно</div></div></div></div><div class="settings__footer"><input class="btn_color-elementary" type="submit" name="btn-submit" value="Сохранить"/><a href="/"><input class="btn_color-elementary" data-router="ignore" type="button" value="Назад"/></a></div></form></div>'}.call(this,"form_rows"in r?r.form_rows:"undefined"!=typeof form_rows?form_rows:void 0,"other_page_href"in r?r.other_page_href:"undefined"!=typeof other_page_href?other_page_href:void 0,"other_page_name"in r?r.other_page_name:"undefined"!=typeof other_page_name?other_page_name:void 0),n}({other_page_name:"сменить пароль",other_page_href:"",form_rows:e}),t.firstChild}}class Qn extends r{constructor(){super(),this.view=new Xn}render(){return super.render(),this.root=this.view.render(),this.root}appendWarning(e){const t=this.root.querySelector(".settings__warning");t||console.warn("[SignupFormView]\n        appendWarning call while SignupForm was not rendered"),t.style.display="block",t.textContent=e}}class er extends e{constructor(e){super(e),this.pageComponents={settingsForm:new Qn}}render(){super.render(),this.root.appendChild(Bt("Настройки пользователя",this.pageComponents.settingsForm))}}var tr=/["&<>]/;function nr(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=ir.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}var rr=Object.prototype.hasOwnProperty,ir=/["&<>]/;function or(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)rr.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function sr(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=cr.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}var ar=Object.prototype.hasOwnProperty,cr=/["&<>]/;function lr(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)ar.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function dr(e){var t,n="",r={},i=e||{};return function(e,i){r.tagMixin=t=function(e,r,i=!1){this&&this.block,this&&this.attributes,n=n+'<div class="tags__tag-content"'+sr("style",lr(`background-color: ${r}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=e)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+sr("style",lr(`background-color: ${r}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=e)?"":t)+"</div>",n+="</div>"},n+='<div class="plate"><div class="categories__search-block"><div class="categories__search"><input class="categories__search-input" type="text" id="categories-search" placeholder="фильтр"/></div></div><div class="tags">',e.isArray(i)&&function(){var e=i;if("number"==typeof e.length)for(var t=0,n=e.length;t<n;t++){var o=e[t];r.tagMixin(o.content,o.color)}else for(var t in n=0,e)n++,o=e[t],r.tagMixin(o.content,o.color)}.call(this),n+="</div></div>"}.call(this,"Array"in i?i.Array:"undefined"!=typeof Array?Array:void 0,"categories"in i?i.categories:"undefined"!=typeof categories?categories:void 0),n}class ur extends n{render(e){const t=document.createElement("div");return t.innerHTML=dr({categories:e.map((e=>({content:e,color:be()})))}),t.firstChild}}class pr extends r{constructor(e,t,n,r){super(),this.view=new ur,this.setSelection=t,this.clearSelection=n,this.getCurrentSelection=e,this.unsubscribes.push(me.subscribe(r,(e=>{this.markSelectedCategory(e)})))}render(){super.render(),this.root=this.view.render($t);const e=this.root.querySelector("div.tags");return this.root.querySelectorAll("div.tags__tag-content").forEach((e=>{e.addEventListener("click",(({target:e})=>{const t=this.getCurrentSelection();e.innerHTML===t?me.dispatch(this.clearSelection()):me.dispatch(this.setSelection(e.textContent))})),e.textContent.trim()===this.getCurrentSelection()&&e.classList.add("categories__choosen")})),this.root.querySelector("input.categories__search-input").oninput=t=>{const n=t.target.value.trim().toLocaleLowerCase();""!=n?e.childNodes.forEach((e=>{const t=e.lastChild,r=t.textContent.toLocaleLowerCase().indexOf(n);-1==r?(t.parentElement.style.display="none",t.innerHTML=t.textContent):(t.parentElement.style.display="",t.innerHTML=((e,t,n)=>e.slice(0,t)+'<span class="categories__mark">'+e.slice(t,t+n)+"</span>"+e.slice(t+n))(t.textContent,r,n.length))})):e.childNodes.forEach((e=>{const t=e.lastChild;t.parentElement.style.display="",t.innerHTML=t.textContent}))},this.root}markSelectedCategory(e){const t=this.root.querySelector("div.tags");t?t.childNodes.forEach((t=>{t.classList.remove("categories__choosen"),t.innerText===e&&t.classList.add("categories__choosen")})):console.warn("{CategoryChoiceBar} component hasn't been rendered yet")}}function gr(e=new Date){const t=e=>e<10?"0"+e:e;return[t(e.getHours()),t(e.getMinutes())].join(":")+" "+[t(e.getDate()),t(e.getMonth()+1),e.getFullYear()].join("/")}class hr extends n{constructor(e,t,n,r){super(),this.innerComponents={categoryChoiceBar:new pr(e,t,n,r)},this.root=null,this.tagBox=null,this.previewBox=null,this.textAreaInput=null,this.titleInput=null,this.category=null}render(e){const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r={};return function(e){n=n+'<div class="article-create"><div class="article-create__title">Создание статьи</div><form class="article-create__form"><div class="article-create__category_selector"><div class="article-create__row"><div class="article-create__label">Выберите категорию</div></div></div><div class="article-create__right"><button class="btn_color-elementary article-create__del-btn">Удалить</button><button class="btn_color-elementary article-create__clear-btn">Очистить</button></div><div class="article-create__rows"><div class="article-create__row"><div class="article-create__label">Заголовок</div><div class="article-create__field"><input class="article-create__input" type="text" name="title"/></div></div><div class="article-create__row"><div class="article-create__label">Текст статьи</div><div class="article-create__field"><textarea class="article-create__input article-create__text" name="text"></textarea></div></div><div class="article-create__row"><div class="article-create__label">Теги</div><div class="article-create__tags-actions"><input class="article-create__input-tag" type="text" name="tag" maxlength="20"/><button class="article-create__add-tag">+</button></div><div class="article-create__tags">'+(null==(t=e)?"":t)+'</div></div></div><div class="article-create__right"><input class="btn_color-elementary" type="file" name="photo" value="Заставка"/><input class="btn_color-elementary" type="button" name="clear-photo" value="Удалить картинку"/></div><div class="article-create__preview"><div class="article-create__preview__title">Предпросмотр:</div><div class="article-create__preview__content"></div><div class="article-create__tags-actions"></div></div><div class="article-create__right"><input class="btn_color-elementary" type="submit" name="btn-submit" value="Создать"/></div></form></div>'}.call(this,"tags"in r?r.tags:"undefined"!=typeof tags?tags:void 0),n}(),this.category=t.firstChild.querySelector(".article-create__category_selector"),this.category.querySelector(".article-create__row").appendChild(this.innerComponents.categoryChoiceBar.render()),t.firstChild.querySelector(".plate").className="article-create__category_selector",this.previewBox=t.firstChild.querySelector(".article-create__preview__content"),this.previewBox.innerHTML=sn({id:"-preview",datetime:gr(),category:"категория не выбрана",author:e,comments:"",likes:""}).replace("card","article-create__preview__card").replace(/style=".*\n.*\n.*\n.*;"/,""),this.tagBox=this.previewBox.querySelector(".tags"),this.textAreaInput=t.firstChild.querySelector("textarea"),this.titleInput=t.firstChild.querySelector('input[name="title"]'),this.root=t.firstChild,t.firstChild}appendTag(e,t){if(null===this.tagBox)return void console.warn("{Editor} component hasn't been rendered yet");const n=document.createElement("div");n.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="tags__tag-content"'+nr("style",or(`background-color: ${e}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=r)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+nr("style",or(`background-color: ${e}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=r)?"":t)+"</div>",n+="</div>"}.call(this,"color"in r?r.color:"undefined"!=typeof color?color:void 0,"content"in r?r.content:"undefined"!=typeof content?content:void 0,"cross"in r?r.cross:"undefined"!=typeof cross?cross:void 0),n}({content:e,color:be(),cross:!0});const r=n.firstChild;r.querySelector(".tags__tag__del-btn").addEventListener("click",(e=>{t(),r.remove()})),this.tagBox.appendChild(r)}clearTags(){null!==this.tagBox?this.tagBox.innerHTML="":console.warn("{Editor} component hasn't been rendered yet")}changePreviewImage(e){null!==this.previewBox?this.previewBox.querySelector(".article-create__preview__card").style.cssText=function(e){return`background: -webkit-gradient(linear, left top, left bottom,from(rgba(0, 0, 0, 0.7)), to(rgba(0, 0, 0, 0.7))), url(${e});background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),url(${e});\n  background-size: cover;\n  background-repeat: no-repeat;`}(e):console.warn("{Editor} component hasn't been rendered yet")}clearPreviewImage(){this.previewBox.querySelector(".article-create__preview__card").style.cssText=""}changePreviewText(e){null!==this.previewBox?(e=e.slice(0,350),this.previewBox.querySelector(".card__description").textContent=e):console.warn("{Editor} component hasn't been rendered yet")}changePreviewTitle(e){null!==this.previewBox?this.previewBox.querySelector(".preview__title").textContent=e:console.warn("{Editor} component hasn't been rendered yet")}changePreviewCategory(e){null!==this.previewBox&&null!==this.root?""===e?(this.previewBox.querySelector(".card__category").textContent="категория не выбрана",this.root.querySelector(".article-create__label").innerHTML="Выберите категорию | <strong>категория не выбрана</strong>"):(this.previewBox.querySelector(".card__category").textContent=e,this.root.querySelector(".article-create__label").innerHTML=`Выберите категорию | <strong>${e}</strong>`):console.warn("{Editor} component hasn't been rendered yet")}setContent(e,t){null!==this.textarea&&null!==this.titleInput?(this.textAreaInput.value=t,this.titleInput.value=e,this.changePreviewText(t),this.changePreviewTitle(e)):console.warn("{Editor} can't use setContent: component hasn't been rendered yet")}}class mr extends r{constructor(){super(),this.view=new hr((()=>{const e=me.getState().editor;return e[e.currentId]?.category||""}),Pt,Dt,z),this.unsubscribes.push(me.subscribe(j,(()=>{this.clear()})),me.subscribe(G,(()=>{this.clear()})),me.subscribe(B,(()=>{this.changeToCreate(),this.setContent(me.getState().editor[0])})),me.subscribe(H,(({id:e})=>{this.changeToUpdate(),this.setContent(me.getState().editor[e])})),me.subscribe(z,(e=>{this.view.changePreviewCategory(e)})))}render(){super.render(),this.root=this.view.render(me.getState().authorization),me.getState().editor[me.getState().editor.currentId]||me.dispatch(At());const e=me.getState().editor;this.setContent(e[e.currentId]),"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId?this.changeToUpdate():this.changeToCreate(),e[e.currentId].tags.forEach((e=>{this.view.appendTag(e,(()=>me.dispatch(Rt(e))))}));const t=this.root.querySelector("input.article-create__input-tag");this.root.querySelector(".article-create__add-tag").addEventListener("click",(e=>{e.preventDefault();const n=t.value.trim().replace(/\s+/g,"_"),r=me.getState().editor;""===n||r[r.currentId].tags.includes(n)||(me.dispatch(It(n)),this.view.appendTag(n,(()=>me.dispatch(Rt(n)))),t.value="")}));const n=this.root.querySelector("textarea"),r=this.root.querySelector('input[name="title"]'),i=e=>{const t=r.value,i=n.value;me.dispatch(Tt(me.getState().editor.currentId,{title:t,text:i}))};return n.addEventListener("change",i),r.addEventListener("input",i),n.addEventListener("input",(e=>{this.view.changePreviewText(n.value)})),r.addEventListener("input",(e=>{const t=r.value;this.view.changePreviewTitle(t)})),this.root.querySelector(".article-create__clear-btn").addEventListener("click",(e=>{e.preventDefault(),Fn.confirm("Вы собираетесь очистить всё","Продолжив, Вы безвозвратно сотрете то, что написали",(()=>{this.clear()}))})),this.root.querySelector(".article-create__del-btn").addEventListener("click",(e=>{e.preventDefault(),Fn.confirm("Точно хотите удалить?","Продолжив, вы удалите статью",(()=>{ke({url:`/articles/delete?id=${me.getState().editor.currentId}`,body:{}}).then((({status:e,response:t})=>e===Ae.ok?(me.dispatch(Ot(me.getState().editor.currentId)),Fn.informativeMsg("Успех!","Статья была удалена"),void redirect("/profile")):e===Ae.invalidSession?(me.dispatch(st()),void Fn.signup(!1)):void Fn.netOrServerError(e,t.msg)))}))})),this.root.querySelector("form").addEventListener("submit",(e=>{e.preventDefault();const t=this.root.querySelector("textarea")?.value.trim(),n=this.root.querySelector('input[name="title"]')?.value.trim();if(!t||!n||""===t||""===n)return console.warn("{Editor} пустые статьи - это плохо:",{text:t},{title:n}),void Fn.informativeMsg("Ошибка","Заголовок и текст статьи не должны быть пустыми");const r=me.getState().editor,i=function(){const e=me.getState().editor;return"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId}(),o=r[r.currentId].category;if(""===r[r.currentId].category)return void Fn.informativeMsg("Ошибка","Не забудьте указать одну из категорий, наиболее точно описывающую Вашу статью");const s={title:n,text:t,category:o,tags:r[r.currentId].tags};i&&Object.assign(s,{id:r.currentId});let a=0;fe(r[r.currentId].img).then((e=>Te({url:"/img/upload",body:e}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data.imgId):(a=e,r(new Error(t.msg)))})))).catch((e=>new Promise(((t,n)=>{0===a?t(""):n(e)})))).then((e=>ke({url:"/articles/"+(i?"update":"create"),body:{...s,img:e}}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data):(a=e,r(new Error(t.msg)))})))).then((e=>{me.dispatch(kt(e)),Fn.informativeMsg("Успех!","Статья успешно "+(i?"изменена":"создана")),redirect(`/article/${i?r.currentId:e}`)})).catch((({message:e})=>{if(a===Ae.invalidSession)return me.dispatch(st()),void Fn.signup(!1);console.warn(e),Fn.netOrServerError(a,e)}))})),this.root.querySelector('input[name="photo"]').addEventListener("change",(e=>{const t=e.currentTarget.files[0];t.type.startsWith("image/")?_e(t).then((e=>{this.view.changePreviewImage(e),me.dispatch(Nt(e))})):Fn.warn("Ошибка","Выберите изображение")})),this.root.querySelector('input[name="clear-photo"]').addEventListener("click",(e=>{e.preventDefault(),this.view.clearPreviewImage(),me.dispatch(qt())})),this.root}setContent({title:e,text:t,img:n,category:r}){(e||t)&&console.log("{EDITOR} set content"),this.view.setContent(e,t),this.view.changePreviewCategory(r),n&&(""!==n?this.view.changePreviewImage(n):this.view.clearPreviewImage())}clear(){console.log("{EDITOR} clear"),this.setContent({title:"",text:"",img:"",category:""})}changeToCreate(){const e=this.root.querySelector('input[name="btn-submit"]');e?(e.value="Создать",this.root.querySelector(".article-create__title").textContent="Создание статьи",this.root.querySelector(".article-create__del-btn").style.display="none",this.view.category.style.display="flex"):console.warn("{Editor} can't use changeToCreate:\n          component hasn't been rendered yet")}changeToUpdate(){const e=this.root.querySelector('input[name="btn-submit"]');e?(e.value="Изменить",this.root.querySelector(".article-create__title").textContent="Изменение статьи",this.root.querySelector(".article-create__del-btn").style.display="flex",this.view.category.style.display="none"):console.warn("{Editor} can't use changeToCreate:\n          component hasn't been rendered yet")}}class vr extends e{constructor(e){super(e),this.pageComponents={editor:new mr}}render(){super.render(),this.root.appendChild(Bt("",this.pageComponents.editor))}}function fr(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=_r(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function _r(e){var t=""+e,n=yr.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var yr=/["&<>]/;class br extends n{constructor(){super()}render(e){const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i,o,s,a,c,l,d,u,p){n+='<div class="article-view"><div class="article-view__content"><div class="article-view__top"><a class="article-view__back-btn" id="article-change-btn" style="display:none">Изменить</a><a class="article-view__back-btn" data-section="back">Назад</a></div><div class="article-view__author-time">',"object"==typeof r?n=n+'<div class="article-view__author"> <a'+fr("href",`/user/${r.login}`,!0,!1)+">"+_r(null==(t=r.login)?"":t)+"</a></div>":n+='<div class="article-view__author">Ошибка</div>',n=n+'<div class="article-view__time">'+_r(null==(t=s)?"":t)+'</div><div class="article-view__category"><a'+fr("href",`/categories/${i}`,!0,!1)+">"+_r(null==(t=i)?"":t)+'</a></div></div><div class="article-view__title">'+_r(null==(t=p)?"":t)+'</div><div class="article-view__info"><div class="article-view__tags">',e.isArray(d)&&function(){var e=d.length?d:[""];if("number"==typeof e.length)for(var r=0,i=e.length;r<i;r++){var o=e[r];n=n+'<a class="article-view__tag">'+_r(null==(t=o)?"":t)+"</a>"}else for(var r in i=0,e)i++,o=e[r],n=n+'<a class="article-view__tag">'+_r(null==(t=o)?"":t)+"</a>"}.call(this),n=n+'</div><div class="action-btns"><div class="icon action-btns_m-right"><div class="icon__text">'+_r(null==(t=a||"")?"":t)+'</div><div class="action-btns__likes-icon icon__img"></div></div><div class="icon action-btns_m-right"><div class="icon__text">'+_r(null==(t=o||"")?"":t)+'</div><div class="action-btns__comments-icon icon__img"></div></div><div class="icon"><div class="action-btns__share-icon icon__img"></div></div></div></div></div><img class="article-view__main-picture"'+fr("src",`${l}`,!0,!1)+'/><div class="article-view__content"><div class="article-view__text">'+_r(null==(t=u)?"":t)+'</div><div class="article-view__add-comment"><input class="article-view__comment-input" type="text" name="answer"'+fr("placeholder",`${c||""}`,!0,!1)+'/><button class="action-btns__send-icon icon__img article-view__send-comment-btn"></button></div><div class="comments-show"><button class="action-btns__arrow-icon icon-small__img comments-show__btn rotate-180"></button><div class="comments-show__text">Скрыть комментарии</div></div><div class="comments" id="comments"></div></div></div>'}.call(this,"Array"in r?r.Array:"undefined"!=typeof Array?Array:void 0,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"category"in r?r.category:"undefined"!=typeof category?category:void 0,"comments"in r?r.comments:"undefined"!=typeof comments?comments:void 0,"datetime"in r?r.datetime:"undefined"!=typeof datetime?datetime:void 0,"likes"in r?r.likes:"undefined"!=typeof likes?likes:void 0,"message"in r?r.message:"undefined"!=typeof message?message:void 0,"previewUrl"in r?r.previewUrl:"undefined"!=typeof previewUrl?previewUrl:void 0,"tags"in r?r.tags:"undefined"!=typeof tags?tags:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}(e),t.firstChild}}function wr(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Sr(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Sr(e){var t=""+e,n=Er.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Er=/["&<>]/;function Lr(e){var t,n="",r=e||{};return function(e,r,i,o,s,a,c){n=n+'<div class="comment"'+wr("id",`${o}`,!0,!1)+wr("data-author",`${r.login}`,!0,!1)+'><div class="comment__content"><img class="comment__author-photo"'+wr("src",`${r.avatarUrl}`,!0,!1)+'/><div class="comment__description"><div class="comment__author-name">'+Sr(null==(t=r.lastName)?"":t)+" "+Sr(null==(t=r.firstName)?"":t)+'</div><div class="comment__text">'+Sr(null==(t=c)?"":t)+'</div></div></div><div class="comment__bottom"><div class="action-btns">',n=(n=s?n+'<div class="comment__time">изменено '+Sr(null==(t=i)?"":t)+"</div>":n+'<div class="comment__time">'+Sr(null==(t=i)?"":t)+"</div>")+'<button class="comment__edit-btn" style="display: none">Изменить</button><button class="comment__answer-btn">Ответить</button><div class="icon-small action-btns_m-right"><div class="icon-small__text">'+Sr(null==(t=a)?"":t)+'</div><div class="action-btns__likes-icon icon-small__img"></div></div></div></div><div class="comment__answers">'+(null==(t=e)?"":t)+"</div></div>"}.call(this,"answers"in r?r.answers:"undefined"!=typeof answers?answers:void 0,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"datetime"in r?r.datetime:"undefined"!=typeof datetime?datetime:void 0,"id"in r?r.id:"undefined"!=typeof id?id:void 0,"isEdited"in r?r.isEdited:"undefined"!=typeof isEdited?isEdited:void 0,"likes"in r?r.likes:"undefined"!=typeof likes?likes:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0),n}var Cr=/["&<>]/;function Ar(e){var t="",n=e||{};return function(e){t=t+'<div class="article-view__add-comment"><input class="article-view__comment-input" type="text" name="answer"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=Cr.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("placeholder",`${e||""}`,!0,!1)+'/><button class="action-btns__send-icon icon__img article-view__send-comment-btn"></button></div>'}.call(this,"message"in n?n.message:"undefined"!=typeof message?message:void 0),t}function xr(e,t){const n=e.querySelector(".comment__edit-btn");n.style.display="block",n.addEventListener("click",(n=>{n.preventDefault(),Tr(e,"изменение комментария",t,!1,(n=>{let r=0;ke({url:"/comments/update",body:{text:n,id:t.id}}).then((({status:e,response:t})=>new Promise(((n,i)=>{e===Ae.ok?n(t.data):(r=e,i(new Error(t.msg)))})))).then((n=>{n=Ne(n,me.getState().authorization),e.innerHTML=Lr(n),me.dispatch(Yt(t.id,n.text))})).catch((e=>{0!==r?Fn.netOrServerError(r,e.message):console.warn(e.message)}))}))}))}function kr(e,t,n){e.querySelectorAll(".comment__answer-btn").forEach((r=>r.addEventListener("click",(r=>{r.preventDefault(),Tr(e,"ответ на комментарий",n,!0,(r=>{let i=0;ke({url:"/comments/create",body:{text:r,parentId:n.id,articleId:parseInt(t,10)}}).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data):(i=e,r(new Error(t.msg)))})))).then((r=>{const i=document.createElement("div");r=Ne(r),i.innerHTML=Lr(r),xr(i,r),kr(i,t,r),e.querySelector(".comment__answers").appendChild(i),me.dispatch(Zt(n.id,r))})).catch((e=>{0!==i?Fn.netOrServerError(i,e.message):console.warn(e.message)}))}))}))))}function Tr(e,t,n,r,i){const o=document.createElement("div");o.innerHTML=Ar({message:t});const s=o.firstChild;s.classList.add("comment-answer-input");const a=s.querySelector("input");r||(a.value=n.text);const c=()=>{const t=a.value.trim();if(t!==n.text&&""!==t){i(t);try{e.removeChild(s)}catch{}}},l=s.querySelector(".article-view__send-comment-btn");l.addEventListener("click",(e=>{e.preventDefault(),c()})),e.appendChild(s);const d=t=>{e.removeChild(s)};a.addEventListener("focusout",d),l.addEventListener("mouseover",(e=>a.removeEventListener("focusout",d))),l.addEventListener("mouseout",(e=>a.addEventListener("focusout",d))),a.addEventListener("keydown",(({keyCode:e,target:t})=>{13===e&&c()})),a.focus()}class Or extends r{constructor(){super(),this.view=new br,this.unsubscribes.push(me.subscribe(Z,(e=>{const t=me.getState().reader;this.openArticle(t[e])})),me.subscribe(X,(({id:e,comments:t})=>{me.getState().reader.currentId===e&&this.setComments(t)})),me.subscribe(s,(()=>{const e=this.root.querySelector("#article-change-btn");if(!e)return void console.warn("{READER} component hasn't been rendered yet");this.root.querySelector("div.article-view__author > a").textContent===me.getState().authorization.login&&(e.style.display="block",e.href="/editor",e.addEventListener("click",Rr));const t=me.getState().reader;this.setComments(t[t.currentId].commentsContent)})),me.subscribe(a,(()=>{const e=this.root.querySelector("#article-change-btn");e?(e.style.display="none",e.href=void 0,e.removeEventListener("click",Rr)):console.warn("{READER} component hasn't been rendered yet")})))}render(){super.render();const e=me.getState().reader;return this.root=this.view.render(e[e.currentId]),Ir(this.root),this.root}openArticle(e){this.root.innerHTML="",this.view.render(e).childNodes.forEach((e=>{this.root.appendChild(e.cloneNode(!0))})),Ir(this.root);const t=me.getState().authorization.login;if(e.author.login===t){const e=this.root.querySelector("#article-change-btn");e.style.display="block",e.href="/editor"}}setComments(e){const t=this.root.querySelector("#comments");t.innerHTML="",e.forEach((e=>{const n=document.createElement("div");let r="";e.answers.forEach((e=>{"answers"in e&&(console.warn("Не должно быть вложенности более 1"),delete e.answers),r+=Lr(e)})),n.innerHTML=Lr({...e,answers:r});const i=n.firstChild;kr(i,me.getState().reader.currentId,e);const o=me.getState().authorization.login;o===e.author.login&&xr(i,e),i.querySelector(".comment__answers").querySelectorAll(`div[data-author="${o}"]`).forEach((t=>{const n=e.answers.filter((e=>e.id+""===t.id))[0];xr(t,n)})),t.appendChild(i)}))}}function Ir(e){e.querySelector(".article-view__send-comment-btn").addEventListener("click",(t=>{t.preventDefault(),function(e){if(!me.getState().authorization.isAuthenticated)return void Fn.warn("Сначала авторизируйтесь","Чтобы оставить комментарий, выполните вход");const t=e.querySelector("input.article-view__comment-input");if(""!=t.value.trim()){let n=0;const r=me.getState().reader.currentId;ke({url:"/comments/create",body:{articleId:parseInt(r,10),parentId:0,text:t.value.trim()}}).then((({status:e,response:t})=>new Promise(((r,i)=>{e===Ae.ok?r(t.data):(n=e,i(new Error(t.msg)))})))).then((t=>{t=Ne(t);const n=document.createElement("div");n.innerHTML=Lr(t);const i=n.firstChild;kr(i,r,t),xr(i,t),me.dispatch(Kt(t)),e.querySelector(".comments").appendChild(i)})).catch((e=>{0!==n?Fn.netOrServerError(n,e.message):console.warn(e.message)}))}}(e)})),e.querySelector(".comments-show").addEventListener("click",(t=>{t.preventDefault(),function(e){let t=!0;const n=e.querySelector(".comments"),r=e.querySelector(".comments-show__text"),i=e.querySelector(".comments-show__btn");i.classList.contains("rotate-180")?(r.innerText="Показать комментарии",i.classList.remove("rotate-180"),t=!0):(r.innerText="Скрыть комментарии",i.classList.add("rotate-180"),t=!1),t?n.classList.add("hide"):n.classList.remove("hide")}(e)}));const t=e.querySelectorAll(".comments__comment");for(const e of t)answerOnComment(e)}const Rr=e=>{e.preventDefault();const t=me.getState().reader,n=t[t.currentId];me.dispatch(xt(n.id,n))};class Nr extends e{constructor(e){super(e),this.pageComponents={reader:new Or}}render(){super.render(),this.root.appendChild(Bt("",this.pageComponents.reader))}}const qr=function(){return{type:L}},Pr=function(){return{type:C}},Dr=function(){return{type:S}},$r=function(){return{type:E}},Mr=function(e,t){return t.forEach((e=>{Ie(e),Ie(e.author)})),{type:b,payload:{idLastLoaded:e,cards:t}}},Ur=function(){return{type:w}},Fr=function(e){return{type:A,payload:e}},Hr=function(){return{type:A,payload:""}};class Br extends e{constructor(e){super(e),this.pageComponents={categoryChoose:new pr((()=>me.getState().categoryPage.currentCategory),Fr,Hr,A),feed:new Qt(an,"categoryPage",b,w,S,E,Dr,(()=>(console.log("{CategoryPage feed} isEndFound is not been reset"),{type:"__EMPTY__"})))}}render(){super.render(),this.root.appendChild(Bt("Поиск по категориям",this.pageComponents.categoryChoose,this.pageComponents.feed))}}function Jr({currentTarget:e}){const t=me.getState().categoryPage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>we()||(console.log("[Category Page] scroll trigger"),me.dispatch(Gr))}async function Gr(){const e=me.getState().categoryPage;e.isEndFound||e.isLoading?console.log("[Category Page] Can't load articles on as isEndFound state flag is true"):(me.dispatch(qr()),await xe({url:`/articles/category?idLastLoaded=${e.idLastLoaded}&category=${e.currentCategory}`}).then((({status:t,response:n})=>{if(t===Ae.ok)return r=n.data,console.log("[Category Page] more news loaded!"),void me.dispatch(Mr(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;t/500==1&&bn.setTitle(`Сервис временно не доступен: ${t}`),t/400==1&&bn.setTitle(`Ошибка ${t}`),bn.setContent(n.msg),bn.open(!1)})).catch((e=>console.warn(e.message))),me.dispatch(Pr()))}class jr extends t{constructor(e){super(e),this.view=new Br(e),me.subscribe(A,(e=>{""!==e&&(me.dispatch(Ur()),me.dispatch($r()),Gr()),history.pushState(null,"","/categories"+(""!==e?"/"+e:"")),me.dispatch(at("categories",`SaberProject |\n              ${""!==e?e.charAt(0).toUpperCase()+e.slice(1):"Categories"}`))})),me.subscribe(G,(()=>{me.dispatch(Ur())}))}show(){super.show();const e=document.querySelector(".content");e?e.addEventListener("scroll",Jr):console.warn("[Category Page] нет дивака .content")}hide(){super.hide();const e=document.querySelector(".content");e?e.removeEventListener("scroll",Jr):console.warn("[Category Page] нет дивака .content")}isActive(){let e="";const t=document.URL.indexOf("categories/");if(-1!==t){try{e=decodeURI(document.URL.slice(t+11))}catch(e){console.error(e)}console.log("[CategoryPage] (isActive) category from Url:",e),me.dispatch(Fr(e))}else-1!==document.URL.indexOf("categories")&&me.dispatch(Hr());return""===me.getState().categoryPage.currentCategory&&me.dispatch(Dr()),super.isActive()}}class Wr extends e{constructor(e){super(e),this.formDiv=null,this.changeFormTypeBtn=null}render(){super.render();const e=document.createElement("div");e.className="background-space";const t=document.createElement("div");t.className="page-space";const n=document.createElement("div");n.className="content-space";const r=document.createElement("div"),i=document.createElement("a");i.innerHTML="SaberNews",i.className="header__title",i.href="/",i.style.cssText="position: absolute;";const o=document.createElement("a");o.textContent="Создать аккаунт",o.dataset.router="ignore",r.appendChild(new Dn(!1).render()),this.formDiv=r,this.changeFormTypeBtn=o,n.appendChild(r),n.appendChild(o),t.appendChild(i),t.appendChild(n),e.appendChild(t),this.root.appendChild(e)}switchFormType(e){this.formDiv&&this.changeFormTypeBtn?(this.formDiv.innerHTML="",this.formDiv.appendChild(new Dn(e).render()),this.changeFormTypeBtn.textContent=e?"У меня уже есть аккаунт":"Создать аккаунт"):console.warn("[SignupPage] was not rendered yet")}}function Vr(e,t){0!==t.length&&("login"in t[0]?t.forEach((t=>{Ie(t);const n=document.createElement("div");n.innerHTML=Cn({...t,disableArticles:!0}),e.appendChild(n.firstChild)})):an(e,t))}class zr extends e{constructor(e){super(e),this.pageComponents={feed:new Qt(Vr,"search",x,k,T,O,Me,(()=>(console.log("{SearchPage feed} isEndFound is not been reset"),{type:"__EMPTY__"})))}}render(){super.render(),this.root.appendChild(Bt("",this.pageComponents.feed))}}function Yr({currentTarget:e}){const t=me.getState().search,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>we()||(console.log("[Search Page] scroll trigger"),me.dispatch(Zr))}async function Zr(){const e=me.getState().search;e.isEndFound||e.isLoading?console.log("[Search Page] can't load news asisEndFound state flag is true"):(me.dispatch(De()),await xe({url:`/search/${e.group}?q=${e.value||""}&idLastLoaded=${e.idLastLoaded||""}`}).then((({status:e,response:t})=>{if(e===Ae.ok)return n=t.data,console.log("[Search Page] more news loaded!"),n.forEach((e=>{"login"in e&&(e.id=e.login)})),void me.dispatch(qe("",n));var n;e/500==1&&bn.setTitle(`Сервис временно не доступен: ${e}`),e/400==1&&bn.setTitle(`Ошибка ${e}`),bn.setContent(t.msg),bn.open(!1)})).catch((e=>console.warn(e.message))),me.dispatch($e()))}const Kr={};function Xr(e){const{target:t}=e;if("outer"!==t.dataset.router&&("ignore"===t.dataset.router&&(e.preventDefault(),console.log("[linkController]",{target:t},"ignored")),t instanceof HTMLAnchorElement)){e.preventDefault(),console.log({targeter:t.dataset.section});const n=Kr[t.dataset.section]?.props,r=Kr[t.dataset.section]?.action;"function"==typeof r&&r.call(null,n)}}class Qr extends n{render(){const e=document.createElement("div");return e.style="\n    display: none;\n\n    position:fixed; \n    box-sizing: border-box;\n    border-radius: 5px;\n    padding: 5px;\n    top: 105px;\n    left: 20px;\n    background-color: #dee4ea;\n    color: red;\n    font-weight: bold;\n    ",e}}const ei=new class extends r{constructor(){super(),this.view=new Qr}render(){return super.render(),this.root=this.view.render(),this.root}setMessage(e){this.root.innerHTML=e}getMessage(){return this.root.innerHTML}show(e){this.root.style.display="block",e&&(this.root.innerHTML=e)}hide(){this.root.style.display="none"}};document.getElementById("warningroot").appendChild(ei.render());const ti={show(e){ei.show(e)},hide(){ei.hide()},setMessage(e){ei.setMessage(e)},getMessage:()=>ei.getMessage(),init(){me.subscribe($,(()=>ti.show("Сервис недоступен"))),me.subscribe(M,(()=>{"Сервис недоступен"===ti.getMessage()&&(ti.setMessage(""),ti.hide())}))}},ni=ti,ri=[],ii={upload(e){ri.push(...e);for(let t=0;t<e.length;t++){const n=new Image;n.onload=()=>{const e=ri.indexOf(n);-1!==e&&ri.splice(e,1)},ri.push(n),n.src=e[t]}}};function oi(){return ke({url:"/",body:{}}).then((({status:e,response:t})=>{e===Ae.ok&&me.dispatch(ot(t.data)),me.dispatch(Lt())})).catch((e=>{console.warn("[AJAX]",e.message),me.dispatch(Ct()),me.dispatch(((e,t)=>{setTimeout(oi,3e4)}))}))}const si=function(e){return e.forEach((e=>{Ie(e.author)})),{type:P,payload:e}},ai=new WebSocket("ws://89.208.197.247:8081/api/v1/ws");ai.onopen=function(e){console.log("webSocket: Соединение установлено")},ai.onmessage=function(e){console.log(`webSocket: Данные получены с сервера: ${e.data}`);let t="";try{t=JSON.parse(e.data)}catch(e){return void console.warn(e.message)}(t.type="stream-comment")&&function(e){Ie(e.author),me.dispatch(si([e]))}(t)},ai.onclose=function(e){e.wasClean?console.log(`webSocket: Соединение закрыто чисто,       код=${e.code} причина=${e.reason}`):console.warn("Соединение прервано")},ai.onerror=function(e){console.warn(`webSocket: error: ${e.message}`)},ii.upload(["static/img/background-space.png","static/img/background.png","static/img/icons/cross.svg","static/img/icons/eye-closed.svg","static/img/icons/eye-open.svg","static/img/icons/key.svg","static/img/icons/mail.svg","static/img/icons/username.svg","static/img/icons/like.svg","static/img/icons/like_hover.svg","static/img/icons/comment.svg","static/img/icons/comment_hover.svg","static/img/icons/share.svg","static/img/icons/share_hover.svg","static/img/icons/trash.svg","static/img/icons/trash_hover.svg","static/img/icons/search.svg","static/img/icons/search_hover.svg","static/img/icons/send.svg"]),navigator,console.warn("ServiceWorker is unable in navigator");const ci=document.getElementById("root"),li=new class{constructor(e){this.routes={},this.routesPatterned=[],this.root=e}register(e,t){for(const n in this.routes)if(this.routes[n].PageClass===t)return console.warn(`[ROUTER] paths ${n} and ${e} point to the same ${t.name}`),this.routes[e]=this.routes[n],this;return this.routes[e]={PageClass:t,page:null,root:null},this}registerPattern(e,t){e=e.slice(0,e.indexOf("<")),this.routesPatterned.push(e);for(const n in this.routes)if(this.routes[n].PageClass===t)return console.warn(`[ROUTER] paths ${n} and ${e} point to the same ${t.name}`),this.routes[e]=this.routes[n],this;return this.routes[e]={PageClass:t,page:null,root:null},this}open(e){let t=e;this.routesPatterned.forEach((e=>{t.startsWith(e)&&(console.log(`[ROUTER] ${t} matched pattern ${e}`),t=e)}));const n=this.routes[t];if(!n)return console.warn("[ROUTER] путь",t,"не зарегистрирован"),void this.open("/");let{PageClass:r,page:i,root:o}=n;o||(o=document.createElement("section"),o.className="view",this.root.appendChild(o)),i||(i=new r(o),console.warn("[ROUTER] создал вьюху",i));const s=i.redirect(window.location.pathname);if(""!==s)return console.warn("[ROUTER]",i.constructor.name+" | redirectRoute: "+s),this.open(s),void(this.routes[t]={PageClass:r,page:i,root:o});window.location.pathname!==e&&window.history.pushState(null,"",e),console.log("[ROUTER] !page.isActive():",!i.isActive()),i.isActive()||(Object.values(this.routes).forEach((({page:e})=>{e&&e.isActive()&&e.hide()})),i.show()),this.routes[t].page=i,this.routes[t].root=o}start(){me.subscribe(ne,(e=>{this.open(e)})),this.root.addEventListener("click",(e=>{const t=e.target;if(!(t instanceof HTMLAnchorElement||"ignore"===t.dataset.router)||"outer"===t.dataset.router)return;console.warn("[ROUTER]",{target:t}),e.preventDefault();const n=t.pathname||t.parentElement.pathname;console.warn("link:",n),console.log({pathname:n||"[ROUTER] empty path (ignored)"}),n&&this.open(n)})),window.addEventListener("popstate",(()=>{const e=window.location.pathname;this.open(e)}));const e=window.location.pathname;console.log("[ROUTER] start page:",e),this.open(e)}}(ci),di=new class{constructor(e){this.root=e,this.enabled=!1}register(e,t=(()=>{}),n=null){return Kr[e]={action:t,props:n},this}enable(){this.enabled||(this.enabled=!0,this.root.addEventListener("click",Xr))}disable(){this.enabled&&(this.enabled=!1,this.root.removeEventListener("click",Xr))}}(ci),ui=new class{constructor(){this.progressValue=0,this.root=document.createElement("div"),this.root.className="background",this.root.innerHTML=function(e){var t="",n=e||{};return function(e){t=t+'<div class="loading-page"><div class="loading-page__title">Загрузка</div><progress class="progress__loading"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=tr.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("value",`${e}`,!0,!1)+' max="100"></progress></div>'}.call(this,"progressValue"in n?n.progressValue:"undefined"!=typeof progressValue?progressValue:void 0),t}({progressValue:this.progressValue}),this.progressBar=this.root.querySelector("progress"),this.animationId=0}async start(){const e=document.getElementById("root");e.innerHTML="",e.appendChild(this.root);let t=performance.now(),n=400;const r=e=>{this.progressValue+=(e-t)*n/1e4,t=e,this.progressValue<75&&(n--,n<100&&(n=100),this.progressBar.value=this.progressValue,window.requestAnimationFrame(r))};this.animationId=window.requestAnimationFrame(r)}async end(){window.cancelAnimationFrame(this.animationId),await new Promise((e=>{let t=performance.now();const n=r=>{this.progressValue+=1e3*(r-t)/1e4,t=r,this.progressValue<100?(this.progressBar.value=this.progressValue,window.requestAnimationFrame(n)):e()};n(performance.now())})),document.getElementById("root").innerHTML=""}};ni.init(),li.register("/",class extends t{constructor(e){super(e),this.view=new cn(e),me.subscribe(G,(()=>{me.dispatch(ut())}))}show(){super.show(),me.dispatch(at("main","SaberProject")),0===me.getState().mainPage.cards.length&&me.dispatch(Sn);const e=this.view.root.querySelector(".content");e?e.addEventListener("scroll",wn):console.warn("[Main Page] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",wn):console.warn("[MainPage] нет дивака .content")}}).register("/profile",Jn).registerPattern("/user/<login>",Jn).registerPattern("/article/<id>",class extends t{constructor(e){super(e),this.view=new Nr(e)}show(){super.show(),me.dispatch(at("reader","SaberProject | Article View"));const e=document.URL.slice(document.URL.indexOf("article/")+8);console.warn("[ArticleReaderPage] id from Url ",document.URL,e),me.dispatch(Vt({id:e})),me.dispatch(Wt(e));let t=0;xe({url:`/articles?id=${e}`}).then((({status:e,response:n})=>new Promise(((r,i)=>{e===Ae.ok?r(n.data):(t=e,i(new Error(n.msg)))})))).then((e=>{me.dispatch(jt(e)),me.dispatch(Wt(e.id))})).then((()=>xe({url:`/comments?id=${e}`}))).then((({status:e,response:n})=>new Promise(((r,i)=>{e===Ae.ok?r(n.data):(t=e,i(new Error(`Комментарии загрузить не удалось\n            ${n.msg}`)))})))).then((t=>{const n=(t=t.map((e=>Ne(e)))).filter((e=>0===e.parentId));n.forEach((e=>{e.answers=t.filter((t=>t.parentId===e.id)).sort(((e,t)=>e.datetimeMS<t.datetimeMS?-1:1))})),me.dispatch(zt(e,n))})).catch((e=>{0!==t?Un(t,e.message):console.warn(e.message)}))}}).register("/profile/settings",class extends t{constructor(e){super(e),this.view=new er(e),me.subscribe(a,(()=>{this.isActive()&&(console.log("[ProfileSettingsPage] Logout reaction"),ye("/"))}))}show(){super.show();const e=this.view.root.querySelector("form");e.addEventListener("submit",(t=>{t.preventDefault();const n=e.querySelector('input[name="username"]')?.value.trim(),r=e.querySelector('input[name="surname"]')?.value.trim(),i=e.querySelector('textarea[name="description"]')?.value.trim(),o=e.querySelector('input[type="file"]')?.files[0];if(""!==n&&!qn.firstName.test(n))return void this.view.pageComponents.settingsForm.appendWarning("Такое имя выбрать нельзя");if(""!==r&&!qn.lastName.test(r))return void this.view.pageComponents.settingsForm.appendWarning("Такую фамилию выбрать нельзя");if(o&&!o.type.startsWith("image/"))return void Fn.warn("Ошибка","Выберите изображение");let s=0,a="";new Promise(((e,t)=>{o?e(o):t(new Error("Картинка не прекреплена"))})).then((()=>Te({url:"/img/upload",body:o}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data.imgId):(s=e,r(new Error(t.msg)))})))).catch((e=>new Promise(((t,n)=>{0===s?t(""):n(e)})))).then((e=>(a=e,ke({url:"/user/profile/update",body:{firstName:n,lastName:r,avatarUrl:e,description:i}})))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data):(s=e,r(new Error(t.msg)))})))).then((e=>{""!==a&&(e.avatarUrl=Oe+"/img/"+a),me.dispatch(ot(e)),Fn.informativeMsg("Успех!","Профиль обновлен"),ye("/profile")})).catch((({message:e})=>{if(s===Ae.invalidSession)return me.dispatch(st()),Fn.informativeMsg("Сессия устарела","Пройдите авторизацию"),void ye("/login");console.warn(e),"5"!==(s+"")[0]?this.view.pageComponents.settingsForm.appendWarning(msg):Fn.netOrServerError(s,e)}))})),me.dispatch(at("profileSettings",`Settings | ${me.getState().authorization.login}`))}redirect(e){return""!==me.getState().authorization.login?"":"/login"}}).register("/editor",class extends t{constructor(e){super(e),this.view=new vr(e),me.subscribe(a,(()=>{console.log("[ArticleEditorPage] Logout reaction"),this.isActive()&&Fn.warn("Вы неавторизованы","Чтобы продолжить редактирование, выполните повторный вход.\n            Текущее состояние сохранено. Не перезагружайте страницу.",(()=>ye("/")))}))}show(){super.show(),me.dispatch(at("editor",`SaberProject | ${function(){const e=me.getState().editor;return"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId}()?"Edit":"Create"} article`))}redirect(e){return me.getState().authorization.isAuthenticated?"":"/login"}}).registerPattern("/categories/<сategory>",jr).register("/categories",jr).register("/login",class extends t{constructor(e){super(e),this.view=new Wr(e),this.showRegister=!1,this.unsubscribeLogin=()=>{}}show(){super.show(),this.showRegister=!1,this.unsubscribeLogin=me.subscribe(s,(()=>{ye("/")})),this.view.changeFormTypeBtn.addEventListener("click",(e=>{e.preventDefault(),this.showRegister=!this.showRegister,this.view.switchFormType(this.showRegister)})),me.dispatch(at("signup","SaberProjects | "+(this.showRegister?"Signup":"Login")))}hide(){super.hide(),this.unsubscribeLogin()}}).register("/search",class extends t{constructor(e){super(e),this.view=new zr(e);const t=e=>{""!==e&&(me.dispatch(Pe()),me.dispatch(Ue()),Zr())};me.subscribe(N,t),me.subscribe(R,t)}show(){super.show(),me.dispatch(at("search","SaberProject | Search")),0===me.getState().search.cards.length&&me.dispatch(Zr);const e=this.view.root.querySelector(".content");e?e.addEventListener("scroll",Yr):console.warn("[Search Page] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",Yr):console.warn("[SearchPage] нет дивака .content")}isActive(){return super.isActive()}}),di.register("signupModal",Mn.show,!0).register("loginModal",Mn.show,!1).register("logout",(()=>{me.getState().authorization.isAuthenticated&&ke({url:"/user/logout",body:{}}).then((()=>me.dispatch(st())))})).register("back",(()=>window.history.back())),ui.start(),async function(){await oi(),await ui.end(),di.enable(),li.start()}()})();
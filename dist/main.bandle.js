(()=>{"use strict";class e{constructor(e){this.root=e,this.root.dataset.view=this.constructor.name,this.root.hidden=!0}isActive(){return!this.root.hidden}hide(){this.root.hidden=!0}show(){this.root.hidden=!1,this.render()}render(){this.root.innerHTML=""}}class t{constructor(t){this.view=new e(t)}isActive(){return this.view.isActive()}hide(){this.view.hide()}show(){this.view.show()}redirect(e){return""}}class n{render(){return document.createElement("div")}}class r{constructor(){this.root=document.createElement("div"),this.view=new n,this.unsubscribes=[]}render(){return document.createElement("div")}destroy(){this.view=null,this.unsubscribes.forEach((e=>{"function"==typeof e&&e()}))}}var i=/["&<>]/;class s extends n{render(){const e=document.createElement("div");return e.innerHTML='<div class="header"><a class="header__title-block" href="/"><div class="header__title" data-router="ignore">SaberNews</div></a><div class="header__content"><div class="header__nav-items"><a class="header__nav-item" data-test="test1">Популярное</a><a class="header__nav-item" data-test="test2">Новое</a><a class="header__nav-item">Подписки</a><a class="header__nav-item">Мероприятия</a><a class="header__nav-item">Группы</a></div><div class="search"><div class="search__row search__row_close" style="transition: all 0.5s;"><input class="search__input" type="text" placeholder="Найти"/><div class="search__row_group_dropdown"><input class="search__row_group_bar" type="text" placeholder="где?"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var s=typeof t;return"object"!==s&&"function"!==s||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=i.exec(t);if(!n)return e;var r,s,o,a="";for(r=n.index,s=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}s!==r&&(a+=t.substring(s,r)),s=r+1,a+=o}return s!==r?a+t.substring(s,r):a}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("readonly",!0,!0,!1)+'/><div class="search__row_group_dropdown-content"><div class="search__row_group_dropdown-item" data-search="articles">Статьи</div><div class="search__row_group_dropdown-item" data-search="author">Пользователи</div><div class="search__row_group_dropdown-item" data-search="tags">Теги</div></div></div><div class="search__row_btn"></div></div><button class="search__button search-icon"></button></div></div></div>',e.firstChild}}const o="LOGIN",a="LOGOUT",c="CHANGE_PAGE",l="CHANGE_DOC_TITLE",d="MODAL_OPEN",u="MODAL_CLOSE",p={ASK_NEW_CARDS:"ASK_NEW_CARDS",SAVE_NEW_CARDS:"SAVE_NEW_CARDS",CLEAR_CARDS:"CLEAR_CARDS",FORBID_CARDS_UPLOADING:"FORBID_CARDS_UPLOADING",ALLOW_CARDS_UPLOADING:"ALLOW_CARDS_UPLOADING",SET_LOADING_FLAG:"SET_LOADING_FLAG",UNSET_LOADING_FLAG:"UNSET_LOADING_FLAG"},h="SAVE_NEW_USER_ARTICLES",g="CLEAR_USER_ARTICLES",f="FORBID_USER_ARTICLES_UPLOADING",v="ALLOW_USER_ARTICLES_UPLOADING",m="SET_USER_ARTICLES_LOADING",_="SET_USER_INFO",y="SET_USER_LOADING",b="SAVE_NEW_CATEGORY_ARTICLES",w="CLEAR_CATEGORY_ARTICLES",S="FORBID_CATEGORY_ARTICLES_UPLOADING",E="ALLOW_CATEGORY_ARTICLES_UPLOADING",L="SET_CATEGORY_ARTICLES_LOADING",C="UNSET_CATEGORY_ARTICLES_LOADING",A="SELECT_CATEGORY",k="SAVE_NEW_CARDS_SEARCH",x="CLEAR_CARDS_SEARCH",T="FORBID_CARDS_UPLOADING_SEARCH",O="ALLOW_CARDS_UPLOADING_SEARCH",I="SET_LOADING_FLAG_SEARCH",R="SET_SEARCH_GROUP_SEARCH",N="SET_SEARCH_VALUE_SEARCH",q="ASK_NEW_COMMENTS_STREAM",D="SAVE_NEW_COMMENTS_STREAM",P="CLEAR_COMMENTS_STREAM",$="SET_UNAVAILABLE",M="SET_AVAILABLE",U="EDITOR_APPEND_TAG",H="EDITOR_REMOVE_TAG",F="EDITOR_EDIT_EXISTING_ARTICLE",B="EDITOR_CREATE_ARTICLE",j="EDITOR_SAVE_ARTICLE",J="EDITOR_PUBLISH_ARTICLE",G="EDITOR_CLEAR_ARTICLE",W="EDITOR_DELETE_ARTICLE",V="EDITOR_SAVE_PREVIEW",z="EDITOR_SAVE_CATEGORY",Y="READER_SAVE_ARTICLE",Z="READER_OPEN_ARTICLE",K="READER_SET_ARTICLE_LOADING",X="READER_SAVE_ARTICLE_COMMENTS",Q="READER_EDIT_ARTICLE_COMMENT",ee="READER_ADD_COMMENT_ANSWER",te="READER_ADD_NEW_COMMENT",ne="REDIRECT";const re={isAuthenticated:!1,login:"",avatarUrl:"",firstName:"UNAUTHORIZED",lastName:"UNAUTHORIZED",email:"UNAUTHORIZED",score:0},ie={page:"main",docTitle:"SaberProject"},se={isAuthenticated:!1,isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1},oe={user:{login:""},isLoading:!1,idLastLoaded:"",cards:[],isEndFound:!1},ae={currentCategory:"",isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1,tags:{}},ce={showRegister:!0},le={isAvailable:!0},de={currentId:0},ue={currentId:0},pe={},he={comments:[]},ge={isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1,value:"",group:"articles",description:"Статьи"},fe=function e(t,n,...r){console.log("[STORE] createStore: ",r.map((e=>e.name)));let i=t(n,{type:"__INIT__"});const s={};return 0!==r.length?function(...e){return function(t){return function(n,r){const i=t(n,r);let s=()=>{console.error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")};const o={getState:i.getState,dispatch:(e,...t)=>s(e,...t)},a=e.map((e=>e(o)));return s=function(...e){return 0===e.length?arg:1===e.length?e[0]:e.reduce(((e,t)=>e(t(...args))))}(...a)(i.dispatch),{...i,dispatch:s}}}}(...r)(e)(t,n):{dispatch(e){i=t(i,e),s[e.type]=s[e.type]||[],s[e.type].forEach((t=>{t(e.payload)}))},subscribe:(e,t)=>(s[e]=s[e]||[],s[e].push(t),function(){s[e].splice(s[e].indexOf(t))}),getState:()=>i}}(function(e){for(const t in e)"function"!=typeof e[t]&&(console.warn(`Reducers Combiner: ${t} is not a function.\n          It will not be called. It is a ${typeof e[t]}.`),delete e[t.name]);return function(t,n){t||(t={});for(const r in e){const i=e[r](t[r],n);JSON.stringify(i)!==JSON.stringify(t[r])&&(t[r],t[r]=i)}return t}}({router:function(e=pe,t){return t.type===ne?{...e}:e},authorization:function(e=re,t){switch(t.type){case o:return""===t.payload.login?(console.warn("Trying to set an empty login. LOGIN action ignored"),e):{...e,...t.payload,isAuthenticated:!0};case a:return re}return e},page:function(e=ie,t){switch(t.type){case c:return document.title=t.payload.docTitle,{...e,page:t.payload.page,docTitle:t.payload.docTitle};case l:return document.title=t.payload.docTitle,{...e,docTitle:t.payload.docTitle}}return e},mainPage:function(e=se,t){switch(t.type){case p.SET_LOADING_FLAG:return{...e,isLoading:!0};case p.FORBID_CARDS_UPLOADING:return{...e,isEndFound:!0};case p.ALLOW_CARDS_UPLOADING:return{...e,isEndFound:!1};case p.SAVE_NEW_CARDS:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case p.CLEAR_CARDS:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1}}return e},profilePage:function(e=oe,t){switch(t.type){case m:return{...e,isLoading:!0};case f:return{...e,isEndFound:!0};case v:return{...e,isEndFound:!1};case h:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case g:return{...e,cards:[],isLoading:!1,idLastLoaded:"",isEndFound:!1};case _:case y:return{...e,user:t.payload,isLoading:!1,idLastLoaded:"",cards:[],isEndFound:!1}}return e},categoryPage:function(e=ae,t){switch(t.type){case L:return{...e,isLoading:!0};case C:return{...e,isLoading:!1};case S:return{...e,isEndFound:!0};case E:return{...e,isEndFound:!1};case b:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case w:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1};case A:return{...e,currentCategory:t.payload}}return e},search:function(e=ge,t){switch(t.type){case R:return{...e,group:t.payload.group,description:t.payload.description};case I:return{...e,isLoading:!0};case N:return{...e,value:t.payload};case T:return{...e,isEndFound:!0};case O:return{...e,isEndFound:!1};case k:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case x:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1}}return e},signupForm:function(e=ce,t){return"SWITCH_FORM_TYPE"===t.type?{...e,showRegister:t.payload}:e},api:function(e=le,t){switch(t.type){case M:return{...e,isAvailable:!0};case $:return{...e,isAvailable:!1}}return e},editor:function(e=de,t){switch(t.type){case F:return{...e,[t.payload.id]:{title:t.payload.title,text:t.payload.text,tags:t.payload.tags,category:t.payload.category,img:t.payload.img},currentId:t.payload.id};case G:return{...e,[t.payload.id]:{title:"",text:"",tags:[],category:"",img:""}};case W:const n={};return Object.assign(n,e),delete n[t.payload.id],n.currentId=0,n;case B:const r=Object.assign({},e);return 0 in r||(r[0]={title:"",text:"",tags:[],category:"",img:""}),r.currentId=0,r;case j:let i={};return t.payload.id in e?Object.assign(i,e[t.payload.id]):i={title:"",text:"",tags:[],category:"",img:""},i={...i,...t.payload},delete i.id,{...e,[t.payload.id]:i};case J:return{...e,[t.payload.id]:Object.assign({},e[0]),0:{title:"",text:"",tags:[],category:"",img:""},currentId:0};case U:const s=Object.assign({},e[e.currentId]);return s.tags.push(t.payload),{...e,[e.currentId]:s};case H:const o=Object.assign({},e[e.currentId]);return o.tags=o.tags.filter((e=>e!=t.payload)),{...e,[e.currentId]:o};case V:const a={...e[e.currentId]};return a.img=t.payload,{...e,[e.currentId]:a};case z:const c={...e[e.currentId]};return c.category=t.payload,{...e,[e.currentId]:c}}return e},reader:function(e=ue,t){switch(t.type){case Y:return{...e,[t.payload.id]:{...t.payload,commentsContent:[]}};case K:return t.payload.id in e&&"Загрузка"!==e[t.payload.id].title?e:{...e,[t.payload.id]:{title:"Загрузка",tags:[],datetime:"",category:"",author:{login:"",avatarUrl:"",firstName:"",lastName:"Загрузка",score:0},likes:0,comments:0,commentsContent:[],previewUrl:"",...t.payload,text:"Загрузка..."}};case Z:return{...e,currentId:t.payload};case te:const n=[...e[e.currentId].commentsContent];return n.push(t.payload),{...e,[e.currentId]:{...e[e.currentId],commentsContent:n}};case X:return t.payload.id in e?{...e,[t.payload.id]:{...e[t.payload.id],commentsContent:t.payload.comments}}:e;case ee:const r=e[e.currentId].commentsContent;if(0===t.payload.parentId)return{...e,[e.currentId]:{...[e.currentId],commentsContent:[...r,t.payload.comment]}};{const n=r.findIndex((({id:e})=>e===t.payload.parentId));if(-1!==n){const i=JSON.parse(JSON.stringify(r));return i[n].answers.push(t.payload.answer),{...e,[e.currentId]:{...e[e.currentId],commentsContent:i}}}console.warn("коментарий с таким айди",t.payload.parentId,"не найден")}return e;case Q:let i=-1;const s=e[e.currentId].commentsContent;let o=s.findIndex((({id:e})=>e===t.payload.id));if(-1===o&&(o=s.findIndex((({answers:e},n)=>{i=e.findIndex((({id:e})=>e===t.payload.id)),-1!==i&&(o=n)}))),-1!==o){console.warn("коментарий с айди найден",{commentsIdx:o,answerIdx:i});const n=JSON.parse(JSON.stringify(e[e.currentId].commentsContent));return-1!==i?n[o][i].text=t.payload.text:n[o].text=t.payload.text,{...e,[e.currentId]:{...[e.currentId],commentsContent:n}}}return console.warn("коментарий с таким айди",t.payload.id,"не найден"),e}return e},stream:function(e=he,t){switch(t.type){case D:const n=t.payload;return 0===n.length?e:{...e,comments:e.comments.concat(n)};case P:return{...e,comments:[]};case q:return e}return e}}),{},(function({getState:e,dispatch:t}){return function(n){return function(r){return"function"==typeof r?r(t,e):n(r)}}}));function ve(e){return new Date(e).toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",timezone:"Russia/Moscow"})}function me(e){return new Promise(((t,n)=>{"string"!=typeof e&&n(new Error("Передай мне строку, а не url: "+e)),""===e?n(new Error("Картинку не отправляем")):t()})).then((()=>fetch(e))).then((e=>e.blob()))}function _e(e){return new Promise((t=>{const n=new FileReader;n.onload=e=>t(e.target.result),n.readAsDataURL(e)}))}function ye(e){const t=document.createElement("a"),n=document.querySelector("#root");t.id="clickSimulator",t.href=e,n.appendChild(t),t.click(),n.removeChild(t)}function be(){for(;;){const e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),n=Math.floor(255*Math.random()),r=(299*e+587*t+114*n)/1e3;if(r<155&&r>40&&e>64&&t>40&&n>64)return"#"+e.toString(16)+t.toString(16)+n.toString(16)}}function we(){return document.documentElement.clientHeight}const Se={createInput:function(e,t,n,r=null,i=!1,s=null){const o=document.createElement("input");return o.type=e,o.name=n,o.id="input-"+n,o.placeholder=t,o.required=i,null!=r&&(o.title=r),null!=s&&(o.pattern=s),o},createLabel:function(e,t){const n=document.createElement("label");return n.textContent=t,n.htmlFor=e,n},createInputRow:function(e){const t=document.createElement("div");t.className="form-row";const n=document.createElement("div");n.className="tooltip",n.title=e.title;const r=document.createElement("div");return r.className="tooltip-sign",r.textContent="?","null"===e.title&&(n.style.visibility="hidden"),t.appendChild(e),n.appendChild(r),t.appendChild(n),t},getPageHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},getUserWindowWidth:function(){return document.documentElement.clientWidth},getUserWindowHeight:we,getCurrentPageYPos:function(){return window.pageYOffset},redirect:ye,htmlToString:function(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML},genRanHexColor:be,getFileBrowserStorageUrl:_e,recoverBlobWithUrl:me,getRusDateTime:ve},Ee="http://89.208.197.247:8081/api/v1",Le={post:"POST",get:"GET"};function Ce(e){const t=Ee+(e.url||"/"),n={body:JSON.stringify(e.body),mode:"cors",credentials:"include",headers:{"Content-Type":"application/json"},method:e.method};let r=0;return fetch(t,n).then((e=>(r=e.status,e.json()))).then((e=>({status:r,response:e}))).catch((e=>{console.warn(e)}))}const Ae={ok:200,notFound:404,badRequest:400,invalidSession:424},ke=e=>Ce({method:Le.get,...e}),xe=e=>Ce({method:Le.post,...e}),Te=function(e){const t=Ee+(e.url||"/"),n=new FormData;n.append("img",e.body);let r=0;return fetch(t,{body:n,mode:"cors",credentials:"include",method:Le.post}).then((e=>(r=e.status,e.json()))).then((e=>({status:r,response:e}))).catch((e=>{console.warn(e)}))},Oe=Ee;function Ie(e){"avatarUrl"in e&&!e.avatarUrl.startsWith(Oe)&&(e.avatarUrl=Oe+"/img/"+e.avatarUrl),"previewUrl"in e&&!e.previewUrl.startsWith(Oe)&&(e.previewUrl=Oe+"/img/"+e.previewUrl)}function Re(e){return Date.parse(e.replaceAll("/","-").replace(" ","T")+":00")}function Ne(e,t=null){const n={...e,datetimeMS:Re(e.dateTime),datetime:ve(Re(e.dateTime))};return delete n.dateTime,Ie(n.author),t&&(n.author=t),n}const qe=function(e,t){return t.forEach((e=>{!1 in e&&Ie(e.author),Ie(e)})),{type:k,payload:{idLastLoaded:e,cards:t}}},De=function(){return{type:x}},Pe=function(){return{type:I}},$e=function(){return{type:"UNSET_LOADING_FLAG_SEARCH"}},Me=function(){return{type:T}},Ue=function(){return{type:O}},He=function(e,t=""){return{type:R,payload:{group:e,description:t}}},Fe=function(e){return{type:N,payload:e}};class Be extends r{constructor(){super(),this.view=new s,this.isBlur=!1,this.isOpen=!1}render(){super.render(),this.root=this.view.render();const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".search__input"),n=this.root.querySelector(".search__row"),r=this.root.querySelector(".search__row_group_dropdown");r.querySelector(".search__row_group_dropdown-content").childNodes.forEach((e=>e.addEventListener("click",(e=>{r.querySelector(".search__row_group_bar").value=e.target.textContent,fe.dispatch(He(e.target.dataset.search,e.target.textContent)),t.focus()})))),r.addEventListener("mouseover",(e=>t.removeEventListener("focusout",i))),r.addEventListener("mouseout",(e=>t.addEventListener("focusout",i))),e.addEventListener("click",(e=>{e.preventDefault(),this.isBlur||this.isOpen||this.openSearchField()})),t.addEventListener("keydown",(({keyCode:e,target:n})=>{13===e&&(fe.dispatch(Fe(t.value)),t.blur(),ye("/search"),this.root.querySelector(".search__row_group_bar").value=fe.getState().search.description)}));const i=e=>{console.log("{Header} searchField lost focus"),this.closeSearchField(),this.isBlur=!0;const t=1e3*parseFloat(n.style.transitionDuration);setTimeout((()=>this.isBlur=!1),t)};return t.addEventListener("focusout",i),this.root}closeSearchField(){const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".header__nav-items"),n=this.root.querySelector(".search__row");console.log("{Header} searchField close"),t.style.pointerEvents="all",e.classList.add("search-icon"),e.classList.remove("cross-icon"),n.classList.add("search__row_close"),n.classList.remove("search__row_open"),this.isOpen=!1}openSearchField(){const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".header__nav-items"),n=this.root.querySelector(".search__row"),r=this.root.querySelector(".search__input");console.log("{Header} searchField open"),t.style.pointerEvents="none",e.classList.remove("search-icon"),e.classList.add("cross-icon"),n.classList.remove("search__row_close"),n.classList.add("search__row_open"),r.focus(),r.select(),this.isOpen=!0}}function je(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Je(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Je(e){var t=""+e,n=Ge.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var Ge=/["&<>]/;function We(e){var t,n="",r=e||{};return function(e,r,i,s,o){n=n+'<div class="sidebar"><div class="sidebar__nav-links"><a class="sidebar__nav-item" href="/editor">Добавить  <br/>запись</a><div class="sidebar__nav-buttons" id="sidebarTopBlockContent">'+(null==(t=o)?"":t)+'</div></div><div class="sidebar__content"><div class="sidebar__categories"><div class="sidebar__categories-title sidebar__item">Мнения</div><div class="sidebar__streams">'+(null==(t=s)?"":t)+'</div><div class="sidebar__categories-title sidebar__item"><a href="/categories">Категории</a></div>',e.isArray(r)&&(function(){var e=r;if("number"==typeof e.length)for(var s=0,o=e.length;s<o;s++){var a=e[s];n=s<i?n+'<div class="sidebar__categories-item sidebar__item"><a'+je("href",`/categories/${a}`,!0,!1)+">"+Je(null==(t=a)?"":t)+"</a></div>":n+'<div class="sidebar__categories-item sidebar__item" style="display: none"><a'+je("href",`/categories/${a}`,!0,!1)+">"+Je(null==(t=a)?"":t)+"</a></div>"}else for(var s in o=0,e)o++,a=e[s],n=s<i?n+'<div class="sidebar__categories-item sidebar__item"><a'+je("href",`/categories/${a}`,!0,!1)+">"+Je(null==(t=a)?"":t)+"</a></div>":n+'<div class="sidebar__categories-item sidebar__item" style="display: none"><a'+je("href",`/categories/${a}`,!0,!1)+">"+Je(null==(t=a)?"":t)+"</a></div>"}.call(this),n+='<div class="sidebar__categories-more sidebar__item"><div class="sidebar__categories-more-text">Показать ещё</div><button class="action-btns__arrow-icon icon-small__img sidebar__categories-more-btn rotate-180"></button></div>'),n+='</div><div class="sidebar-bottom_right"><div class="contacts"><div class="contacts__title">Контакты</div><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/yurij-lyubskij">Юра</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/Svetlanlka">Света</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/Denactive">Денис</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/MollenAR">Лёша</a></div></div></div></div>'}.call(this,"Array"in r?r.Array:"undefined"!=typeof Array?Array:void 0,"categoriesList"in r?r.categoriesList:"undefined"!=typeof categoriesList?categoriesList:void 0,"limit"in r?r.limit:"undefined"!=typeof limit?limit:void 0,"streams"in r?r.streams:"undefined"!=typeof streams?streams:void 0,"topBlockContent"in r?r.topBlockContent:"undefined"!=typeof topBlockContent?topBlockContent:void 0),n}function Ve(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Ye(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function ze(e,t){return Array.isArray(e)?function(e,t){for(var n,r="",i="",s=Array.isArray(t),o=0;o<e.length;o++)(n=ze(e[o]))&&(s&&t[o]&&(n=Ye(n)),r=r+i+n,i=" ");return r}(e,t):e&&"object"==typeof e?function(e){var t="",n="";for(var r in e)r&&e[r]&&Ze.call(e,r)&&(t=t+n+r,n=" ");return t}(e):e||""}function Ye(e){var t=""+e,n=Ke.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var Ze=Object.prototype.hasOwnProperty,Ke=/["&<>]/;function Xe(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=Xe(n,e[r]);return n}for(var i in t)if("class"===i){var s=e[i]||[];e[i]=(Array.isArray(s)?s:[s]).concat(t[i]||[])}else if("style"===i){s=(s=Qe(e[i]))&&";"!==s[s.length-1]?s+";":s;var o=Qe(t[i]);o=o&&";"!==o[o.length-1]?o+";":o,e[i]=s+o}else e[i]=t[i];return e}function Qe(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)Ze.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function et(e){var t,n="",r={},i=e||{};return function(e,i,s){r.avatar=t=function(){this&&this.block;var e=this&&this.attributes||{};n=n+"<img"+function(e,t){var n="";for(var r in e)if(Ze.call(e,r)){var i=e[r];if("class"===r){n=Ve(r,i=ze(i),!1,false)+n;continue}"style"===r&&(i=Qe(i)),n+=Ve(r,i,!1,false)}return n}(Xe([{onerror:"console.warn(`не удалось загрузить аватар ${this.src}`);this.src='/static/img/user_icon_loading.svg';this.onerror = undefined;"},e]))+"/>"},n=n+'<div class="stream-comment"'+Ve("id",`${i}`,!0,!1)+'><div class="stream-comment__author">',r.avatar.call({attributes:{class:"stream-comment__author-photo",src:Ye(`${e.avatarUrl}`)}}),n=n+'<div class="stream-comment__author-name">'+Ye(null==(t=e.firstName)?"":t)+" "+Ye(null==(t=e.lastName)?"":t)+'</div></div><div class="stream-comment__text">'+Ye(null==(t=s)?"":t)+"</div></div>"}.call(this,"author"in i?i.author:"undefined"!=typeof author?author:void 0,"id"in i?i.id:"undefined"!=typeof id?id:void 0,"text"in i?i.text:"undefined"!=typeof text?text:void 0),n}class tt extends n{constructor(){super(),this.root=document.createElement("div")}render(e,t,n,r){let i="";r.forEach((e=>{const t=et(e);i+=t}));const s=document.createElement("div");return s.innerHTML=We({topBlockContent:e,categoriesList:t,limit:n,streams:i}),this.root=s.firstChild,this.root}setTopBlockContent(e){const t=this.root.querySelector("#sidebarTopBlockContent");t?t.innerHTML=e:this.render(e)}addComments(e){const t=this.root.querySelector(".sidebar__streams");e.forEach((e=>{const n=et(e);t.insertAdjacentHTML("afterbegin",n)}))}}function nt(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=it(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function rt(e,t){return Array.isArray(e)?function(e,t){for(var n,r="",i="",s=Array.isArray(t),o=0;o<e.length;o++)(n=rt(e[o]))&&(s&&t[o]&&(n=it(n)),r=r+i+n,i=" ");return r}(e,t):e&&"object"==typeof e?function(e){var t="",n="";for(var r in e)r&&e[r]&&st.call(e,r)&&(t=t+n+r,n=" ");return t}(e):e||""}function it(e){var t=""+e,n=ot.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var st=Object.prototype.hasOwnProperty,ot=/["&<>]/;function at(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=at(n,e[r]);return n}for(var i in t)if("class"===i){var s=e[i]||[];e[i]=(Array.isArray(s)?s:[s]).concat(t[i]||[])}else if("style"===i){s=(s=ct(e[i]))&&";"!==s[s.length-1]?s+";":s;var o=ct(t[i]);o=o&&";"!==o[o.length-1]?o+";":o,e[i]=s+o}else e[i]=t[i];return e}function ct(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)st.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function lt(e){var t,n="",r={},i=e||{};return function(e,i){r.avatar=function(){this&&this.block;var e=this&&this.attributes||{};n=n+"<img"+function(e,t){var n="";for(var r in e)if(st.call(e,r)){var i=e[r];if("class"===r){n=nt(r,i=rt(i),!1,false)+n;continue}"style"===r&&(i=ct(i)),n+=nt(r,i,!1,false)}return n}(at([{onerror:"console.warn(`не удалось загрузить аватар ${this.src}`);this.src='/static/img/user_icon_loading.svg';this.onerror = undefined;"},e]))+"/>"},n=n+'<div class="user-preview"><a class="user-preview__links" href="/profile"><div class="sidebar__nav-item" data-router="ignore">'+it(null==(t=i)?"":t)+"</div>",r.avatar.call({attributes:{class:"user-img user-preview__user-img",src:it(`${e}`),"data-router":"ignore"}}),n+='</a><div class="profile-menu"><a class="profile-menu__item" href="/profile/settings">Настройки</a><a class="profile-menu__item" data-section="logout">Выйти</a></div></div>'}.call(this,"avatarUrl"in i?i.avatarUrl:"undefined"!=typeof avatarUrl?avatarUrl:void 0,"login"in i?i.login:"undefined"!=typeof login?login:void 0),n}function dt(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=ut(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function ut(e){var t=""+e,n=pt.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var pt=/["&<>]/;function ht(e){var t,n="",r=e||{};return function(e,r,i,s,o){null!=i&&e-o!=void 0&&(n=n+'<a class="sidebar__nav-item"'+dt("href",`${i}`,!0,!1)+dt("data-section",`${r}`,!0,!1)+">"+ut(null==(t=s)?"":t)+"</a>"),null==i&&e-o!=void 0&&(n=n+'<a class="sidebar__nav-item"'+dt("data-section",`${r}`,!0,!1)+">"+ut(null==(t=s)?"":t)+"</a>"),null!=i&&e-o==void 0&&(n=n+'<a class="sidebar__nav-item"'+dt("href",`${i}`,!0,!1)+">"+ut(null==(t=s)?"":t)+"</a>")}.call(this,"data"in r?r.data:"undefined"!=typeof data?data:void 0,"data_section"in r?r.data_section:"undefined"!=typeof data_section?data_section:void 0,"href"in r?r.href:"undefined"!=typeof href?href:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"section"in r?r.section:"undefined"!=typeof section?section:void 0),n}const gt=function(e){return Ie(e),{type:o,payload:e}},ft=function(){return{type:a}},vt=function(e,t){return{type:c,payload:{page:e,docTitle:t}}},mt=function(){return{type:d}},_t=function(){return{type:u}},yt=function(e,t){return t.forEach((e=>{Ie(e),Ie(e.author)})),{type:p.SAVE_NEW_CARDS,payload:{idLastLoaded:e,cards:t}}},bt=function(){return{type:p.CLEAR_CARDS}},wt=function(){return{type:p.SET_LOADING_FLAG}},St=function(){return{type:p.UNSET_LOADING_FLAG}},Et=function(){return{type:p.FORBID_CARDS_UPLOADING}},Lt=function(){return{type:p.ALLOW_CARDS_UPLOADING}},Ct=function(e,t){return{type:p.TOGGLE_AUTH,payload:{isAuthenticated:e,login:t}}},At=function(e){return{type:y,payload:{firstName:"загрузка",lastName:"загрузка",avatarUrl:"",score:0,...e}}},kt=function(e){return Ie(e),{type:_,payload:e}},xt=function(e,t){return t.forEach((e=>{Ie(e),Ie(e.author)})),{type:h,payload:{idLastLoaded:e,cards:t}}},Tt=function(){return{type:g}},Ot=function(){return{type:m}},It=function(){return{type:"UNSET_USER_ARTICLES_LOADING"}},Rt=function(){return{type:f}},Nt=function(){return{type:M}},qt=function(){return{type:$}},Dt=function(){return{type:B}},Pt=function(e,t){return Ie(t),Ie(t.author),{type:F,payload:{id:e,...t,tags:Array.isArray(t.tags)?t.tags:[]}}},$t=function(e){return{type:J,payload:{id:e}}},Mt=function(e,t){return Ie(t),{type:j,payload:{id:e,title:t.title,text:t.text,tags:Array.isArray(t.tags)?t.tags:[],img:t.img||"",category:t.category||""}}},Ut=function(e){return{type:W,payload:{id:e}}},Ht=function(e){return{type:U,payload:e}},Ft=function(e){return{type:H,payload:e}},Bt=function(e){return{type:V,payload:e}},jt=function(){return{type:V,payload:""}},Jt=function(e){return{type:z,payload:e}},Gt=function(){return{type:z,payload:""}},Wt=["Маркетинг","Личный опыт","Вопросы","SaberDevs","Сервисы","Будущее","Финансы","Дизайн","Соцсети","Техника","Карьера","Медиа","Истории","Торговля","SEO","Офлайн","Видео","Офис","Офтоп","Транспорт","Право","Трибуна","Еда","Конкурсы","Приёмная","Миграция"];class Vt extends r{constructor(){super(),this.view=new tt,this.unsubscribes.push(fe.subscribe(o,(()=>{fe.dispatch(((e,t)=>e(Ct(!0,t().authorization.login)))),this.setSidebarUserPreview()})),fe.subscribe(a,(()=>{fe.dispatch(Ct(!1,"")),this.setSidebarSignupButtons()}))),this.unsubscribes.push(fe.subscribe(D,(e=>{this.addComments(e)})))}render(){super.render();const e=fe.getState().authorization;let t="";e.isAuthenticated?t=lt({login:e.login,avatarUrl:e.avatarUrl}):(t+=ht({data_section:"loginModal",name:"Логин"}),t+=ht({data_section:"signupModal",name:"Регистрация"}));const n=[...fe.getState().stream.comments].reverse();this.root=this.view.render(t,Wt,6,n),this.view.root.querySelector("a.sidebar__nav-item").addEventListener("click",(()=>fe.dispatch(Dt())));const r=this.view.root.querySelectorAll(".sidebar__categories-item"),i=this.view.root.querySelector(".sidebar__categories-more-btn"),s=this.view.root.querySelector(".sidebar__categories-more-text");return zt(r,i,s),this.view.root.querySelector(".sidebar__categories-more").addEventListener("click",(e=>{e.preventDefault(),zt(r,i,s)})),this.root}setSidebarUserPreview(){const e=fe.getState().authorization;this.view.setTopBlockContent(lt(e))}setSidebarSignupButtons(){let e=ht({data_section:"loginModal",name:"Логин"});e+=ht({data_section:"signupModal",name:"Регистрация"}),this.view.setTopBlockContent(e)}addComments(e){this.view.addComments(e)}}function zt(e,t,n){let r=!0;t.classList.contains("rotate-180")?(n.innerText="Показать ещё",t.classList.remove("rotate-180"),r=!0):(n.innerText="Скрыть",t.classList.add("rotate-180"),r=!1);for(let t=6;t<e.length;++t)e[t].style.display=r?"none":"block"}let Yt=null,Zt=null;function Kt(e,...t){null!==Yt&&null!==Zt||(Yt=new Be,Zt=new Vt);const n=document.createElement("div");n.className="background";const i=document.createElement("div");i.className="screen";const s=document.createElement("div");s.className="page";const o=document.createElement("div");o.className="page_title",o.textContent=e;const a=document.createElement("div");return a.className="content",t.forEach((e=>{e instanceof r?a.appendChild(e.render()):e instanceof HTMLElement?a.appendChild(e):console.warn(e,"is not BaseComponent nor HTMLElement")})),s.appendChild(Yt.render()),s.appendChild(o),s.appendChild(a),i.appendChild(s),i.appendChild(Zt.render()),n.appendChild(i),n}function Xt(e){var t,n="",r=e||{};return function(e){n=n+'<div class="feed"><div class="feed__preview">'+(null==(t=e)?"":t)+'</div><div class="feed__cards"></div><div id="feed__loading">&#11088;</div></div>'}.call(this,"preview"in r?r.preview:"undefined"!=typeof preview?preview:void 0),n}class Qt extends n{constructor(e,t,n){super(),this.composeCards=e,this.root=this.render(t,n)}render(e,t){const n=document.createElement("div");n.innerHTML=Xt({preview:e});const r=n.firstChild;return this.composeCards(r.querySelector(".feed__cards"),t),this.root=r,r}addCards(e){const t=this.root.querySelector(".feed__cards");t?(this.composeCards(t,e),this.showLoadingAnimation()):console.warn("cannot append cards till Feed is not rendered")}clear(){this.root.querySelector(".feed__cards").innerHTML=""}hideLoadingAnimation(){this.root.querySelector("#feed__loading").style.display="none"}showLoadingAnimation(){this.root.querySelector("#feed__loading").style.display="block"}}const en=function(e){return Ie(e),Ie(e.author),{type:Y,payload:e}},tn=function(e){return{type:Z,payload:e}},nn=function(e){return Ie(e),"avatar"in e&&Ie(e.author),{type:K,payload:e}},rn=function(e,t){return Array.isArray(t)||(console.warn("API error. Server returned ",typeof t,"instead of comments"),t=[]),t||(t=[]),{type:X,payload:{id:e,comments:t}}},sn=function(e,t){return{type:Q,payload:{id:e,text:t}}},on=function(e,t){return{type:ee,payload:{parentId:e,answer:t}}},an=function(e){return{type:te,payload:e}};function cn(e,t){t.forEach((t=>{const n=e.querySelector("#card"+t.id);null!==n?(n.addEventListener("click",(e=>{e.preventDefault();const n=e.currentTarget;fe.dispatch(nn(t)),ye("/article/"+n.id.replace("card",""))})),n.querySelector(".author-name").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),fe.dispatch(kt(t.author)),ye("/user/"+t.author.login)})),n.querySelectorAll(".tags__tag").forEach((e=>e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),console.warn("TODO: клик по тегу",e.currentTarget.textContent)}))))):console.warn("{Feed} card with id",t.id,"has mounted with error")}))}class ln extends r{constructor(e,t,n,i,s,o,a,c,l=new r){console.log("{FEED} creation with params:"),console.log({storeName:t}),super(),this.innerComponent=l,this.storeName=t;const d=fe.getState()[t].cards;this.view=new Qt(e,l.render().outerHTML,d),this.unsubscribes.push(fe.subscribe(n,(({idLastLoaded:e,cards:n})=>{Array.isArray(n)&&(this.view.addCards(n),cn(this.view.root.querySelector(".feed__cards"),n),fe.getState()[t].isEndFound&&(this.view.hideLoadingAnimation(),fe.dispatch((e=>{setTimeout((()=>{e(c())}),6e3)}))))})),fe.subscribe(i,(()=>this.view.clear())),fe.subscribe(o,(()=>this.view.showLoadingAnimation())),fe.subscribe(s,(()=>this.view.hideLoadingAnimation())))}render(){super.render();const e=this.innerComponent.render().outerHTML,t=fe.getState()[this.storeName].cards;return this.root=this.view.render(e,t),cn(this.view.root.querySelector(".feed__cards"),t),fe.getState()[this.storeName].isEndFound&&this.view.hideLoadingAnimation(),this.root}}function dn(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=pn(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function un(e,t){return Array.isArray(e)?function(e,t){for(var n,r="",i="",s=Array.isArray(t),o=0;o<e.length;o++)(n=un(e[o]))&&(s&&t[o]&&(n=pn(n)),r=r+i+n,i=" ");return r}(e,t):e&&"object"==typeof e?function(e){var t="",n="";for(var r in e)r&&e[r]&&hn.call(e,r)&&(t=t+n+r,n=" ");return t}(e):e||""}function pn(e){var t=""+e,n=gn.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var hn=Object.prototype.hasOwnProperty,gn=/["&<>]/;function fn(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=fn(n,e[r]);return n}for(var i in t)if("class"===i){var s=e[i]||[];e[i]=(Array.isArray(s)?s:[s]).concat(t[i]||[])}else if("style"===i){s=(s=vn(e[i]))&&";"!==s[s.length-1]?s+";":s;var o=vn(t[i]);o=o&&";"!==o[o.length-1]?o+";":o,e[i]=s+o}else e[i]=t[i];return e}function vn(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)hn.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function mn(e){var t,n="",r={},i=e||{};return function(e,i,s,o,a,c,l,d,u,p,h){r.avatar=t=function(){this&&this.block;var e=this&&this.attributes||{};n=n+"<img"+function(e,t){var n="";for(var r in e)if(hn.call(e,r)){var i=e[r];if("class"===r){n=dn(r,i=un(i),!1,false)+n;continue}"style"===r&&(i=vn(i)),n+=dn(r,i,!1,false)}return n}(fn([{onerror:"console.warn(`не удалось загрузить аватар ${this.src}`);this.src='/static/img/user_icon_loading.svg';this.onerror = undefined;"},e]))+"/>"},r.tagMixin=t=function(e,r,i=!1){this&&this.block,this&&this.attributes,n=n+'<div class="tags__tag-content"'+dn("style",vn(`background-color: ${r}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=e)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+dn("style",vn(`background-color: ${r}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=e)?"":t)+"</div>",n+="</div>"},n=n+'<div class="card"'+dn("id",`card${c}`,!0,!1)+dn("style",vn(`background: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0.7)), to(rgba(0, 0, 0, 0.7))), url(${d});\nbackground: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url(${d});\nbackground-size: cover;\nbackground-repeat: no-repeat;`),!0,!1)+'><div class="card__top"><div class="card__top-left"><div class="card__time-category"><div class="card__time">'+pn(null==(t=a)?"":t)+'</div><div class="card__category">'+pn(null==(t=s)?"":t)+'</div></div><div class="tags">',e.isArray(u)&&function(){var e=u;if("number"==typeof e.length)for(var t=0,n=e.length;t<n;t++){var i=e[t];r.tagMixin(i.content,i.color)}else for(var t in n=0,e)n++,i=e[t],r.tagMixin(i.content,i.color)}.call(this),n+='</div></div><div class="card__author">',r.avatar.call({attributes:{class:"card__author-photo",src:pn(`${i.avatarUrl}`)}}),n+='<div class="author-name">',"object"==typeof i&&(n=n+'<div class="author-name__login">'+pn(null==(t=i.login)?"":t)+'</div><div class="author-name__username">'+pn(null==(t=i.firstName)?"":t)+" "+pn(null==(t=i.lastName)?"":t)+"</div>"),n=n+'</div></div></div><div class="card__content"><a class="preview__title">'+pn(null==(t=h)?"":t)+'</a><div class="card__description">'+pn(null==(t=p)?"":t)+'</div></div><div class="card__bottom"><div class="action-btns"><div class="icon action-btns_m-right"><div class="icon__text">'+pn(null==(t=l)?"":t)+'</div><button class="action-btns__likes-icon icon__img"></button></div><div class="icon"><div class="icon__text">'+pn(null==(t=o)?"":t)+'</div><button class="action-btns__comments-icon icon__img"></button></div></div></div></div>'}.call(this,"Array"in i?i.Array:"undefined"!=typeof Array?Array:void 0,"author"in i?i.author:"undefined"!=typeof author?author:void 0,"category"in i?i.category:"undefined"!=typeof category?category:void 0,"comments"in i?i.comments:"undefined"!=typeof comments?comments:void 0,"datetime"in i?i.datetime:"undefined"!=typeof datetime?datetime:void 0,"id"in i?i.id:"undefined"!=typeof id?id:void 0,"likes"in i?i.likes:"undefined"!=typeof likes?likes:void 0,"previewUrl"in i?i.previewUrl:"undefined"!=typeof previewUrl?previewUrl:void 0,"tags"in i?i.tags:"undefined"!=typeof tags?tags:void 0,"text"in i?i.text:"undefined"!=typeof text?text:void 0,"title"in i?i.title:"undefined"!=typeof title?title:void 0),n}function _n(e,t){t.forEach((t=>{Ie(t),Ie(t.author);const n=document.createElement("div"),r=t.tags.map((e=>({content:e,color:be()})));n.innerHTML=mn({...t,tags:r}),e.appendChild(n.firstChild)}))}class yn extends e{constructor(e){super(e),this.pageComponents={feed:new ln(_n,"mainPage",p.SAVE_NEW_CARDS,p.CLEAR_CARDS,p.FORBID_CARDS_UPLOADING,p.ALLOW_CARDS_UPLOADING,Et,Lt)}}render(){super.render(),this.root.appendChild(Kt("",this.pageComponents.feed))}}let bn=!1,wn=!1,Sn=!0,En=!0,Ln="",Cn=()=>{},An=()=>{};function kn(e){return function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="modal__overlay" data-modal-close="true"><div class="modal__window"><div class="modal__content-block"><div class="modal__header"><a class="modal__close-btn icon__img" data-modal-close="true"></a></div><div class="modal__content">'+(null==(t=r)?"":t)+'</div></div><div class="modal__footer"><button class="modal__btn" id="modal__btn-ok" type="button" data-modal-close="true">'+(null==(t=i)?"":t)+'</button><button class="modal__btn" id="modal__btn-cancel" type="button" data-modal-close="true">'+(null==(t=e)?"":t)+"</button></div></div></div>"}.call(this,"cancel_sign"in r?r.cancel_sign:"undefined"!=typeof cancel_sign?cancel_sign:void 0,"content"in r?r.content:"undefined"!=typeof content?content:void 0,"ok_sign"in r?r.ok_sign:"undefined"!=typeof ok_sign?ok_sign:void 0),n}({title:e.title||"",content:e.content||"",ok_sign:e.btnOkSign||"Понятно",cancel_sign:e.btnCancelSign||"Отмена"})}const xn=function(e){const t=document.getElementById("modalroot");t.innerHTML=kn(e);const n=t.querySelector("#modal__btn-ok"),r=t=>{t.preventDefault(),"function"==typeof e.onConfirm?e.onConfirm():console.log("[Modal] confirm")};n.addEventListener("click",r),Cn=()=>{n.removeEventListener("click",r)};const i=t.querySelector("#modal__btn-cancel"),s=t=>{t.preventDefault(),"function"==typeof e.onDecline?e.onDecline():console.log("[Modal] decline")};return i.addEventListener("click",s),An=()=>{i.removeEventListener("click",s)},fe.subscribe(u,(()=>{document.title=fe.getState().page.docTitle})),fe.subscribe(d,(()=>{document.title=Ln})),t}({isEnteractive:!0,isCancelable:!0}),Tn={animationTime:200,setDocTitle(e){Ln=e},close(){if(wn)return;fe.dispatch(_t()),bn=!0;const e=xn.querySelector(".modal__overlay");e.classList.add("modal_close"),e.classList.remove("modal_open"),setTimeout((()=>{bn=!1}),200)},open(e=!0){if(wn)return;if(fe.dispatch(mt()),bn)return void console.warn("[Modal] open: modal is in closing process");const t=xn.querySelector("#modal__btn-ok"),n=xn.querySelector("#modal__btn-cancel");t.className="modal__btn-ok",t.classList.add("modal__btn"),n.className="modal__btn-cancel",n.classList.add("modal__btn"),e||(t.style.display="none",n.style.display="none");const r=xn.querySelector(".modal__overlay");r.classList.remove("modal_close"),r.classList.add("modal_open"),e||setTimeout((()=>{this.close(),setTimeout((()=>{Sn&&(t.style.display="block"),En&&(n.style.display="block")}),200)}),2e3)},getContent(){const e=xn.querySelector(".modal__content");return e||console.warn("[Modal] no .modal__content found"),e},setContent(e){const t=xn.querySelector(".modal__content");"string"==typeof e&&(t.innerHTML=e),e instanceof HTMLElement&&(t.innerHTML="",t.appendChild(e))},appendContent(e){const t=xn.querySelector(".modal__content");"string"==typeof e&&(t.innerHTML+=e),e instanceof HTMLElement&&t.appendChild(e)},setTitle(e){let t=xn.querySelector(".modal__header");if("string"==typeof e&&(t.innerHTML=e),e instanceof HTMLElement){const n=document.createElement("div");t.className="modal__header",n.appendChild(e),t=n}},configurate(e){xn.innerHTML=kn(e);const t=xn.querySelector("#modal__btn-ok"),n=t=>{t.preventDefault(),"function"==typeof e.onConfirm?e.onConfirm():console.log("[Modal] confirm")};t.addEventListener("click",n),Cn=()=>{t.removeEventListener("click",n)};const r=xn.querySelector("#modal__btn-cancel"),i=t=>{t.preventDefault(),"function"==typeof e.onDecline?e.onDecline():console.log("[Modal] decline")};r.addEventListener("click",i),An=()=>{console.log("[Modal] clear Cancel Listener",{activeCancelEventListener:i}),r.removeEventListener("click",i)},e.isEnteractive||(t.style.display="none",r.style.display="none"),e.isCancelable||(r.style.display="none")},enableOkBtn(){xn.querySelector("#modal__btn-ok").style.display="block",Sn=!0},disableOkBtn(){xn.querySelector("#modal__btn-ok").style.display="none",Sn=!1},enableCancelBtn(){xn.querySelector("#modal__btn-cancel").style.display="block",En=!0},disableCancelBtn(){xn.querySelector("#modal__btn-cancel").style.display="none",En=!1},changeBtnOkSign(e){xn.querySelector("#modal__btn-ok").innerText=e},changeBtnCancelSign(e){xn.querySelector("#modal__btn-cancel").innerText=e},setOkBtnAction(e){Cn();const t=xn.querySelector("#modal__btn-ok"),n=t=>{t.preventDefault(),"function"==typeof e?e():console.log("[Modal] confirm")};t.addEventListener("click",n),Cn=()=>{t.removeEventListener("click",n)}},setCancelBtnAction(e){An();const t=xn.querySelector("#modal__btn-cancel"),n=t=>{t.preventDefault(),"function"==typeof e?e():console.log("[Modal] confirm")};t.addEventListener("click",n),An=()=>{t.removeEventListener("click",n)}}};function On(e){e.target.dataset.modalClose&&Tn.close()}xn.addEventListener("click",On),Object.assign(Tn,{destroy(){this.close(),xn.removeEventListener("click",On),xn.innerHTML="",wn=!0}});const In=Tn;function Rn({currentTarget:e}){const t=fe.getState().mainPage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>we()||(console.log("[Main Page] scroll trigger"),fe.dispatch(Nn))}async function Nn(){const e=fe.getState().mainPage,t=fe.getState().authorization;e.isEndFound||e.isLoading||(fe.dispatch(wt()),await ke({url:`/articles/feed?idLastLoaded=${e.idLastLoaded||""}&login=`+(t.isAuthenticated?t.login:"all")}).then((({status:t,response:n})=>{if(t===Ae.ok)return r=n.data,void fe.dispatch(yt(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;t/500==1&&In.setTitle(`Сервис временно не доступен: ${t}`),t/400==1&&In.setTitle(`Ошибка ${t}`),In.setContent(n.msg),In.open(!1)})).catch((e=>console.warn(e.message))),fe.dispatch(St()))}function qn(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Pn(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Dn(e,t){return Array.isArray(e)?function(e,t){for(var n,r="",i="",s=Array.isArray(t),o=0;o<e.length;o++)(n=Dn(e[o]))&&(s&&t[o]&&(n=Pn(n)),r=r+i+n,i=" ");return r}(e,t):e&&"object"==typeof e?function(e){var t="",n="";for(var r in e)r&&e[r]&&$n.call(e,r)&&(t=t+n+r,n=" ");return t}(e):e||""}function Pn(e){var t=""+e,n=Mn.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var $n=Object.prototype.hasOwnProperty,Mn=/["&<>]/;function Un(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=Un(n,e[r]);return n}for(var i in t)if("class"===i){var s=e[i]||[];e[i]=(Array.isArray(s)?s:[s]).concat(t[i]||[])}else if("style"===i){s=(s=Hn(e[i]))&&";"!==s[s.length-1]?s+";":s;var o=Hn(t[i]);o=o&&";"!==o[o.length-1]?o+";":o,e[i]=s+o}else e[i]=t[i];return e}function Hn(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)$n.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function Fn(e){var t,n="",r={},i=e||{};return function(e,i,s,o,a,c){r.avatar=t=function(){this&&this.block;var e=this&&this.attributes||{};n=n+"<img"+function(e,t){var n="";for(var r in e)if($n.call(e,r)){var i=e[r];if("class"===r){n=qn(r,i=Dn(i),!1,false)+n;continue}"style"===r&&(i=Hn(i)),n+=qn(r,i,!1,false)}return n}(Un([{onerror:"console.warn(`не удалось загрузить аватар ${this.src}`);this.src='/static/img/user_icon_loading.svg';this.onerror = undefined;"},e]))+"/>"},n+='<div class="profile"><div class="profile__info">',r.avatar.call({attributes:{class:"profile__photo",src:Pn(`${e}`)}}),n=n+'<div class="profile__description"><div class="profile__username">'+Pn(null==(t=o)?"":t)+" "+Pn(null==(t=a)?"":t)+" ("+Pn(null==(t=c)?"":t)+')</div><div class="profile__aboutme">Обо мне:</div>'+Pn(null==(t=i)?"":t)+"</div></div>",s||(n+='<div class="profile__articles-title">Статьи</div>'),n+="</div>"}.call(this,"avatarUrl"in i?i.avatarUrl:"undefined"!=typeof avatarUrl?avatarUrl:void 0,"description"in i?i.description:"undefined"!=typeof description?description:void 0,"disableArticles"in i?i.disableArticles:"undefined"!=typeof disableArticles?disableArticles:void 0,"firstName"in i?i.firstName:"undefined"!=typeof firstName?firstName:void 0,"lastName"in i?i.lastName:"undefined"!=typeof lastName?lastName:void 0,"login"in i?i.login:"undefined"!=typeof login?login:void 0),n}class Bn extends n{constructor(){super(),this.root=document.createElement("div"),this.root.innerHTML="компонент profileCard"}render(e){const t=document.createElement("div");return t.innerHTML=Fn(e),this.root=t.firstChild,t.firstChild}}class jn extends r{constructor(){super(),this.view=new Bn,this.unsubscribes.push(fe.subscribe(y,(e=>{this.setUser(e)})),fe.subscribe(_,(e=>{this.setUser(e)})))}render(){super.render();const e=fe.getState().profilePage.user;return this.root=this.view.render(e),this.root}setUser(e){this.root.innerHTML="",this.root.appendChild(this.view.render(e).firstChild)}}class Jn extends e{constructor(e){super(e),this.pageComponents={profileCard:new jn,feed:new ln(_n,"profilePage",h,g,f,v,Rt,(()=>(console.log("{profilePage feed} isEndFound is not been reset"),{type:"__EMPTY__"})))}}render(){super.render(),this.root.appendChild(Kt("",this.pageComponents.profileCard,this.pageComponents.feed))}}var Gn=/["&<>]/;function Wn(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Vn(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Vn(e){var t=""+e,n=zn.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var zn=/["&<>]/;function Yn(e){var t,n="",r=e||{};return function(e,r,i,s,o,a,c){n=n+'<div class="form__row"><div class="form__label">'+Vn(null==(t=r)?"":t)+'</div><div class="form__field">',null!=o&&null!=s&&a&&(n=n+'<input class="form__input"'+Wn("type",`${c}`,!0,!1)+Wn("name",`${i}`,!0,!1)+Wn("placeholder",`${o}`,!0,!1)+Wn("pattern",`${s}`,!0,!1)+Wn("required",`${a}`,!0,!1)+"/>"),null==o||null==s||a||(n=n+'<input class="form__input"'+Wn("type",`${c}`,!0,!1)+Wn("name",`${i}`,!0,!1)+Wn("placeholder",`${o}`,!0,!1)+Wn("pattern",`${s}`,!0,!1)+"/>"),null!=o&&null==s&&a&&(n=n+'<input class="form__input"'+Wn("type",`${c}`,!0,!1)+Wn("name",`${i}`,!0,!1)+Wn("placeholder",`${o}`,!0,!1)+Wn("required",`${a}`,!0,!1)+"/>"),null==o||null!=s||a||(n=n+'<input class="form__input"'+Wn("type",`${c}`,!0,!1)+Wn("name",`${i}`,!0,!1)+"/>"),null==o&&null!=s&&a&&(n=n+'<input class="form__input"'+Wn("type",`${c}`,!0,!1)+Wn("name",`${i}`,!0,!1)+Wn("pattern",`${s}`,!0,!1)+Wn("required",`${a}`,!0,!1)+"/>"),null!=o||null==s||a||(n=n+'<input class="form__input"'+Wn("type",`${c}`,!0,!1)+Wn("name",`${i}`,!0,!1)+Wn("pattern",`${s}`,!0,!1)+"/>"),null==o&&null==s&&a&&(n=n+'<input class="form__input"'+Wn("type",`${c}`,!0,!1)+Wn("name",`${i}`,!0,!1)+Wn("required",`${a}`,!0,!1)+"/>"),null!=o||null!=s||a||(n=n+'<input class="form__input"'+Wn("type",`${c}`,!0,!1)+Wn("name",`${i}`,!0,!1)+"/>"),1==e&&(n+='<a class="password__control-btn control-password"></a>'),n+="</div></div>"}.call(this,"eye"in r?r.eye:"undefined"!=typeof eye?eye:void 0,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"pattern"in r?r.pattern:"undefined"!=typeof pattern?pattern:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0,"required"in r?r.required:"undefined"!=typeof required?required:void 0,"type"in r?r.type:"undefined"!=typeof type?type:void 0),n}const Zn={login:/^[a-zA-Z0-9_]{4,20}$/,password:/^\S{8,40}$/,firstName:/^[a-zA-Zа-яА-Я]{2,}$/,lastName:/^[a-zA-Zа-яА-Я]{1,}'?-?[a-zA-Zа-яА-Я]{1,}(\s[a-zA-Zа-яА-Я]{1,})?$/,cirillic:/[\u0401\u0451\u0410-\u044f]/};class Kn extends n{constructor(){super(),this.root=document.createElement("div"),this.appendWarning=e=>{const t=this.root.querySelector(".form__warning"),n=this.root.querySelector("#form-warning-label");t||console.warn("[SignupFormView]\n          appendWarning call while SignupForm was not rendered"),n.style.display="block",t.style.display="block",t.textContent=e}}render(e,t){let n="";n+=Yn({label:"Логин",type:"text",name:"login",required:!0}),e&&(n+=Yn({label:"e-mail",type:"email",name:"email",required:!0})),n+=Yn({label:"Пароль",type:"password",name:"password",required:!0,eye:!0}),e&&(n+=Yn({label:"Повтор пароля",type:"password",name:"password-repeat",required:!0,eye:!1}));const r=document.createElement("div");r.innerHTML=function(e){var t,n="",r=e||{};return function(e,r){n=n+'<form class="modal__form form"><div class="form__rows">'+(null==(t=e)?"":t)+'</div><div class="form__row"><div class="form__label" id="form-warning-label" style="display: none; color: transparent;">|</div><div class="form__input form__warning">Поля заполнены неверно</div></div><div class="form__row"><div class="form__label" style="color: transparent;">|</div><input class="form__input form__submit-btn" type="submit" name="btn-submit"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=Gn.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("value",`${r}`,!0,!1)+"/></div></form>"}.call(this,"form_rows"in r?r.form_rows:"undefined"!=typeof form_rows?form_rows:void 0,"submit_btn_placeholder"in r?r.submit_btn_placeholder:"undefined"!=typeof submit_btn_placeholder?submit_btn_placeholder:void 0),n}({title:e?"Регистрация":"Вход",form_rows:n,submit_btn_placeholder:e?"Зарегистрироваться":"Войти"});const i=r.firstChild;return i.querySelector(".control-password").addEventListener("click",(({target:e})=>{const t=i.querySelector('input[name="password"]');"password"===t.getAttribute("type")?(e.classList.add("password__show"),t.type="text"):(e.classList.remove("password__show"),t.type="password")})),i.addEventListener("submit",(n=>{n.preventDefault();const r=i.querySelector(".form__warning"),s=this.root.querySelector("#form-warning-label");r.style.display="none",r.textContent="",s.style.display="none";const o=i.querySelector('input[name="login"]').value,a=i.querySelector('input[name="password"]').value,c=i.querySelector('input[name="email"]')?.value,l=i.querySelector('input[name="password-repeat"]')?.value;return Zn.login.test(o)?Zn.password.test(a)?e&&l!==a?(r.style.display="block",s.style.display="block",void(r.textContent="Удостоверьтесь, что пароли совпадают")):void t(e,o,a,c):(r.style.display="block",s.style.display="block",void(r.textContent="В качестве пароля используйте любую комбинацию непробельных символы длиной более 8")):(r.style.display="block",s.style.display="block",void(r.textContent="Логин - это латинские буквы, цифры и нижнее подчеркивание (_). Длина логина - от 4 до 20 символов"))})),this.root=i,i}}class Xn extends r{constructor(e){super(),this.view=new Kn,this.showRegister=e}render(){var e;return super.render(),this.root=this.view.render(this.showRegister,(e=this.view.appendWarning,function(t,n,r,i){xe({url:t?"/user/signup":"/user/login",body:{login:n,email:i||"",password:r}}).then((({status:t,response:n})=>{if(t===Ae.ok)return fe.dispatch(gt(n.data)),void In.close();e(n.msg)}))})),this.root}}function Qn(e){const t=document.createElement("a");t.textContent=e?"У меня уже есть аккаунт":"Создать аккаунт",t.href=e?"/login":"/register",t.classList.add("link"),t.addEventListener("click",(t=>{t.preventDefault(),In.close(),setTimeout((()=>{Qn(!e)}),In.animationTime)}));const n=new Xn(e).render(),r=document.createElement("div");r.appendChild(n),r.appendChild(t),In.setDocTitle("SaberProject | "+(e?"Sign Up":"Login")),In.setTitle(e?"Регистрация":"Вход"),In.setContent(r),In.disableCancelBtn(),In.disableOkBtn(),In.open()}class er{static show(e=!1){Qn(e)}static appendWarning(e){const t=In.getContent();t&&(t.innerHTML+=e)}}function tr(e,t){"5"===(e/100+"")[0]&&In.setTitle(`Сервис временно не доступен: ${e}`),"4"===(e/100+"")[0]&&(401===e?(In.setTitle("Внимание"),t="Для этого действия необходима авторизация"):In.setTitle(`Ошибка ${e}`)),In.setContent(t),In.open(!1)}class nr{static signup(e){er.show(e)}static netOrServerError(e,t){tr(e,t)}static informativeMsg(e="",t=""){!function(e="",t=""){In.setTitle(e),In.setContent(t),In.open(!1)}(e,t)}static confirm(e,t,n,r){!function(e,t,n,r=(()=>{})){In.setTitle(e),In.setContent(t),In.changeBtnOkSign("Да"),In.enableOkBtn(),In.setOkBtnAction(n),In.changeBtnCancelSign("Отмена"),In.enableCancelBtn(),In.setCancelBtnAction(r),In.open(!0)}(e,t,n,r)}static warn(e,t,n){!function(e,t,n=(()=>{})){In.setTitle(e),In.setContent(t),In.enableOkBtn(),In.changeBtnOkSign("Понятно"),In.setOkBtnAction(n),In.disableCancelBtn(),In.open(!0)}(e,t,n)}}function rr({currentTarget:e}){const t=fe.getState().profilePage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>Se.getUserWindowHeight()||(console.log("[Profile Page] scroll trigger"),fe.dispatch(ir))}async function ir(){const e=fe.getState().profilePage;e.isEndFound||e.isLoading||(fe.dispatch(Ot()),await ke({url:`/articles/author?idLastLoaded=${e.idLastLoaded}&login=${e.user.login}`}).then((({status:t,response:n})=>{if(t===Ae.ok)return r=n.data,void fe.dispatch(xt(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;tr(t,n.msg)})).catch((e=>console.warn(e.message))),fe.dispatch(It()))}class sr extends t{constructor(e){super(e),this.view=new Jn(e),fe.subscribe(a,(()=>{this.isActive()&&(console.log("[ProfilePage] Logout reaction"),-1!==document.URL.indexOf("/profile")&&Se.redirect("/"))})),fe.subscribe(o,(()=>{this.isActive()&&(console.log("[ProfilePage] Login reaction"),-1===document.URL.indexOf("/profile")&&fe.getState().profilePage.user.login===fe.getState().authorization.login&&Se.redirect("/profile"))})),fe.subscribe(J,(()=>{fe.dispatch(Tt())}))}show(){super.show();const e=fe.getState().profilePage,t=fe.getState().authorization;if(-1!==document.URL.indexOf("/profile"))fe.dispatch(kt(t)),fe.dispatch(Tt());else{const n=document.URL.slice(document.URL.indexOf("user/")+5);if(console.warn("[ProfilePage] user from Url ",document.URL,n),""===n&&Se.redirect("/404"),n!==e.user.login){if(n===t.login)return void Se.redirect("/profile");fe.dispatch(At({login:n})),fe.dispatch(Tt()),ke({url:`/user?user=${n}`}).then((({status:e,response:t})=>{e!==Ae.ok?(tr(e,t.msg),Se.redirect("/")):fe.dispatch(kt(t.data))})).catch((e=>console.warn(e.message)))}}fe.dispatch(vt("profile",`SaberProject | ${e.user.login}`)),0===fe.getState().profilePage.cards.length&&fe.dispatch(ir);const n=this.view.root.querySelector(".content");n?n.addEventListener("scroll",rr):console.warn("[ProfilePage] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",rr):console.warn("[ProfilePage] нет дивака .content")}redirect(e){const t=fe.getState().authorization;return-1===document.URL.indexOf("/profile")||t.isAuthenticated?"":"/login"}}function or(e){var t=""+e,n=ar.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var ar=/["&<>]/;function cr(e){var t=""+e,n=lr.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var lr=/["&<>]/;function dr(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=ur(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function ur(e){var t=""+e,n=pr.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var pr=/["&<>]/;function hr(e){var t,n="",r=e||{};return function(e,r,i,s,o,a){n=n+'<div class="settings__row"><div class="settings__label">'+ur(null==(t=e)?"":t)+'</div><div class="settings__field">',null!=s&&null!=i&&o&&(n=n+'<input class="settings__input"'+dr("type",`${a}`,!0,!1)+dr("name",`${r}`,!0,!1)+dr("placeholder",`${s}`,!0,!1)+dr("pattern",`${i}`,!0,!1)+dr("required",`${o}`,!0,!1)+"/>"),null==s||null==i||o||(n=n+'<input class="settings__input"'+dr("type",`${a}`,!0,!1)+dr("name",`${r}`,!0,!1)+dr("placeholder",`${s}`,!0,!1)+dr("pattern",`${i}`,!0,!1)+"/>"),null!=s&&null==i&&o&&(n=n+'<input class="settings__input"'+dr("type",`${a}`,!0,!1)+dr("name",`${r}`,!0,!1)+dr("placeholder",`${s}`,!0,!1)+dr("required",`${o}`,!0,!1)+"/>"),null==s||null!=i||o||(n=n+'<input class="settings__input"'+dr("type",`${a}`,!0,!1)+dr("name",`${r}`,!0,!1)+"/>"),null==s&&null!=i&&o&&(n=n+'<input class="settings__input"'+dr("type",`${a}`,!0,!1)+dr("name",`${r}`,!0,!1)+dr("pattern",`${i}`,!0,!1)+dr("required",`${o}`,!0,!1)+"/>"),null!=s||null==i||o||(n=n+'<input class="settings__input"'+dr("type",`${a}`,!0,!1)+dr("name",`${r}`,!0,!1)+dr("pattern",`${i}`,!0,!1)+"/>"),null==s&&null==i&&o&&(n=n+'<input class="settings__input"'+dr("type",`${a}`,!0,!1)+dr("name",`${r}`,!0,!1)+dr("required",`${o}`,!0,!1)+"/>"),null!=s||null!=i||o||(n=n+'<input class="settings__input"'+dr("type",`${a}`,!0,!1)+dr("name",`${r}`,!0,!1)+"/>"),n+="</div></div>"}.call(this,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"pattern"in r?r.pattern:"undefined"!=typeof pattern?pattern:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0,"required"in r?r.required:"undefined"!=typeof required?required:void 0,"type"in r?r.type:"undefined"!=typeof type?type:void 0),n}class gr extends n{render(){let e="";e+=hr({label:"Имя",type:"text",name:"username"}),e+=hr({label:"Фамилия",type:"text",name:"surname"}),e+=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="settings__row"><div class="settings__label">'+cr(null==(t=e)?"":t)+'</div><div class="settings__field"><textarea class="settings__input"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' name="name"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),1)?' name="'+(t=cr(t))+'"':" name='"+t.replace(/'/g,"&#39;")+"'"}(0,`${r}`)+">"+cr(null==(t=i||"")?"":t)+"</textarea></div></div>"}.call(this,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0),n}({label:"О себе",name:"description"}),e+=hr({label:"Фото",type:"file",name:"photo",placeholder:"Загрузите фото"});const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="settings"><div class="settings__links"><a class="settings__other-page"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' href="href"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),1)?' href="'+(t=or(t))+'"':" href='"+t.replace(/'/g,"&#39;")+"'"}(0,`${r}`)+">"+or(null==(t=i)?"":t)+'</a></div><form class="settings__form"><div class="settings__rows">'+(null==(t=e)?"":t)+'<div class="settings__row"><div class="settings__label" id="settings-warning-label" style="color: transparent;">|</div><div class="settings__field"><div class="settings__input settings__warning">Поля заполнены неверно</div></div></div></div><div class="settings__footer"><input class="btn_color-elementary" type="submit" name="btn-submit" value="Сохранить"/><a href="/"><input class="btn_color-elementary" data-router="ignore" type="button" value="Назад"/></a></div></form></div>'}.call(this,"form_rows"in r?r.form_rows:"undefined"!=typeof form_rows?form_rows:void 0,"other_page_href"in r?r.other_page_href:"undefined"!=typeof other_page_href?other_page_href:void 0,"other_page_name"in r?r.other_page_name:"undefined"!=typeof other_page_name?other_page_name:void 0),n}({other_page_name:"сменить пароль",other_page_href:"",form_rows:e}),t.firstChild}}class fr extends r{constructor(){super(),this.view=new gr}render(){return super.render(),this.root=this.view.render(),this.root}appendWarning(e){const t=this.root.querySelector(".settings__warning");t||console.warn("[SignupFormView]\n        appendWarning call while SignupForm was not rendered"),t.style.display="block",t.textContent=e}}class vr extends e{constructor(e){super(e),this.pageComponents={settingsForm:new fr}}render(){super.render(),this.root.appendChild(Kt("Настройки пользователя",this.pageComponents.settingsForm))}}var mr=/["&<>]/;function _r(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=br.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}var yr=Object.prototype.hasOwnProperty,br=/["&<>]/;function wr(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)yr.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function Sr(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=Lr.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}var Er=Object.prototype.hasOwnProperty,Lr=/["&<>]/;function Cr(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)Er.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function Ar(e){var t,n="",r={},i=e||{};return function(e,i){r.tagMixin=t=function(e,r,i=!1){this&&this.block,this&&this.attributes,n=n+'<div class="tags__tag-content"'+Sr("style",Cr(`background-color: ${r}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=e)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+Sr("style",Cr(`background-color: ${r}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=e)?"":t)+"</div>",n+="</div>"},n+='<div class="plate"><div class="categories__search-block"><div class="categories__search"><input class="categories__search-input" type="text" id="categories-search" placeholder="фильтр"/></div></div><div class="tags">',e.isArray(i)&&function(){var e=i;if("number"==typeof e.length)for(var t=0,n=e.length;t<n;t++){var s=e[t];r.tagMixin(s.content,s.color)}else for(var t in n=0,e)n++,s=e[t],r.tagMixin(s.content,s.color)}.call(this),n+="</div></div>"}.call(this,"Array"in i?i.Array:"undefined"!=typeof Array?Array:void 0,"categories"in i?i.categories:"undefined"!=typeof categories?categories:void 0),n}class kr extends n{render(e){const t=document.createElement("div");return t.innerHTML=Ar({categories:e.map((e=>({content:e,color:be()})))}),t.firstChild}}class xr extends r{constructor(e,t,n,r){super(),this.view=new kr,this.setSelection=t,this.clearSelection=n,this.getCurrentSelection=e,this.unsubscribes.push(fe.subscribe(r,(e=>{this.markSelectedCategory(e)})))}render(){super.render(),this.root=this.view.render(Wt);const e=this.root.querySelector("div.tags");return this.root.querySelectorAll("div.tags__tag-content").forEach((e=>{e.addEventListener("click",(({target:e})=>{const t=this.getCurrentSelection();e.innerHTML===t?fe.dispatch(this.clearSelection()):fe.dispatch(this.setSelection(e.textContent))})),e.textContent.trim()===this.getCurrentSelection()&&e.classList.add("categories__choosen")})),this.root.querySelector("input.categories__search-input").oninput=t=>{const n=t.target.value.trim().toLocaleLowerCase();""!=n?e.childNodes.forEach((e=>{const t=e.lastChild,r=t.textContent.toLocaleLowerCase().indexOf(n);-1==r?(t.parentElement.style.display="none",t.innerHTML=t.textContent):(t.parentElement.style.display="",t.innerHTML=((e,t,n)=>e.slice(0,t)+'<span class="categories__mark">'+e.slice(t,t+n)+"</span>"+e.slice(t+n))(t.textContent,r,n.length))})):e.childNodes.forEach((e=>{const t=e.lastChild;t.parentElement.style.display="",t.innerHTML=t.textContent}))},this.root}markSelectedCategory(e){const t=this.root.querySelector("div.tags");t?t.childNodes.forEach((t=>{t.classList.remove("categories__choosen"),t.innerText===e&&t.classList.add("categories__choosen")})):console.warn("{CategoryChoiceBar} component hasn't been rendered yet")}}function Tr(e=new Date){const t=e=>e<10?"0"+e:e;return[t(e.getHours()),t(e.getMinutes())].join(":")+" "+[t(e.getDate()),t(e.getMonth()+1),e.getFullYear()].join("/")}class Or extends n{constructor(e,t,n,r){super(),this.innerComponents={categoryChoiceBar:new xr(e,t,n,r)},this.root=null,this.tagBox=null,this.previewBox=null,this.textAreaInput=null,this.titleInput=null,this.category=null}render(e){const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r={};return function(e){n=n+'<div class="article-create"><div class="article-create__title">Создание статьи</div><form class="article-create__form"><div class="article-create__category_selector"><div class="article-create__row"><div class="article-create__label">Выберите категорию</div></div></div><div class="article-create__right"><button class="btn_color-elementary article-create__del-btn">Удалить</button><button class="btn_color-elementary article-create__clear-btn">Очистить</button></div><div class="article-create__rows"><div class="article-create__row"><div class="article-create__label">Заголовок</div><div class="article-create__field"><input class="article-create__input" type="text" name="title"/></div></div><div class="article-create__row"><div class="article-create__label">Текст статьи</div><div class="article-create__field"><textarea class="article-create__input article-create__text" name="text"></textarea></div></div><div class="article-create__row"><div class="article-create__label">Теги</div><div class="article-create__tags-actions"><input class="article-create__input-tag" type="text" name="tag" maxlength="20"/><button class="article-create__add-tag">+</button></div><div class="article-create__tags">'+(null==(t=e)?"":t)+'</div></div></div><div class="article-create__right"><input class="btn_color-elementary" type="file" name="photo" value="Заставка"/><input class="btn_color-elementary" type="button" name="clear-photo" value="Удалить картинку"/></div><div class="article-create__preview"><div class="article-create__preview__title">Предпросмотр:</div><div class="article-create__preview__content"></div><div class="article-create__tags-actions"></div></div><div class="article-create__right"><input class="btn_color-elementary" type="submit" name="btn-submit" value="Создать"/></div></form></div>'}.call(this,"tags"in r?r.tags:"undefined"!=typeof tags?tags:void 0),n}(),this.category=t.firstChild.querySelector(".article-create__category_selector"),this.category.querySelector(".article-create__row").appendChild(this.innerComponents.categoryChoiceBar.render()),t.firstChild.querySelector(".plate").className="article-create__category_selector",this.previewBox=t.firstChild.querySelector(".article-create__preview__content"),this.previewBox.innerHTML=mn({id:"-preview",datetime:Tr(),category:"категория не выбрана",author:e,comments:"",likes:""}).replace("card","article-create__preview__card").replace(/style=".*\n.*\n.*\n.*;"/,""),this.tagBox=this.previewBox.querySelector(".tags"),this.textAreaInput=t.firstChild.querySelector("textarea"),this.titleInput=t.firstChild.querySelector('input[name="title"]'),this.root=t.firstChild,t.firstChild}appendTag(e,t){if(null===this.tagBox)return void console.warn("{Editor} component hasn't been rendered yet");const n=document.createElement("div");n.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="tags__tag-content"'+_r("style",wr(`background-color: ${e}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=r)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+_r("style",wr(`background-color: ${e}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=r)?"":t)+"</div>",n+="</div>"}.call(this,"color"in r?r.color:"undefined"!=typeof color?color:void 0,"content"in r?r.content:"undefined"!=typeof content?content:void 0,"cross"in r?r.cross:"undefined"!=typeof cross?cross:void 0),n}({content:e,color:be(),cross:!0});const r=n.firstChild;r.querySelector(".tags__tag__del-btn").addEventListener("click",(e=>{t(),r.remove()})),this.tagBox.appendChild(r)}clearTags(){null!==this.tagBox?this.tagBox.innerHTML="":console.warn("{Editor} component hasn't been rendered yet")}changePreviewImage(e){null!==this.previewBox?this.previewBox.querySelector(".article-create__preview__card").style.cssText=function(e){return`background: -webkit-gradient(linear, left top, left bottom,from(rgba(0, 0, 0, 0.7)), to(rgba(0, 0, 0, 0.7))), url(${e});background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),url(${e});\n  background-size: cover;\n  background-repeat: no-repeat;`}(e):console.warn("{Editor} component hasn't been rendered yet")}clearPreviewImage(){this.previewBox.querySelector(".article-create__preview__card").style.cssText=""}changePreviewText(e){null!==this.previewBox?(e=e.slice(0,350),this.previewBox.querySelector(".card__description").textContent=e):console.warn("{Editor} component hasn't been rendered yet")}changePreviewTitle(e){null!==this.previewBox?this.previewBox.querySelector(".preview__title").textContent=e:console.warn("{Editor} component hasn't been rendered yet")}changePreviewCategory(e){null!==this.previewBox&&null!==this.root?""===e?(this.previewBox.querySelector(".card__category").textContent="категория не выбрана",this.root.querySelector(".article-create__label").innerHTML="Выберите категорию | <strong>категория не выбрана</strong>"):(this.previewBox.querySelector(".card__category").textContent=e,this.root.querySelector(".article-create__label").innerHTML=`Выберите категорию | <strong>${e}</strong>`):console.warn("{Editor} component hasn't been rendered yet")}setContent(e,t){null!==this.textarea&&null!==this.titleInput?(this.textAreaInput.value=t,this.titleInput.value=e,this.changePreviewText(t),this.changePreviewTitle(e)):console.warn("{Editor} can't use setContent: component hasn't been rendered yet")}}class Ir extends r{constructor(){super(),this.view=new Or((()=>{const e=fe.getState().editor;return e[e.currentId]?.category||""}),Jt,Gt,z),this.unsubscribes.push(fe.subscribe(G,(()=>{this.clear()})),fe.subscribe(J,(()=>{this.clear()})),fe.subscribe(B,(()=>{this.changeToCreate(),this.setContent(fe.getState().editor[0])})),fe.subscribe(F,(({id:e})=>{this.changeToUpdate(),this.setContent(fe.getState().editor[e])})),fe.subscribe(z,(e=>{this.view.changePreviewCategory(e)})))}render(){super.render(),this.root=this.view.render(fe.getState().authorization),fe.getState().editor[fe.getState().editor.currentId]||fe.dispatch(Dt());const e=fe.getState().editor;this.setContent(e[e.currentId]),"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId?this.changeToUpdate():this.changeToCreate(),e[e.currentId].tags.forEach((e=>{this.view.appendTag(e,(()=>fe.dispatch(Ft(e))))}));const t=this.root.querySelector("input.article-create__input-tag");this.root.querySelector(".article-create__add-tag").addEventListener("click",(e=>{e.preventDefault();const n=t.value.trim().replace(/\s+/g,"_"),r=fe.getState().editor;""===n||r[r.currentId].tags.includes(n)||(fe.dispatch(Ht(n)),this.view.appendTag(n,(()=>fe.dispatch(Ft(n)))),t.value="")}));const n=this.root.querySelector("textarea"),r=this.root.querySelector('input[name="title"]'),i=e=>{const t=r.value,i=n.value;fe.dispatch(Mt(fe.getState().editor.currentId,{title:t,text:i}))};return n.addEventListener("change",i),r.addEventListener("input",i),n.addEventListener("input",(e=>{this.view.changePreviewText(n.value)})),r.addEventListener("input",(e=>{const t=r.value;this.view.changePreviewTitle(t)})),this.root.querySelector(".article-create__clear-btn").addEventListener("click",(e=>{e.preventDefault(),nr.confirm("Вы собираетесь очистить всё","Продолжив, Вы безвозвратно сотрете то, что написали",(()=>{this.clear()}))})),this.root.querySelector(".article-create__del-btn").addEventListener("click",(e=>{e.preventDefault(),nr.confirm("Точно хотите удалить?","Продолжив, вы удалите статью",(()=>{xe({url:`/articles/delete?id=${fe.getState().editor.currentId}`,body:{}}).then((({status:e,response:t})=>e===Ae.ok?(fe.dispatch(Ut(fe.getState().editor.currentId)),nr.informativeMsg("Успех!","Статья была удалена"),void redirect("/profile")):e===Ae.invalidSession?(fe.dispatch(ft()),void nr.signup(!1)):void nr.netOrServerError(e,t.msg)))}))})),this.root.querySelector("form").addEventListener("submit",(e=>{e.preventDefault();const t=this.root.querySelector("textarea")?.value.trim(),n=this.root.querySelector('input[name="title"]')?.value.trim();if(!t||!n||""===t||""===n)return console.warn("{Editor} пустые статьи - это плохо:",{text:t},{title:n}),void nr.informativeMsg("Ошибка","Заголовок и текст статьи не должны быть пустыми");const r=fe.getState().editor,i=function(){const e=fe.getState().editor;return"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId}(),s=r[r.currentId].category;if(""===r[r.currentId].category)return void nr.informativeMsg("Ошибка","Не забудьте указать одну из категорий, наиболее точно описывающую Вашу статью");const o={title:n,text:t,category:s,tags:r[r.currentId].tags};i&&Object.assign(o,{id:r.currentId});let a=0;me(r[r.currentId].img).then((e=>Te({url:"/img/upload",body:e}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data.imgId):(a=e,r(new Error(t.msg)))})))).catch((e=>new Promise(((t,n)=>{0===a?t(""):n(e)})))).then((e=>xe({url:"/articles/"+(i?"update":"create"),body:{...o,img:e}}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data):(a=e,r(new Error(t.msg)))})))).then((e=>{fe.dispatch($t(e)),nr.informativeMsg("Успех!","Статья успешно "+(i?"изменена":"создана")),redirect(`/article/${i?r.currentId:e}`)})).catch((({message:e})=>{if(a===Ae.invalidSession)return fe.dispatch(ft()),void nr.signup(!1);nr.netOrServerError(a,e)}))})),this.root.querySelector('input[name="photo"]').addEventListener("change",(e=>{const t=e.currentTarget.files[0];t.type.startsWith("image/")?_e(t).then((e=>{this.view.changePreviewImage(e),fe.dispatch(Bt(e))})):nr.warn("Ошибка","Выберите изображение")})),this.root.querySelector('input[name="clear-photo"]').addEventListener("click",(e=>{e.preventDefault(),this.view.clearPreviewImage(),fe.dispatch(jt())})),this.root}setContent({title:e,text:t,img:n,category:r}){(e||t)&&console.log("{EDITOR} set content"),this.view.setContent(e,t),this.view.changePreviewCategory(r),n&&(""!==n?this.view.changePreviewImage(n):this.view.clearPreviewImage())}clear(){console.log("{EDITOR} clear"),this.setContent({title:"",text:"",img:"",category:""})}changeToCreate(){const e=this.root.querySelector('input[name="btn-submit"]');e?(e.value="Создать",this.root.querySelector(".article-create__title").textContent="Создание статьи",this.root.querySelector(".article-create__del-btn").style.display="none",this.view.category.style.display="flex"):console.warn("{Editor} can't use changeToCreate:\n          component hasn't been rendered yet")}changeToUpdate(){const e=this.root.querySelector('input[name="btn-submit"]');e?(e.value="Изменить",this.root.querySelector(".article-create__title").textContent="Изменение статьи",this.root.querySelector(".article-create__del-btn").style.display="flex",this.view.category.style.display="none"):console.warn("{Editor} can't use changeToCreate:\n          component hasn't been rendered yet")}}class Rr extends e{constructor(e){super(e),this.pageComponents={editor:new Ir}}render(){super.render(),this.root.appendChild(Kt("",this.pageComponents.editor))}}function Nr(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=qr(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function qr(e){var t=""+e,n=Dr.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var Dr=/["&<>]/;class Pr extends n{constructor(){super()}render(e){const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i,s,o,a,c,l,d,u,p){n+='<div class="article-view"><div class="article-view__content"><div class="article-view__top"><a class="article-view__back-btn" id="article-change-btn" style="display:none">Изменить</a><a class="article-view__back-btn" data-section="back">Назад</a></div><div class="article-view__author-time">',"object"==typeof r?n=n+'<div class="article-view__author"> <a'+Nr("href",`/user/${r.login}`,!0,!1)+">"+qr(null==(t=r.login)?"":t)+"</a></div>":n+='<div class="article-view__author">Ошибка</div>',n=n+'<div class="article-view__time">'+qr(null==(t=o)?"":t)+'</div><div class="article-view__category"><a'+Nr("href",`/categories/${i}`,!0,!1)+">"+qr(null==(t=i)?"":t)+'</a></div></div><div class="article-view__title">'+qr(null==(t=p)?"":t)+'</div><div class="article-view__info"><div class="article-view__tags">',e.isArray(d)&&function(){var e=d.length?d:[""];if("number"==typeof e.length)for(var r=0,i=e.length;r<i;r++){var s=e[r];n=n+'<a class="article-view__tag">'+qr(null==(t=s)?"":t)+"</a>"}else for(var r in i=0,e)i++,s=e[r],n=n+'<a class="article-view__tag">'+qr(null==(t=s)?"":t)+"</a>"}.call(this),n=n+'</div><div class="action-btns"><div class="icon action-btns_m-right"><div class="icon__text">'+qr(null==(t=a||"")?"":t)+'</div><div class="action-btns__likes-icon icon__img"></div></div><div class="icon action-btns_m-right"><div class="icon__text">'+qr(null==(t=s||"")?"":t)+'</div><div class="action-btns__comments-icon icon__img"></div></div><div class="icon"><div class="action-btns__share-icon icon__img"></div></div></div></div></div><img class="article-view__main-picture"'+Nr("src",`${l}`,!0,!1)+'/><div class="article-view__content"><div class="article-view__text">'+qr(null==(t=u)?"":t)+'</div><div class="article-view__add-comment"><input class="article-view__comment-input" type="text" name="answer"'+Nr("placeholder",`${c||""}`,!0,!1)+'/><button class="action-btns__send-icon icon__img article-view__send-comment-btn"></button></div><div class="comments-show"><button class="action-btns__arrow-icon icon-small__img comments-show__btn rotate-180"></button><div class="comments-show__text">Скрыть комментарии</div></div><div class="comments" id="comments"></div></div></div>'}.call(this,"Array"in r?r.Array:"undefined"!=typeof Array?Array:void 0,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"category"in r?r.category:"undefined"!=typeof category?category:void 0,"comments"in r?r.comments:"undefined"!=typeof comments?comments:void 0,"datetime"in r?r.datetime:"undefined"!=typeof datetime?datetime:void 0,"likes"in r?r.likes:"undefined"!=typeof likes?likes:void 0,"message"in r?r.message:"undefined"!=typeof message?message:void 0,"previewUrl"in r?r.previewUrl:"undefined"!=typeof previewUrl?previewUrl:void 0,"tags"in r?r.tags:"undefined"!=typeof tags?tags:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}(e),t.firstChild}}function $r(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Ur(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Mr(e,t){return Array.isArray(e)?function(e,t){for(var n,r="",i="",s=Array.isArray(t),o=0;o<e.length;o++)(n=Mr(e[o]))&&(s&&t[o]&&(n=Ur(n)),r=r+i+n,i=" ");return r}(e,t):e&&"object"==typeof e?function(e){var t="",n="";for(var r in e)r&&e[r]&&Hr.call(e,r)&&(t=t+n+r,n=" ");return t}(e):e||""}function Ur(e){var t=""+e,n=Fr.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}var Hr=Object.prototype.hasOwnProperty,Fr=/["&<>]/;function Br(e,t){if(1===arguments.length){for(var n=e[0],r=1;r<e.length;r++)n=Br(n,e[r]);return n}for(var i in t)if("class"===i){var s=e[i]||[];e[i]=(Array.isArray(s)?s:[s]).concat(t[i]||[])}else if("style"===i){s=(s=jr(e[i]))&&";"!==s[s.length-1]?s+";":s;var o=jr(t[i]);o=o&&";"!==o[o.length-1]?o+";":o,e[i]=s+o}else e[i]=t[i];return e}function jr(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)Hr.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function Jr(e){var t,n="",r={},i=e||{};return function(e,i,s,o,a,c,l){r.avatar=t=function(){this&&this.block;var e=this&&this.attributes||{};n=n+"<img"+function(e,t){var n="";for(var r in e)if(Hr.call(e,r)){var i=e[r];if("class"===r){n=$r(r,i=Mr(i),!1,false)+n;continue}"style"===r&&(i=jr(i)),n+=$r(r,i,!1,false)}return n}(Br([{onerror:"console.warn(`не удалось загрузить аватар ${this.src}`);this.src='/static/img/user_icon_loading.svg';this.onerror = undefined;"},e]))+"/>"},n=n+'<div class="comment"'+$r("id",`${o}`,!0,!1)+$r("data-author",`${i.login}`,!0,!1)+'><div class="comment__content">',r.avatar.call({attributes:{class:"comment__author-photo",src:Ur(`${i.avatarUrl}`)}}),n=n+'<div class="comment__description"><div class="comment__author-name">'+Ur(null==(t=i.lastName)?"":t)+" "+Ur(null==(t=i.firstName)?"":t)+'</div><div class="comment__text">'+Ur(null==(t=l)?"":t)+'</div></div></div><div class="comment__bottom"><div class="action-btns">',n=(n=a?n+'<div class="comment__time">изменено '+Ur(null==(t=s)?"":t)+"</div>":n+'<div class="comment__time">'+Ur(null==(t=s)?"":t)+"</div>")+'<button class="comment__edit-btn" style="display: none">Изменить</button><button class="comment__answer-btn">Ответить</button><div class="icon-small action-btns_m-right"><div class="icon-small__text">'+Ur(null==(t=c)?"":t)+'</div><div class="action-btns__likes-icon icon-small__img"></div></div></div></div><div class="comment__answers">'+(null==(t=e)?"":t)+"</div></div>"}.call(this,"answers"in i?i.answers:"undefined"!=typeof answers?answers:void 0,"author"in i?i.author:"undefined"!=typeof author?author:void 0,"datetime"in i?i.datetime:"undefined"!=typeof datetime?datetime:void 0,"id"in i?i.id:"undefined"!=typeof id?id:void 0,"isEdited"in i?i.isEdited:"undefined"!=typeof isEdited?isEdited:void 0,"likes"in i?i.likes:"undefined"!=typeof likes?likes:void 0,"text"in i?i.text:"undefined"!=typeof text?text:void 0),n}var Gr=/["&<>]/;function Wr(e){var t="",n=e||{};return function(e){t=t+'<div class="article-view__add-comment"><input class="article-view__comment-input" type="text" name="answer"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=Gr.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("placeholder",`${e||""}`,!0,!1)+'/><button class="action-btns__send-icon icon__img article-view__send-comment-btn"></button></div>'}.call(this,"message"in n?n.message:"undefined"!=typeof message?message:void 0),t}function Vr(e,t){const n=e.querySelector(".comment__edit-btn");n.style.display="block",n.addEventListener("click",(n=>{n.preventDefault(),Yr(e,"изменение комментария",t,!1,(n=>{let r=0;xe({url:"/comments/update",body:{text:n,id:t.id}}).then((({status:e,response:t})=>new Promise(((n,i)=>{e===Ae.ok?n(t.data):(r=e,i(new Error(t.msg)))})))).then((n=>{n=Ne(n,fe.getState().authorization),e.innerHTML=Jr(n),fe.dispatch(sn(t.id,n.text))})).catch((e=>{0!==r?nr.netOrServerError(r,e.message):console.warn(e.message)}))}))}))}function zr(e,t,n){e.querySelectorAll(".comment__answer-btn").forEach((r=>r.addEventListener("click",(r=>{r.preventDefault(),Yr(e,"ответ на комментарий",n,!0,(r=>{let i=0;xe({url:"/comments/create",body:{text:r,parentId:n.id,articleId:parseInt(t,10)}}).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data):(i=e,r(new Error(t.msg)))})))).then((r=>{const i=document.createElement("div");r=Ne(r),i.innerHTML=Jr(r),Vr(i,r),zr(i,t,r),e.querySelector(".comment__answers").appendChild(i),fe.dispatch(on(n.id,r))})).catch((e=>{0!==i?nr.netOrServerError(i,e.message):console.warn(e.message)}))}))}))))}function Yr(e,t,n,r,i){const s=document.createElement("div");s.innerHTML=Wr({message:t});const o=s.firstChild;o.classList.add("comment-answer-input");const a=o.querySelector("input");r||(a.value=n.text);const c=()=>{const t=a.value.trim();if(t!==n.text&&""!==t){i(t);try{e.removeChild(o)}catch{}}},l=o.querySelector(".article-view__send-comment-btn");l.addEventListener("click",(e=>{e.preventDefault(),c()})),e.appendChild(o);const d=t=>{e.removeChild(o)};a.addEventListener("focusout",d),l.addEventListener("mouseover",(e=>a.removeEventListener("focusout",d))),l.addEventListener("mouseout",(e=>a.addEventListener("focusout",d))),a.addEventListener("keydown",(({keyCode:e,target:t})=>{13===e&&c()})),a.focus()}class Zr extends r{constructor(){super(),this.view=new Pr,this.unsubscribes.push(fe.subscribe(Z,(e=>{const t=fe.getState().reader;this.openArticle(t[e])})),fe.subscribe(X,(({id:e,comments:t})=>{fe.getState().reader.currentId===e&&this.setComments(t)})),fe.subscribe(o,(()=>{const e=this.root.querySelector("#article-change-btn");if(!e)return void console.warn("{READER} component hasn't been rendered yet");this.root.querySelector("div.article-view__author > a").textContent===fe.getState().authorization.login&&(e.style.display="block",e.href="/editor",e.addEventListener("click",Xr));const t=fe.getState().reader;this.setComments(t[t.currentId].commentsContent)})),fe.subscribe(a,(()=>{const e=this.root.querySelector("#article-change-btn");e?(e.style.display="none",e.href=void 0,e.removeEventListener("click",Xr)):console.warn("{READER} component hasn't been rendered yet")})))}render(){super.render();const e=fe.getState().reader;return this.root=this.view.render(e[e.currentId]),Kr(this.root),this.root}openArticle(e){this.root.innerHTML="",this.view.render(e).childNodes.forEach((e=>{this.root.appendChild(e.cloneNode(!0))})),Kr(this.root);const t=fe.getState().authorization.login;if(e.author.login===t){const e=this.root.querySelector("#article-change-btn");e.style.display="block",e.href="/editor"}}setComments(e){const t=this.root.querySelector("#comments");t.innerHTML="",e.forEach((e=>{const n=document.createElement("div");let r="";e.answers.forEach((e=>{"answers"in e&&(console.warn("Не должно быть вложенности более 1"),delete e.answers),r+=Jr(e)})),n.innerHTML=Jr({...e,answers:r});const i=n.firstChild;zr(i,fe.getState().reader.currentId,e);const s=fe.getState().authorization.login;s===e.author.login&&Vr(i,e),i.querySelector(".comment__answers").querySelectorAll(`div[data-author="${s}"]`).forEach((t=>{const n=e.answers.filter((e=>e.id+""===t.id))[0];Vr(t,n)})),t.appendChild(i)}))}}function Kr(e){e.querySelector(".article-view__send-comment-btn").addEventListener("click",(t=>{t.preventDefault(),function(e){if(!fe.getState().authorization.isAuthenticated)return void nr.warn("Сначала авторизируйтесь","Чтобы оставить комментарий, выполните вход");const t=e.querySelector("input.article-view__comment-input");if(""!=t.value.trim()){let n=0;const r=fe.getState().reader.currentId;xe({url:"/comments/create",body:{articleId:parseInt(r,10),parentId:0,text:t.value.trim()}}).then((({status:e,response:t})=>new Promise(((r,i)=>{e===Ae.ok?r(t.data):(n=e,i(new Error(t.msg)))})))).then((t=>{t=Ne(t);const n=document.createElement("div");n.innerHTML=Jr(t);const i=n.firstChild;zr(i,r,t),Vr(i,t),fe.dispatch(an(t)),e.querySelector(".comments").appendChild(i)})).catch((e=>{0!==n?nr.netOrServerError(n,e.message):console.warn(e.message)}))}}(e)})),e.querySelector(".comments-show").addEventListener("click",(t=>{t.preventDefault(),function(e){let t=!0;const n=e.querySelector(".comments"),r=e.querySelector(".comments-show__text"),i=e.querySelector(".comments-show__btn");i.classList.contains("rotate-180")?(r.innerText="Показать комментарии",i.classList.remove("rotate-180"),t=!0):(r.innerText="Скрыть комментарии",i.classList.add("rotate-180"),t=!1),t?n.classList.add("hide"):n.classList.remove("hide")}(e)}));const t=e.querySelectorAll(".comments__comment");for(const e of t)answerOnComment(e)}const Xr=e=>{e.preventDefault();const t=fe.getState().reader,n=t[t.currentId];fe.dispatch(Pt(n.id,n))};class Qr extends e{constructor(e){super(e),this.pageComponents={reader:new Zr}}render(){super.render(),this.root.appendChild(Kt("",this.pageComponents.reader))}}const ei=function(){return{type:L}},ti=function(){return{type:C}},ni=function(){return{type:S}},ri=function(){return{type:E}},ii=function(e,t){return t.forEach((e=>{Ie(e),Ie(e.author)})),{type:b,payload:{idLastLoaded:e,cards:t}}},si=function(){return{type:w}},oi=function(e){return{type:A,payload:e}},ai=function(){return{type:A,payload:""}};class ci extends e{constructor(e){super(e),this.pageComponents={categoryChoose:new xr((()=>fe.getState().categoryPage.currentCategory),oi,ai,A),feed:new ln(_n,"categoryPage",b,w,S,E,ni,(()=>(console.log("{CategoryPage feed} isEndFound is not been reset"),{type:"__EMPTY__"})))}}render(){super.render(),this.root.appendChild(Kt("Поиск по категориям",this.pageComponents.categoryChoose,this.pageComponents.feed))}}function li({currentTarget:e}){const t=fe.getState().categoryPage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>we()||(console.log("[Category Page] scroll trigger"),fe.dispatch(di))}async function di(){const e=fe.getState().categoryPage;e.isEndFound||e.isLoading||(fe.dispatch(ei()),await ke({url:`/articles/category?idLastLoaded=${e.idLastLoaded}&category=${e.currentCategory}`}).then((({status:t,response:n})=>{if(t===Ae.ok)return r=n.data,void fe.dispatch(ii(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;t/500==1&&In.setTitle(`Сервис временно не доступен: ${t}`),t/400==1&&In.setTitle(`Ошибка ${t}`),In.setContent(n.msg),In.open(!1)})).catch((e=>console.warn(e.message))),fe.dispatch(ti()))}class ui extends t{constructor(e){super(e),this.view=new ci(e),fe.subscribe(A,(e=>{""!==e&&(fe.dispatch(si()),fe.dispatch(ri()),di()),history.pushState(null,"","/categories"+(""!==e?"/"+e:"")),fe.dispatch(vt("categories",`SaberProject |\n              ${""!==e?e.charAt(0).toUpperCase()+e.slice(1):"Categories"}`))})),fe.subscribe(J,(()=>{fe.dispatch(si())}))}show(){super.show();const e=document.querySelector(".content");e?e.addEventListener("scroll",li):console.warn("[Category Page] нет дивака .content")}hide(){super.hide();const e=document.querySelector(".content");e?e.removeEventListener("scroll",li):console.warn("[Category Page] нет дивака .content")}isActive(){let e="";const t=document.URL.indexOf("categories/");if(-1!==t){try{e=decodeURI(document.URL.slice(t+11))}catch(e){console.error(e)}console.log("[CategoryPage] (isActive) category from Url:",e),fe.dispatch(oi(e))}else-1!==document.URL.indexOf("categories")&&fe.dispatch(ai());return""===fe.getState().categoryPage.currentCategory&&fe.dispatch(ni()),super.isActive()}}class pi extends e{constructor(e){super(e),this.formDiv=null,this.changeFormTypeBtn=null}render(){super.render();const e=document.createElement("div");e.className="background-space";const t=document.createElement("div");t.className="page-space";const n=document.createElement("div");n.className="content-space";const r=document.createElement("div"),i=document.createElement("a");i.innerHTML="SaberNews",i.className="header__title",i.href="/",i.style.cssText="position: absolute;";const s=document.createElement("a");s.textContent="Создать аккаунт",s.dataset.router="ignore",r.appendChild(new Xn(!1).render()),this.formDiv=r,this.changeFormTypeBtn=s,n.appendChild(r),n.appendChild(s),t.appendChild(i),t.appendChild(n),e.appendChild(t),this.root.appendChild(e)}switchFormType(e){this.formDiv&&this.changeFormTypeBtn?(this.formDiv.innerHTML="",this.formDiv.appendChild(new Xn(e).render()),this.changeFormTypeBtn.textContent=e?"У меня уже есть аккаунт":"Создать аккаунт"):console.warn("[SignupPage] was not rendered yet")}}function hi(e,t){0!==t.length&&("login"in t[0]?t.forEach((t=>{Ie(t);const n=document.createElement("div");n.innerHTML=Fn({...t,disableArticles:!0}),e.appendChild(n.firstChild)})):_n(e,t))}class gi extends e{constructor(e){super(e),this.pageComponents={feed:new ln(hi,"search",k,x,T,O,Me,(()=>(console.log("{SearchPage feed} isEndFound is not been reset"),{type:"__EMPTY__"})))}}render(){super.render(),this.root.appendChild(Kt("",this.pageComponents.feed))}}function fi({currentTarget:e}){const t=fe.getState().search,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>we()||(console.log("[Search Page] scroll trigger"),fe.dispatch(vi))}async function vi(){const e=fe.getState().search;e.isEndFound||e.isLoading||(fe.dispatch(Pe()),await ke({url:`/search/${e.group}?q=${e.value||""}&idLastLoaded=${e.idLastLoaded||""}`}).then((({status:e,response:t})=>{if(e===Ae.ok)return(n=t.data).forEach((e=>{"login"in e&&(e.id=e.login)})),void fe.dispatch(qe("",n));var n;e/500==1&&In.setTitle(`Сервис временно не доступен: ${e}`),e/400==1&&In.setTitle(`Ошибка ${e}`),In.setContent(t.msg),In.open(!1)})).catch((e=>console.warn(e.message))),fe.dispatch($e()))}const mi={};function _i(e){const{target:t}=e;if("outer"!==t.dataset.router&&("ignore"===t.dataset.router&&e.preventDefault(),t instanceof HTMLAnchorElement)){e.preventDefault();const n=mi[t.dataset.section]?.props,r=mi[t.dataset.section]?.action;"function"==typeof r&&r.call(null,n)}}class yi extends n{render(){const e=document.createElement("div");return e.style="\n    display: none;\n\n    position:fixed; \n    box-sizing: border-box;\n    border-radius: 5px;\n    padding: 5px;\n    top: 105px;\n    left: 20px;\n    background-color: #dee4ea;\n    color: red;\n    font-weight: bold;\n    ",e}}const bi=new class extends r{constructor(){super(),this.view=new yi}render(){return super.render(),this.root=this.view.render(),this.root}setMessage(e){this.root.innerHTML=e}getMessage(){return this.root.innerHTML}show(e){this.root.style.display="block",e&&(this.root.innerHTML=e)}hide(){this.root.style.display="none"}};document.getElementById("warningroot").appendChild(bi.render());const wi={show(e){bi.show(e)},hide(){bi.hide()},setMessage(e){bi.setMessage(e)},getMessage:()=>bi.getMessage(),init(){fe.subscribe($,(()=>wi.show("Сервис недоступен"))),fe.subscribe(M,(()=>{"Сервис недоступен"===wi.getMessage()&&(wi.setMessage(""),wi.hide())}))}},Si=wi,Ei=[],Li={upload(e){Ei.push(...e);for(let t=0;t<e.length;t++){const n=new Image;n.onload=()=>{const e=Ei.indexOf(n);-1!==e&&Ei.splice(e,1)},Ei.push(n),n.src=e[t]}}};function Ci(){return xe({url:"/",body:{}}).then((({status:e,response:t})=>{e===Ae.ok&&fe.dispatch(gt(t.data)),fe.dispatch(Nt())})).catch((e=>{fe.dispatch(qt()),fe.dispatch(((e,t)=>{setTimeout(Ci,3e4)}))}))}const Ai=function(e){return e.forEach((e=>{Ie(e.author)})),{type:D,payload:e}},ki=new WebSocket("ws://89.208.197.247:8081/api/v1/ws");ki.onopen=function(e){},ki.onmessage=function(e){let t="";try{t=JSON.parse(e.data)}catch(e){return void console.warn(e.message)}(t.type="stream-comment")&&function(e){Ie(e.author),fe.dispatch(Ai([e]))}(t)},ki.onclose=function(e){e.wasClean},ki.onerror=function(e){console.warn(`webSocket: error: ${e.message}`)},Li.upload(["static/img/background-space.png","static/img/background.png","static/img/icons/cross.svg","static/img/icons/eye-closed.svg","static/img/icons/eye-open.svg","static/img/icons/key.svg","static/img/icons/mail.svg","static/img/icons/username.svg","static/img/icons/like.svg","static/img/icons/like_hover.svg","static/img/icons/comment.svg","static/img/icons/comment_hover.svg","static/img/icons/share.svg","static/img/icons/share_hover.svg","static/img/icons/trash.svg","static/img/icons/trash_hover.svg","static/img/icons/search.svg","static/img/icons/search_hover.svg","static/img/icons/send.svg"]),"serviceWorker"in navigator?navigator.serviceWorker.register("serviceWorker.js",{scope:"/"}).then((e=>{console.warn("sw registration on scope:",e.scope)})).catch((e=>{console.error(e)})):console.warn("ServiceWorker is unable in navigator");const xi=document.getElementById("root"),Ti=new class{constructor(e){this.routes={},this.routesPatterned=[],this.root=e}register(e,t){for(const n in this.routes)if(this.routes[n].PageClass===t)return console.warn(`[ROUTER] paths ${n} and ${e} point to the same ${t.name}`),this.routes[e]=this.routes[n],this;return this.routes[e]={PageClass:t,page:null,root:null},this}registerPattern(e,t){e=e.slice(0,e.indexOf("<")),this.routesPatterned.push(e);for(const n in this.routes)if(this.routes[n].PageClass===t)return console.warn(`[ROUTER] paths ${n} and ${e} point to the same ${t.name}`),this.routes[e]=this.routes[n],this;return this.routes[e]={PageClass:t,page:null,root:null},this}open(e){let t=e;this.routesPatterned.forEach((e=>{t.startsWith(e)&&(console.log(`[ROUTER] ${t} matched pattern ${e}`),t=e)}));const n=this.routes[t];if(!n)return console.warn("[ROUTER] путь",t,"не зарегистрирован"),void this.open("/");let{PageClass:r,page:i,root:s}=n;s||(s=document.createElement("section"),s.className="view",this.root.appendChild(s)),i||(i=new r(s),console.warn("[ROUTER] создал вьюху",i));const o=i.redirect(window.location.pathname);if(""!==o)return console.warn("[ROUTER]",i.constructor.name+" | redirectRoute: "+o),this.open(o),void(this.routes[t]={PageClass:r,page:i,root:s});window.location.pathname!==e&&window.history.pushState(null,"",e),console.log("[ROUTER] !page.isActive():",!i.isActive()),i.isActive()||(Object.values(this.routes).forEach((({page:e})=>{e&&e.isActive()&&e.hide()})),i.show()),this.routes[t].page=i,this.routes[t].root=s}start(){fe.subscribe(ne,(e=>{this.open(e)})),this.root.addEventListener("click",(e=>{const t=e.target;if(!(t instanceof HTMLAnchorElement||"ignore"===t.dataset.router)||"outer"===t.dataset.router)return;e.preventDefault();const n=t.pathname||t.parentElement.pathname;console.warn("link:",n),n&&this.open(n)})),window.addEventListener("popstate",(()=>{const e=window.location.pathname;this.open(e)}));const e=window.location.pathname;console.log("[ROUTER] start page:",e),this.open(e)}}(xi),Oi=new class{constructor(e){this.root=e,this.enabled=!1}register(e,t=(()=>{}),n=null){return mi[e]={action:t,props:n},this}enable(){this.enabled||(this.enabled=!0,this.root.addEventListener("click",_i))}disable(){this.enabled&&(this.enabled=!1,this.root.removeEventListener("click",_i))}}(xi),Ii=new class{constructor(){this.progressValue=0,this.root=document.createElement("div"),this.root.className="background",this.root.innerHTML=function(e){var t="",n=e||{};return function(e){t=t+'<div class="loading-page"><div class="loading-page__title">Загрузка</div><progress class="progress__loading"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=mr.exec(t);if(!n)return e;var r,i,s,o="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=s}return i!==r?o+t.substring(i,r):o}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("value",`${e}`,!0,!1)+' max="100"></progress></div>'}.call(this,"progressValue"in n?n.progressValue:"undefined"!=typeof progressValue?progressValue:void 0),t}({progressValue:this.progressValue}),this.progressBar=this.root.querySelector("progress"),this.animationId=0}async start(){const e=document.getElementById("root");e.innerHTML="",e.appendChild(this.root);let t=performance.now(),n=400;const r=e=>{this.progressValue+=(e-t)*n/1e4,t=e,this.progressValue<75&&(n--,n<100&&(n=100),this.progressBar.value=this.progressValue,window.requestAnimationFrame(r))};this.animationId=window.requestAnimationFrame(r)}async end(){window.cancelAnimationFrame(this.animationId),await new Promise((e=>{let t=performance.now();const n=r=>{this.progressValue+=1e3*(r-t)/1e4,t=r,this.progressValue<100?(this.progressBar.value=this.progressValue,window.requestAnimationFrame(n)):e()};n(performance.now())})),document.getElementById("root").innerHTML=""}};Si.init(),Ti.register("/",class extends t{constructor(e){super(e),this.view=new yn(e),fe.subscribe(J,(()=>{fe.dispatch(bt())}))}show(){super.show(),fe.dispatch(vt("main","SaberProject")),0===fe.getState().mainPage.cards.length&&fe.dispatch(Nn);const e=this.view.root.querySelector(".content");e?e.addEventListener("scroll",Rn):console.warn("[Main Page] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",Rn):console.warn("[MainPage] нет дивака .content")}}).register("/profile",sr).registerPattern("/user/<login>",sr).registerPattern("/article/<id>",class extends t{constructor(e){super(e),this.view=new Qr(e)}show(){super.show(),fe.dispatch(vt("reader","SaberProject | Article View"));const e=document.URL.slice(document.URL.indexOf("article/")+8);console.warn("[ArticleReaderPage] id from Url ",document.URL,e),fe.dispatch(nn({id:e})),fe.dispatch(tn(e));let t=0;ke({url:`/articles?id=${e}`}).then((({status:e,response:n})=>new Promise(((r,i)=>{e===Ae.ok?r(n.data):(t=e,i(new Error(n.msg)))})))).then((e=>{fe.dispatch(en(e)),fe.dispatch(tn(e.id))})).then((()=>ke({url:`/comments?id=${e}`}))).then((({status:e,response:n})=>new Promise(((r,i)=>{e===Ae.ok?r(n.data):(t=e,i(new Error(`Комментарии загрузить не удалось\n            ${n.msg}`)))})))).then((t=>{const n=(t=t.map((e=>Ne(e)))).filter((e=>0===e.parentId));n.forEach((e=>{e.answers=t.filter((t=>t.parentId===e.id)).sort(((e,t)=>e.datetimeMS<t.datetimeMS?-1:1))})),fe.dispatch(rn(e,n))})).catch((e=>{0!==t?tr(t,e.message):console.warn(e.message)}))}}).register("/profile/settings",class extends t{constructor(e){super(e),this.view=new vr(e),fe.subscribe(a,(()=>{this.isActive()&&(console.log("[ProfileSettingsPage] Logout reaction"),ye("/"))}))}show(){super.show();const e=this.view.root.querySelector("form");e.addEventListener("submit",(t=>{t.preventDefault();const n=e.querySelector('input[name="username"]')?.value.trim(),r=e.querySelector('input[name="surname"]')?.value.trim(),i=e.querySelector('textarea[name="description"]')?.value.trim(),s=e.querySelector('input[type="file"]')?.files[0];if(""!==n&&!Zn.firstName.test(n))return void this.view.pageComponents.settingsForm.appendWarning("Такое имя выбрать нельзя");if(""!==r&&!Zn.lastName.test(r))return void this.view.pageComponents.settingsForm.appendWarning("Такую фамилию выбрать нельзя");if(s&&!s.type.startsWith("image/"))return void nr.warn("Ошибка","Выберите изображение");let o=0,a="";new Promise(((e,t)=>{s?e(s):t(new Error("Картинка не прекреплена"))})).then((()=>Te({url:"/img/upload",body:s}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data.imgId):(o=e,r(new Error(t.msg)))})))).catch((e=>new Promise(((t,n)=>{0===o?t(""):n(e)})))).then((e=>(a=e,xe({url:"/user/profile/update",body:{firstName:n,lastName:r,avatarUrl:e,description:i}})))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===Ae.ok?n(t.data):(o=e,r(new Error(t.msg)))})))).then((e=>{""!==a&&(e.avatarUrl=Oe+"/img/"+a),fe.dispatch(gt(e)),nr.informativeMsg("Успех!","Профиль обновлен"),ye("/profile")})).catch((({message:e})=>{if(o===Ae.invalidSession)return fe.dispatch(ft()),nr.informativeMsg("Сессия устарела","Пройдите авторизацию"),void ye("/login");"5"!==(o+"")[0]?this.view.pageComponents.settingsForm.appendWarning(msg):nr.netOrServerError(o,e)}))})),fe.dispatch(vt("profileSettings",`Settings | ${fe.getState().authorization.login}`))}redirect(e){return""!==fe.getState().authorization.login?"":"/login"}}).register("/editor",class extends t{constructor(e){super(e),this.view=new Rr(e),fe.subscribe(a,(()=>{console.log("[ArticleEditorPage] Logout reaction"),this.isActive()&&nr.warn("Вы неавторизованы","Чтобы продолжить редактирование, выполните повторный вход.\n            Текущее состояние сохранено. Не перезагружайте страницу.",(()=>ye("/")))}))}show(){super.show(),fe.dispatch(vt("editor",`SaberProject | ${function(){const e=fe.getState().editor;return"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId}()?"Edit":"Create"} article`))}redirect(e){return fe.getState().authorization.isAuthenticated?"":"/login"}}).registerPattern("/categories/<сategory>",ui).register("/categories",ui).register("/login",class extends t{constructor(e){super(e),this.view=new pi(e),this.showRegister=!1,this.unsubscribeLogin=()=>{}}show(){super.show(),this.showRegister=!1,this.unsubscribeLogin=fe.subscribe(o,(()=>{ye("/")})),this.view.changeFormTypeBtn.addEventListener("click",(e=>{e.preventDefault(),this.showRegister=!this.showRegister,this.view.switchFormType(this.showRegister)})),fe.dispatch(vt("signup","SaberProjects | "+(this.showRegister?"Signup":"Login")))}hide(){super.hide(),this.unsubscribeLogin()}}).register("/search",class extends t{constructor(e){super(e),this.view=new gi(e);const t=e=>{""!==e&&(fe.dispatch(De()),fe.dispatch(Ue()),vi())};fe.subscribe(N,t),fe.subscribe(R,t)}show(){super.show(),fe.dispatch(vt("search","SaberProject | Search")),0===fe.getState().search.cards.length&&fe.dispatch(vi);const e=this.view.root.querySelector(".content");e?e.addEventListener("scroll",fi):console.warn("[Search Page] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",fi):console.warn("[SearchPage] нет дивака .content")}isActive(){return super.isActive()}}),Oi.register("signupModal",er.show,!0).register("loginModal",er.show,!1).register("logout",(()=>{fe.getState().authorization.isAuthenticated&&xe({url:"/user/logout",body:{}}).then((()=>fe.dispatch(ft())))})).register("back",(()=>window.history.back())),Ii.start(),async function(){await Ci(),await Ii.end(),Oi.enable(),Ti.start()}()})();
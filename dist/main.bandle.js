(()=>{"use strict";class e{constructor(e){this.root=e,this.root.dataset.view=this.constructor.name,this.root.hidden=!0}isActive(){return!this.root.hidden}hide(){this.root.hidden=!0}show(){this.root.hidden=!1,this.render()}render(){console.log(`[PAGE ${this.constructor.name}]\trender`),this.root.innerHTML=""}}class t{constructor(t){console.log(`[PAGE ${this.constructor.name}]\tinit`),this.view=new e(t)}isActive(){return console.log(`[PAGE ${this.constructor.name}]\tisActive`),this.view.isActive()}hide(){console.log(`[PAGE ${this.constructor.name}]\thide`),this.view.hide()}show(){console.log(`[PAGE ${this.constructor.name}]\tshow`),this.view.show()}redirect(e){return""}}class n{render(){return document.createElement("div")}}class r{constructor(){this.root=document.createElement("div"),this.view=new n,this.unsubscribes=[],console.log(`[VIEW ${this.constructor.name}]\tinit`)}render(){return console.log(`[VIEW ${this.constructor.name}]\trender`),document.createElement("div")}destroy(){console.log(`[VIEW  ${this.constructor.name}]\tdestroy`),this.view=null,this.unsubscribes.forEach((e=>{"function"==typeof e&&e()}))}}var i=/["&<>]/;class o extends n{render(){const e=document.createElement("div");return e.innerHTML='<div class="header"><a class="header__title-block" href="/"><div class="header__title" data-router="ignore">SaberNews</div></a><div class="header__content"><div class="header__nav-items"><a class="header__nav-item" data-test="test1">Популярное</a><a class="header__nav-item" data-test="test2">Новое</a><a class="header__nav-item">Подписки</a><a class="header__nav-item">Мероприятия</a><a class="header__nav-item">Группы</a><a class="header__nav-item">Трансляции</a></div><div class="search"><div class="search__row search__row_close" style="transition: all 0.5s;"><input class="search__input" type="text" placeholder="Найти"/><div class="search__row_group_dropdown"><input class="search__row_group_bar" type="text" placeholder="где?"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var o=typeof t;return"object"!==o&&"function"!==o||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=i.exec(t);if(!n)return e;var r,o,s,a="";for(r=n.index,o=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:s="&quot;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}o!==r&&(a+=t.substring(o,r)),o=r+1,a+=s}return o!==r?a+t.substring(o,r):a}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("readonly",!0,!0,!1)+'/><div class="search__row_group_dropdown-content"><div class="search__row_group_dropdown-item" data-search="articles">Статьи</div><div class="search__row_group_dropdown-item" data-search="author">Пользователи</div><div class="search__row_group_dropdown-item" data-search="tags">Теги</div></div></div><div class="search__row_btn"></div></div><button class="search__button search-icon"></button></div></div></div>',e.firstChild}}const s="LOGIN",a="LOGOUT",c="CHANGE_PAGE",l="CHANGE_DOC_TITLE",d="MODAL_OPEN",u="MODAL_CLOSE",p={ASK_NEW_CARDS:"ASK_NEW_CARDS",SAVE_NEW_CARDS:"SAVE_NEW_CARDS",CLEAR_CARDS:"CLEAR_CARDS",FORBID_CARDS_UPLOADING:"FORBID_CARDS_UPLOADING",ALLOW_CARDS_UPLOADING:"ALLOW_CARDS_UPLOADING",SET_LOADING_FLAG:"SET_LOADING_FLAG",UNSET_LOADING_FLAG:"UNSET_LOADING_FLAG"},g="SAVE_NEW_USER_ARTICLES",h="CLEAR_USER_ARTICLES",v="FORBID_USER_ARTICLES_UPLOADING",m="ALLOW_USER_ARTICLES_UPLOADING",f="SET_USER_ARTICLES_LOADING",_="SET_USER_INFO",y="SET_USER_LOADING",b="SAVE_NEW_CATEGORY_ARTICLES",w="CLEAR_CATEGORY_ARTICLES",S="FORBID_CATEGORY_ARTICLES_UPLOADING",E="ALLOW_CATEGORY_ARTICLES_UPLOADING",L="SET_CATEGORY_ARTICLES_LOADING",C="UNSET_CATEGORY_ARTICLES_LOADING",A="SELECT_CATEGORY",k="SAVE_NEW_CARDS_SEARCH",x="CLEAR_CARDS_SEARCH",T="FORBID_CARDS_UPLOADING_SEARCH",O="ALLOW_CARDS_UPLOADING_SEARCH",N="SET_LOADING_FLAG_SEARCH",R="SET_SEARCH_GROUP_SEARCH",q="SET_SEARCH_VALUE_SEARCH",I="ASK_NEW_COMMENTS_STREAM",P="SAVE_NEW_COMMENTS_STREAM",D="CLEAR_COMMENTS_STREAM",$="SET_UNAVAILABLE",M="SET_AVAILABLE",U="EDITOR_APPEND_TAG",F="EDITOR_REMOVE_TAG",B="EDITOR_EDIT_EXISTING_ARTICLE",H="EDITOR_CREATE_ARTICLE",G="EDITOR_SAVE_ARTICLE",J="EDITOR_PUBLISH_ARTICLE",j="EDITOR_CLEAR_ARTICLE",W="EDITOR_DELETE_ARTICLE",V="EDITOR_SAVE_PREVIEW",z="EDITOR_SAVE_CATEGORY",Y="READER_SAVE_ARTICLE",Z="READER_OPEN_ARTICLE",K="READER_SET_ARTICLE_LOADING",X="SAVE_ARTICLE_COMMENTS",Q="REDIRECT";const ee={isAuthenticated:!1,login:"",avatarUrl:"",firstName:"UNAUTHORIZED",lastName:"UNAUTHORIZED",email:"UNAUTHORIZED",score:0},te={page:"main",docTitle:"SaberProject"},ne={isAuthenticated:!1,isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1},re={user:{login:""},isLoading:!1,idLastLoaded:"",cards:[],isEndFound:!1},ie={currentCategory:"",isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1,tags:{}},oe={showRegister:!0},se={isAvailable:!0},ae={currentId:0},ce={currentId:0},le={},de={comments:[]},ue={isLoading:!1,idLastLoaded:"",lastScrollPos:0,cards:[],isEndFound:!1,value:"",group:"articles",description:"Статьи"},pe=function e(t,n,...r){console.log("[STORE] createStore: ",r.map((e=>e.name)));let i=t(n,{type:"__INIT__"});const o={};return 0!==r.length?function(...e){return function(t){return function(n,r){const i=t(n,r);let o=()=>{console.error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")};const s={getState:i.getState,dispatch:(e,...t)=>o(e,...t)},a=e.map((e=>e(s)));return o=function(...e){return 0===e.length?arg:1===e.length?e[0]:e.reduce(((e,t)=>e(t(...args))))}(...a)(i.dispatch),{...i,dispatch:o}}}}(...r)(e)(t,n):{dispatch(e){i=t(i,e),o[e.type]=o[e.type]||[],o[e.type].forEach((t=>{console.log("subscribe trigger on",e.type),t(e.payload)}))},subscribe:(e,t)=>(console.log("create subscription to",e),o[e]=o[e]||[],o[e].push(t),function(){o[e].splice(o[e].indexOf(t))}),getState:()=>i}}(function(e){for(const t in e)"function"!=typeof e[t]&&(console.warn(`Reducers Combiner: ${t} is not a function.\n          It will not be called. It is a ${typeof e[t]}.`),delete e[t.name]);return function(t,n){t||(t={});for(const r in e){const i=e[r](t[r],n);if(i!==t[r]){let e=t[r],o=i;if("mainPage"!==r&&"profilePage"!==r&&"search"!==r&&"categoryPage"!==r||(e={},Object.assign(e,t[r]),delete e.cards,o={},Object.assign(o,i),delete o.cards),"editor"===r){e={};for(const n in t[r])e[n]={},Object.assign(e[n],t[r][n]),e[n].img&&""!==e[n].img&&(e[n].img="data:image/png;base64,(контент картинки)");o={};for(const e in i)o[e]={},Object.assign(o[e],i[e]),o[e].img&&""!==o[e].img&&(o[e].img="data:image/png;base64,(контент картинки)")}console.log(`${r} | action: , ${n.type}\n          \t| prev state:\n${JSON.stringify(e)}\n          \t| new state:\n${JSON.stringify(o)}\n          `),t[r]=i}}return t}}({router:function(e=le,t){return t.type===Q?{...e}:e},authorization:function(e=ee,t){switch(t.type){case s:return""===t.payload.login?(console.warn("Trying to set an empty login. LOGIN action ignored"),e):{...e,...t.payload,isAuthenticated:!0};case a:return ee}return e},page:function(e=te,t){switch(t.type){case c:return document.title=t.payload.docTitle,{...e,page:t.payload.page,docTitle:t.payload.docTitle};case l:return document.title=t.payload.docTitle,{...e,docTitle:t.payload.docTitle}}return e},mainPage:function(e=ne,t){switch(t.type){case p.SET_LOADING_FLAG:return{...e,isLoading:!0};case p.FORBID_CARDS_UPLOADING:return{...e,isEndFound:!0};case p.ALLOW_CARDS_UPLOADING:return{...e,isEndFound:!1};case p.SAVE_NEW_CARDS:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case p.CLEAR_CARDS:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1}}return e},profilePage:function(e=re,t){switch(t.type){case f:return{...e,isLoading:!0};case v:return{...e,isEndFound:!0};case m:return{...e,isEndFound:!1};case g:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case h:return{...e,cards:[],isLoading:!1,idLastLoaded:"",isEndFound:!1};case _:case y:return{...e,user:t.payload,isLoading:!1,idLastLoaded:"",cards:[],isEndFound:!1}}return e},categoryPage:function(e=ie,t){switch(t.type){case L:return{...e,isLoading:!0};case C:return{...e,isLoading:!1};case S:return{...e,isEndFound:!0};case E:return{...e,isEndFound:!1};case b:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case w:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1};case A:return{...e,currentCategory:t.payload}}return e},search:function(e=ue,t){switch(t.type){case R:return{...e,group:t.payload.group,description:t.payload.description};case N:return{...e,isLoading:!0};case q:return{...e,value:t.payload};case T:return{...e,isEndFound:!0};case O:return{...e,isEndFound:!1};case k:const n=t.payload.cards;if(0===n.length)return{...e,isLoading:!1};const r="end"===n[n.length-1].id;return r&&n.splice(n.length-1,1),{...e,isLoading:!1,idLastLoaded:n[n.length-1]?.id||e.idLastLoaded,cards:e.cards.concat(n),isEndFound:r};case x:return{...e,cards:[],isLoading:!1,idLastLoaded:"",lastScrollPos:0,isEndFound:!1}}return e},signupForm:function(e=oe,t){return"SWITCH_FORM_TYPE"===t.type?{...e,showRegister:t.payload}:e},api:function(e=se,t){switch(t.type){case M:return{...e,isAvailable:!0};case $:return{...e,isAvailable:!1}}return e},editor:function(e=ae,t){switch(t.type){case B:return{...e,[t.payload.id]:{title:t.payload.title,text:t.payload.text,tags:t.payload.tags,category:t.payload.category,img:t.payload.img},currentId:t.payload.id};case j:return{...e,[t.payload.id]:{title:"",text:"",tags:[],category:"",img:""}};case W:const n={};return Object.assign(n,e),delete n[t.payload.id],n.currentId=0,n;case H:const r=Object.assign({},e);return 0 in r||(r[0]={title:"",text:"",tags:[],category:"",img:""}),r.currentId=0,r;case G:let i={};return t.payload.id in e?Object.assign(i,e[t.payload.id]):i={title:"",text:"",tags:[],category:"",img:""},i={...i,...t.payload},delete i.id,{...e,[t.payload.id]:i};case J:return{...e,[t.payload.id]:Object.assign({},e[0]),0:{title:"",text:"",tags:[],category:"",img:""},currentId:0};case U:const o=Object.assign({},e[e.currentId]);return o.tags.push(t.payload),{...e,[e.currentId]:o};case F:const s=Object.assign({},e[e.currentId]);return s.tags=s.tags.filter((e=>e!=t.payload)),{...e,[e.currentId]:s};case V:const a={...e[e.currentId]};return a.img=t.payload,{...e,[e.currentId]:a};case z:const c={...e[e.currentId]};return c.category=t.payload,{...e,[e.currentId]:c}}return e},reader:function(e=ce,t){switch(t.type){case Y:return{...e,[t.payload.id]:{id:t.payload.id,title:t.payload.title,text:t.payload.text,tags:t.payload.tags,datetime:t.payload.datetime,author:t.payload.author,likes:t.payload.likes,comments:t.payload.comments,previewUrl:t.payload.previewUrl}};case K:return t.payload.id in e&&"Загрузка"!==e[t.payload.id].title?e:{...e,[t.payload.id]:{title:"Загрузка",tags:[],datetime:"",author:{login:"",avatarUrl:"",firstName:"",lastName:"Загрузка",score:0},likes:0,comments:0,commentsContent:null,previewUrl:"",...t.payload,text:"Загрузка..."}};case Z:return{...e,currentId:t.payload};case X:return t.payload.id in e?{...e,[t.payload.id]:{...e[t.payload.id],commentsContent:t.payload.comments}}:e}return e},stream:function(e=de,t){switch(t.type){case P:const n=t.payload;return 0===n.length?e:{...e,comments:e.comments.concat(n)};case D:return{...e,comments:[]};case I:return e}return e}}),{},(function({getState:e,dispatch:t}){return function(n){return function(r){return"function"==typeof r?r(t,e):n(r)}}})),ge="http://89.208.197.247:8081/api/v1",he={post:"POST",get:"GET"};function ve(e){const t=ge+(e.url||"/"),n={body:JSON.stringify(e.body),mode:"cors",credentials:"include",headers:{"Content-Type":"application/json"},method:e.method};console.log("ajax request",{url:t},": "+JSON.stringify(n));let r=0;return fetch(t,n).then((e=>(r=e.status,e.json()))).then((e=>(console.log("ajax resolved "+r+": "),console.log(e),{status:r,response:e}))).catch((e=>{console.warn(e)}))}const me={ok:200,notFound:404,badRequest:400,invalidSession:424},fe=e=>ve({method:he.get,...e}),_e=e=>ve({method:he.post,...e}),ye=function(e){const t=ge+(e.url||"/"),n=new FormData;n.append("img",e.body);const r={body:n,mode:"cors",credentials:"include",method:he.post};console.log("ajax file post request",{url:t},": "+JSON.stringify(r));let i=0;return fetch(t,r).then((e=>(i=e.status,e.json()))).then((e=>(console.log("ajax resolved "+i+": "),console.log(e),{status:i,response:e}))).catch((e=>{console.warn(e)}))},be=ge;function we(e){return new Date(e).toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",timezone:"Russia/Moscow"})}function Se(e){return Date.parse(e.replaceAll("/","-").replace(" ","T")+":00")}function Ee(e){return new Promise(((t,n)=>{"string"!=typeof e&&n(new Error("Передай мне строку, а не url: "+e)),""===e?n(new Error("Картинку не отправляем")):t()})).then((()=>fetch(e))).then((e=>e.blob()))}function Le(e){"avatarUrl"in e&&!e.avatarUrl.startsWith(be)&&(e.avatarUrl=be+"/img/"+e.avatarUrl),"previewUrl"in e&&!e.previewUrl.startsWith(be)&&(e.previewUrl=be+"/img/"+e.previewUrl)}function Ce(e){return new Promise((t=>{const n=new FileReader;n.onload=e=>t(e.target.result),n.readAsDataURL(e)}))}function Ae(e){const t=document.createElement("a"),n=document.querySelector("#root");t.id="clickSimulator",t.href=e,n.appendChild(t),t.click(),n.removeChild(t)}function ke(){for(;;){const e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),n=Math.floor(255*Math.random()),r=(299*e+587*t+114*n)/1e3;if(r<155&&r>40&&e>64&&t>40&&n>64)return"#"+e.toString(16)+t.toString(16)+n.toString(16)}}function xe(){return document.documentElement.clientHeight}const Te={createInput:function(e,t,n,r=null,i=!1,o=null){const s=document.createElement("input");return s.type=e,s.name=n,s.id="input-"+n,s.placeholder=t,s.required=i,null!=r&&(s.title=r),null!=o&&(s.pattern=o),s},createLabel:function(e,t){const n=document.createElement("label");return n.textContent=t,n.htmlFor=e,n},createInputRow:function(e){const t=document.createElement("div");t.className="form-row";const n=document.createElement("div");n.className="tooltip",n.title=e.title;const r=document.createElement("div");return r.className="tooltip-sign",r.textContent="?","null"===e.title&&(n.style.visibility="hidden"),t.appendChild(e),n.appendChild(r),t.appendChild(n),t},getPageHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},getUserWindowWidth:function(){return document.documentElement.clientWidth},getUserWindowHeight:xe,getCurrentPageYPos:function(){return window.pageYOffset},redirect:Ae,htmlToString:function(e){const t=document.createElement("div");return t.appendChild(e),t.innerHTML},genRanHexColor:ke,getFileBrowserStorageUrl:Ce,recoverBlobWithUrl:Ee,appendApiImg:Le,getRusDateTime:we,translateServerDateToMS:Se},Oe=function(e,t){return t.forEach((e=>{!1 in e&&Le(e.author),Le(e)})),{type:k,payload:{idLastLoaded:e,cards:t}}},Ne=function(){return{type:x}},Re=function(){return{type:N}},qe=function(){return{type:"UNSET_LOADING_FLAG_SEARCH"}},Ie=function(){return{type:T}},Pe=function(){return{type:O}},De=function(e,t=""){return{type:R,payload:{group:e,description:t}}},$e=function(e){return{type:q,payload:e}};class Me extends r{constructor(){super(),this.view=new o,this.isBlur=!1,this.isOpen=!1}render(){super.render(),this.root=this.view.render();const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".search__input"),n=this.root.querySelector(".search__row"),r=this.root.querySelector(".search__row_group_dropdown");r.querySelector(".search__row_group_dropdown-content").childNodes.forEach((e=>e.addEventListener("click",(e=>{r.querySelector(".search__row_group_bar").value=e.target.textContent,pe.dispatch(De(e.target.dataset.search,e.target.textContent)),t.focus()})))),r.addEventListener("mouseover",(e=>t.removeEventListener("focusout",i))),r.addEventListener("mouseout",(e=>t.addEventListener("focusout",i))),e.addEventListener("click",(e=>{e.preventDefault(),this.isBlur||this.isOpen||this.openSearchField()})),t.addEventListener("keydown",(({keyCode:e,target:n})=>{13===e&&(pe.dispatch($e(t.value)),t.blur(),Ae("/search"),this.root.querySelector(".search__row_group_bar").value=pe.getState().search.description)}));const i=e=>{console.log("{Header} searchField lost focus"),this.closeSearchField(),this.isBlur=!0;const t=1e3*parseFloat(n.style.transitionDuration);setTimeout((()=>this.isBlur=!1),t)};return t.addEventListener("focusout",i),this.root}closeSearchField(){const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".header__nav-items"),n=this.root.querySelector(".search__row");console.log("{Header} searchField close"),t.style.pointerEvents="all",e.classList.add("search-icon"),e.classList.remove("cross-icon"),n.classList.add("search__row_close"),n.classList.remove("search__row_open"),this.isOpen=!1}openSearchField(){const e=this.root.querySelector(".search__button"),t=this.root.querySelector(".header__nav-items"),n=this.root.querySelector(".search__row"),r=this.root.querySelector(".search__input");console.log("{Header} searchField open"),t.style.pointerEvents="none",e.classList.remove("search-icon"),e.classList.add("cross-icon"),n.classList.remove("search__row_close"),n.classList.add("search__row_open"),r.focus(),r.select(),this.isOpen=!0}}function Ue(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Fe(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Fe(e){var t=""+e,n=Be.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Be=/["&<>]/;function He(e){var t,n="",r=e||{};return function(e,r,i,o,s){n=n+'<div class="sidebar"><div class="sidebar__nav-links"><a class="sidebar__nav-item" href="/editor">Добавить  <br/>запись</a><div class="sidebar__nav-buttons" id="sidebarTopBlockContent">'+(null==(t=s)?"":t)+'</div></div><div class="sidebar__content"><div class="sidebar__categories"><div class="sidebar__categories-title sidebar__item">Комментарии</div><div class="sidebar__streams">'+(null==(t=o)?"":t)+'</div><div class="sidebar__categories-title sidebar__item"><a href="/categories">Категории</a></div>',e.isArray(r)&&(function(){var e=r;if("number"==typeof e.length)for(var o=0,s=e.length;o<s;o++){var a=e[o];n=o<i?n+'<div class="sidebar__categories-item sidebar__item"><a'+Ue("href",`/categories/${a}`,!0,!1)+">"+Fe(null==(t=a)?"":t)+"</a></div>":n+'<div class="sidebar__categories-item sidebar__item" style="display: none"><a'+Ue("href",`/categories/${a}`,!0,!1)+">"+Fe(null==(t=a)?"":t)+"</a></div>"}else for(var o in s=0,e)s++,a=e[o],n=o<i?n+'<div class="sidebar__categories-item sidebar__item"><a'+Ue("href",`/categories/${a}`,!0,!1)+">"+Fe(null==(t=a)?"":t)+"</a></div>":n+'<div class="sidebar__categories-item sidebar__item" style="display: none"><a'+Ue("href",`/categories/${a}`,!0,!1)+">"+Fe(null==(t=a)?"":t)+"</a></div>"}.call(this),n+='<div class="sidebar__categories-more sidebar__item"><div class="sidebar__categories-more-text">Показать ещё</div><button class="action-btns__arrow-icon icon-small__img sidebar__categories-more-btn rotate-180"></button></div>'),n+='</div><div class="sidebar-bottom_right"><div class="contacts"><div class="contacts__title">Контакты</div><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/yurij-lyubskij">Юра</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/Svetlanlka">Света</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/Denactive">Денис</a><a class="contacts__developer" data-router="outer" target="_blank" href="https://github.com/MollenAR">Лёша</a></div></div></div></div>'}.call(this,"Array"in r?r.Array:"undefined"!=typeof Array?Array:void 0,"categoriesList"in r?r.categoriesList:"undefined"!=typeof categoriesList?categoriesList:void 0,"limit"in r?r.limit:"undefined"!=typeof limit?limit:void 0,"streams"in r?r.streams:"undefined"!=typeof streams?streams:void 0,"topBlockContent"in r?r.topBlockContent:"undefined"!=typeof topBlockContent?topBlockContent:void 0),n}function Ge(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Je(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Je(e){var t=""+e,n=je.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var je=/["&<>]/;function We(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="stream-comment"'+Ge("id",`${r}`,!0,!1)+'><div class="stream-comment__author"><img class="stream-comment__author-photo"'+Ge("src",`${e.avatarUrl}`,!0,!1)+'/><div class="stream-comment__author-name">'+Je(null==(t=e.firstName)?"":t)+" "+Je(null==(t=e.lastName)?"":t)+'</div></div><div class="stream-comment__text">'+Je(null==(t=i)?"":t)+"</div></div>"}.call(this,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"id"in r?r.id:"undefined"!=typeof id?id:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0),n}class Ve extends n{constructor(){super(),this.root=document.createElement("div")}render(e,t,n,r){let i="";r.forEach((e=>{const t=We(e);i+=t}));const o=document.createElement("div");return o.innerHTML=He({topBlockContent:e,categoriesList:t,limit:n,streams:i}),this.root=o.firstChild,this.root}setTopBlockContent(e){const t=this.root.querySelector("#sidebarTopBlockContent");t?t.innerHTML=e:this.render(e)}addComments(e){const t=this.root.querySelector(".sidebar__streams");e.forEach((e=>{const n=We(e);t.insertAdjacentHTML("afterbegin",n)}))}}function ze(e){var t=""+e,n=Ye.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Ye=/["&<>]/;function Ze(e){var t,n="",r=e||{};return function(e,r){n=n+'<div class="user-preview"><a class="user-preview__links" href="/profile"><div class="sidebar__nav-item" data-router="ignore">'+ze(null==(t=r)?"":t)+'</div><img class="user-img user-preview__user-img"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' src="src"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),true)?' src="'+(t=ze(t))+'"':" src='"+t.replace(/'/g,"&#39;")+"'"}(0,`${e}`)+' data-router="ignore"/></a><div class="profile-menu"><a class="profile-menu__item" href="/profile/settings">Настройки</a><a class="profile-menu__item" data-section="logout">Выйти</a></div></div>'}.call(this,"avatarUrl"in r?r.avatarUrl:"undefined"!=typeof avatarUrl?avatarUrl:void 0,"login"in r?r.login:"undefined"!=typeof login?login:void 0),n}function Ke(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Xe(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Xe(e){var t=""+e,n=Qe.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Qe=/["&<>]/;function et(e){var t,n="",r=e||{};return function(e,r,i,o,s){null!=i&&e-s!=void 0&&(n=n+'<a class="sidebar__nav-item"'+Ke("href",`${i}`,!0,!1)+Ke("data-section",`${r}`,!0,!1)+">"+Xe(null==(t=o)?"":t)+"</a>"),null==i&&e-s!=void 0&&(n=n+'<a class="sidebar__nav-item"'+Ke("data-section",`${r}`,!0,!1)+">"+Xe(null==(t=o)?"":t)+"</a>"),null!=i&&e-s==void 0&&(n=n+'<a class="sidebar__nav-item"'+Ke("href",`${i}`,!0,!1)+">"+Xe(null==(t=o)?"":t)+"</a>")}.call(this,"data"in r?r.data:"undefined"!=typeof data?data:void 0,"data_section"in r?r.data_section:"undefined"!=typeof data_section?data_section:void 0,"href"in r?r.href:"undefined"!=typeof href?href:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"section"in r?r.section:"undefined"!=typeof section?section:void 0),n}const tt=function(e){return Le(e),{type:s,payload:e}},nt=function(){return{type:a}},rt=function(e,t){return{type:c,payload:{page:e,docTitle:t}}},it=function(){return{type:d}},ot=function(){return{type:u}},st=function(e,t){return t.forEach((e=>{Le(e),Le(e.author)})),{type:p.SAVE_NEW_CARDS,payload:{idLastLoaded:e,cards:t}}},at=function(){return{type:p.CLEAR_CARDS}},ct=function(){return{type:p.SET_LOADING_FLAG}},lt=function(){return{type:p.UNSET_LOADING_FLAG}},dt=function(){return{type:p.FORBID_CARDS_UPLOADING}},ut=function(){return{type:p.ALLOW_CARDS_UPLOADING}},pt=function(e,t){return{type:p.TOGGLE_AUTH,payload:{isAuthenticated:e,login:t}}},gt=function(e){return{type:y,payload:{firstName:"загрузка",lastName:"загрузка",avatarUrl:"",score:0,...e}}},ht=function(e){return Le(e),{type:_,payload:e}},vt=function(e,t){return t.forEach((e=>{Le(e),Le(e.author)})),{type:g,payload:{idLastLoaded:e,cards:t}}},mt=function(){return{type:h}},ft=function(){return{type:f}},_t=function(){return{type:"UNSET_USER_ARTICLES_LOADING"}},yt=function(){return{type:v}},bt=function(){return{type:M}},wt=function(){return{type:$}},St=function(){return{type:H}},Et=function(e,t){return Le(t),Le(t.author),{type:B,payload:{id:e,...t,tags:Array.isArray(t.tags)?t.tags:[]}}},Lt=function(e){return{type:J,payload:{id:e}}},Ct=function(e,t){return Le(t),{type:G,payload:{id:e,title:t.title,text:t.text,tags:Array.isArray(t.tags)?t.tags:[],img:t.img||"",category:t.category||""}}},At=function(e){return{type:W,payload:{id:e}}},kt=function(e){return{type:U,payload:e}},xt=function(e){return{type:F,payload:e}},Tt=function(e){return{type:V,payload:e}},Ot=function(){return{type:V,payload:""}},Nt=function(e){return{type:z,payload:e}},Rt=function(){return{type:z,payload:""}},qt=["Маркетинг","Личный опыт","Вопросы","SaberDevs","Сервисы","Будущее","Финансы","Дизайн","Соцсети","Техника","Карьера","Медиа","Истории","Торговля","SEO","Офлайн","Видео","Офис","Офтоп","Транспорт","Право","Трибуна","Еда","Конкурсы","Приёмная","Миграция"];class It extends r{constructor(){super(),this.view=new Ve,this.unsubscribes.push(pe.subscribe(s,(()=>{pe.dispatch(((e,t)=>e(pt(!0,t().authorization.login)))),this.setSidebarUserPreview()})),pe.subscribe(a,(()=>{pe.dispatch(pt(!1,"")),this.setSidebarSignupButtons()}))),this.unsubscribes.push(pe.subscribe(P,(e=>{this.addComments(e)})))}render(){super.render();const e=pe.getState().authorization;let t="";e.isAuthenticated?t=Ze({login:e.login,avatarUrl:e.avatarUrl}):(t+=et({data_section:"loginModal",name:"Логин"}),t+=et({data_section:"signupModal",name:"Регистрация"}));const n=[...pe.getState().stream.comments].reverse();this.root=this.view.render(t,qt,6,n),this.view.root.querySelector("a.sidebar__nav-item").addEventListener("click",(()=>pe.dispatch(St())));const r=this.view.root.querySelectorAll(".sidebar__categories-item"),i=this.view.root.querySelector(".sidebar__categories-more-btn"),o=this.view.root.querySelector(".sidebar__categories-more-text");return Pt(r,i,o),this.view.root.querySelector(".sidebar__categories-more").addEventListener("click",(e=>{e.preventDefault(),Pt(r,i,o)})),this.root}setSidebarUserPreview(){const e=pe.getState().authorization;this.view.setTopBlockContent(Ze(e))}setSidebarSignupButtons(){let e=et({data_section:"loginModal",name:"Логин"});e+=et({data_section:"signupModal",name:"Регистрация"}),this.view.setTopBlockContent(e)}addComments(e){this.view.addComments(e)}}function Pt(e,t,n){let r=!0;t.classList.contains("rotate-180")?(n.innerText="Показать ещё",t.classList.remove("rotate-180"),r=!0):(n.innerText="Скрыть",t.classList.add("rotate-180"),r=!1);for(let t=6;t<e.length;++t)e[t].style.display=r?"none":"block"}let Dt=null,$t=null;function Mt(e,...t){null!==Dt&&null!==$t||(Dt=new Me,$t=new It);const n=document.createElement("div");n.className="background";const i=document.createElement("div");i.className="screen";const o=document.createElement("div");o.className="page";const s=document.createElement("div");s.className="page_title",s.textContent=e;const a=document.createElement("div");return a.className="content",t.forEach((e=>{e instanceof r?a.appendChild(e.render()):e instanceof HTMLElement?a.appendChild(e):console.warn(e,"is not BaseComponent nor HTMLElement")})),o.appendChild(Dt.render()),o.appendChild(s),o.appendChild(a),i.appendChild(o),i.appendChild($t.render()),n.appendChild(i),n}function Ut(e){var t,n="",r=e||{};return function(e){n=n+'<div class="feed"><div class="feed__preview">'+(null==(t=e)?"":t)+'</div><div class="feed__cards"></div><div id="feed__loading">&#11088;</div></div>'}.call(this,"preview"in r?r.preview:"undefined"!=typeof preview?preview:void 0),n}class Ft extends n{constructor(e,t,n){super(),this.composeCards=e,this.root=this.render(t,n)}render(e,t){const n=document.createElement("div");n.innerHTML=Ut({preview:e});const r=n.firstChild;return this.composeCards(r.querySelector(".feed__cards"),t),this.root=r,r}addCards(e){const t=this.root.querySelector(".feed__cards");t?(this.composeCards(t,e),this.showLoadingAnimation()):console.warn("cannot append cards till Feed is not rendered")}clear(){this.root.querySelector(".feed__cards").innerHTML=""}hideLoadingAnimation(){this.root.querySelector("#feed__loading").style.display="none"}showLoadingAnimation(){this.root.querySelector("#feed__loading").style.display="block"}}const Bt=function(e){return Le(e),Le(e.author),{type:Y,payload:e}},Ht=function(e){return{type:Z,payload:e}},Gt=function(e){return Le(e),"avatar"in e&&Le(e.author),{type:K,payload:e}},Jt=function(e,t){return Array.isArray(t)||(console.warn("API error. Server returned ",typeof t,"instead of comments"),t=[]),t||(t=[]),{type:X,payload:{id:e,comments:t}}};function jt(e,t){t.forEach((t=>{const n=e.querySelector("#card"+t.id);null!==n?(n.addEventListener("click",(e=>{e.preventDefault();const n=e.currentTarget;console.warn(n.id),pe.dispatch(Gt(t)),Ae("/article/"+n.id.replace("card",""))})),n.querySelector(".author-name").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),pe.dispatch(ht(t.author)),Ae("/user/"+t.author.login)})),n.querySelectorAll(".tags__tag").forEach((e=>e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),console.warn("TODO: клик по тегу",e.currentTarget.textContent)}))))):console.warn("{Feed} card with id",t.id,"has mounted with error")}))}class Wt extends r{constructor(e,t,n,i,o,s,a,c,l=new r){console.log("{FEED} creation with params:"),console.log({storeName:t}),super(),this.innerComponent=l,this.storeName=t;const d=pe.getState()[t].cards;this.view=new Ft(e,l.render().outerHTML,d),this.unsubscribes.push(pe.subscribe(n,(({idLastLoaded:e,cards:n})=>{Array.isArray(n)?(this.view.addCards(n),jt(this.view.root.querySelector(".feed__cards"),n),pe.getState()[t].isEndFound&&(console.log(`{${t}FEED}\n              'end' found. isEndFound flag is true`),this.view.hideLoadingAnimation(),pe.dispatch((e=>{setTimeout((()=>{console.log("{FEED} isEndFound flag is reset to false"),e(c())}),6e3)})))):console.warn("API ERROR! Server must return array of Cards","but returned",typeof n,":",{cards:n})})),pe.subscribe(i,(()=>this.view.clear())),pe.subscribe(s,(()=>this.view.showLoadingAnimation())),pe.subscribe(o,(()=>this.view.hideLoadingAnimation())))}render(){super.render();const e=this.innerComponent.render().outerHTML,t=pe.getState()[this.storeName].cards;return this.root=this.view.render(e,t),jt(this.view.root.querySelector(".feed__cards"),t),pe.getState()[this.storeName].isEndFound&&this.view.hideLoadingAnimation(),this.root}}function Vt(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=zt(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function zt(e){var t=""+e,n=Zt.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Yt=Object.prototype.hasOwnProperty,Zt=/["&<>]/;function Kt(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)Yt.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function Xt(e){var t,n="",r={},i=e||{};return function(e,i,o,s,a,c,l,d,u,p,g){r.tagMixin=t=function(e,r,i=!1){this&&this.block,this&&this.attributes,n=n+'<div class="tags__tag-content"'+Vt("style",Kt(`background-color: ${r}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=e)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+Vt("style",Kt(`background-color: ${r}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=e)?"":t)+"</div>",n+="</div>"},n=n+'<div class="card"'+Vt("id",`card${c}`,!0,!1)+Vt("style",Kt(`background: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0.7)), to(rgba(0, 0, 0, 0.7))), url(${d});\nbackground: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url(${d});\nbackground-size: cover;\nbackground-repeat: no-repeat;`),!0,!1)+'><div class="card__top"><div class="card__top-left"><div class="card__time-category"><div class="card__time">'+zt(null==(t=a)?"":t)+'</div><div class="card__category">'+zt(null==(t=o)?"":t)+'</div></div><div class="tags">',e.isArray(u)&&function(){var e=u;if("number"==typeof e.length)for(var t=0,n=e.length;t<n;t++){var i=e[t];r.tagMixin(i.content,i.color)}else for(var t in n=0,e)n++,i=e[t],r.tagMixin(i.content,i.color)}.call(this),n=n+'</div></div><div class="card__author"><img class="card__author-photo"'+Vt("src",`${i.avatarUrl||"static/img/users/user_icon_loading.svg"}`,!0,!1)+'/><div class="author-name">',"object"==typeof i&&(n=n+'<div class="author-name__login">'+zt(null==(t=i.login)?"":t)+'</div><div class="author-name__username">'+zt(null==(t=i.firstName)?"":t)+" "+zt(null==(t=i.lastName)?"":t)+"</div>"),n=n+'</div></div></div><div class="card__content"><a class="preview__title">'+zt(null==(t=g)?"":t)+'</a><div class="card__description">'+zt(null==(t=p)?"":t)+'</div></div><div class="card__bottom"><div class="action-btns"><div class="icon action-btns_m-right"><div class="icon__text">'+zt(null==(t=l)?"":t)+'</div><button class="action-btns__likes-icon icon__img"></button></div><div class="icon"><div class="icon__text">'+zt(null==(t=s)?"":t)+'</div><button class="action-btns__comments-icon icon__img"></button></div></div></div></div>'}.call(this,"Array"in i?i.Array:"undefined"!=typeof Array?Array:void 0,"author"in i?i.author:"undefined"!=typeof author?author:void 0,"category"in i?i.category:"undefined"!=typeof category?category:void 0,"comments"in i?i.comments:"undefined"!=typeof comments?comments:void 0,"datetime"in i?i.datetime:"undefined"!=typeof datetime?datetime:void 0,"id"in i?i.id:"undefined"!=typeof id?id:void 0,"likes"in i?i.likes:"undefined"!=typeof likes?likes:void 0,"previewUrl"in i?i.previewUrl:"undefined"!=typeof previewUrl?previewUrl:void 0,"tags"in i?i.tags:"undefined"!=typeof tags?tags:void 0,"text"in i?i.text:"undefined"!=typeof text?text:void 0,"title"in i?i.title:"undefined"!=typeof title?title:void 0),n}function Qt(e,t){t.forEach((t=>{Le(t),Le(t.author);const n=document.createElement("div"),r=t.tags.map((e=>({content:e,color:ke()})));n.innerHTML=Xt({...t,tags:r}),e.appendChild(n.firstChild)}))}function en(e){var t=""+e,n=tn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var tn=/["&<>]/;const nn={id:"loading-card",previewUrl:"static/img/loader-1-HorizontalBalls.gif",tags:[],title:"Загрузка...",text:"Еще чуть-чуть...",authorUrl:"",authorName:"loading",authorAvatar:"",commentsUrl:""};class rn extends n{render(){const e=document.createElement("div");return e.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i,o,s,a,c,l,d,u,p,g){n=n+'<div class="preview"><div class="preview__top"><div class="card__top-left"><div class="card__time-category"><div class="card__time">'+en(null==(t=s)?"":t)+'</div><div class="card__category">'+en(null==(t=i)?"":t)+'</div></div></div><div class="card__author"><div class="author-name"><div class="author-name__login">'+en(null==(t=d)?"":t)+'</div><div class="author-name__username">'+en(null==(t=a)?"":t)+" "+en(null==(t=c)?"":t)+'</div></div><img class="card__author-photo"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' src="src"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),1)?' src="'+(t=en(t))+'"':" src='"+t.replace(/'/g,"&#39;")+"'"}(0,`${r||"static/img/users/user_icon_loading.svg"}`)+'/></div></div><div class="preview__content"><div class="tags">',e.isArray(u)&&function(){var e=u.length?u:[];if("number"==typeof e.length)for(var r=0,i=e.length;r<i;r++){var o=e[r];n=n+'<div class="tags__tag preview__tag">'+en(null==(t=o)?"":t)+"     </div>"}else for(var r in i=0,e)i++,o=e[r],n=n+'<div class="tags__tag preview__tag">'+en(null==(t=o)?"":t)+"     </div>"}.call(this),n=n+'</div><a class="preview__title">'+en(null==(t=g)?"":t)+'</a><div class="preview__description">'+en(null==(t=p)?"":t)+'</div></div><div class="card__bottom"><div class="action-btns"><div class="icon action-btns_m-right"><div class="icon__text">'+en(null==(t=l)?"":t)+'</div><button class="action-btns__likes-icon icon__img"></button></div><div class="icon"><div class="icon__text">'+en(null==(t=o)?"":t)+'</div><button class="action-btns__comments-icon icon__img"></button></div></div></div></div>'}.call(this,"Array"in r?r.Array:"undefined"!=typeof Array?Array:void 0,"avatarUrl"in r?r.avatarUrl:"undefined"!=typeof avatarUrl?avatarUrl:void 0,"category"in r?r.category:"undefined"!=typeof category?category:void 0,"comments"in r?r.comments:"undefined"!=typeof comments?comments:void 0,"datetime"in r?r.datetime:"undefined"!=typeof datetime?datetime:void 0,"firstName"in r?r.firstName:"undefined"!=typeof firstName?firstName:void 0,"lastName"in r?r.lastName:"undefined"!=typeof lastName?lastName:void 0,"likes"in r?r.likes:"undefined"!=typeof likes?likes:void 0,"login"in r?r.login:"undefined"!=typeof login?login:void 0,"tags"in r?r.tags:"undefined"!=typeof tags?tags:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}(nn),e.firstChild}}class on extends r{constructor(){super(),this.view=new rn}render(){return super.render(),this.root=this.view.render(),this.root}}class sn extends e{constructor(e){super(e);const t=new on;this.pageComponents={feedPreview:t,feed:new Wt(Qt,"mainPage",p.SAVE_NEW_CARDS,p.CLEAR_CARDS,p.FORBID_CARDS_UPLOADING,p.ALLOW_CARDS_UPLOADING,dt,ut,t)}}render(){super.render(),this.root.appendChild(Mt("",this.pageComponents.feed))}}let an=!1,cn=!1,ln=!0,dn=!0,un="",pn=()=>{},gn=()=>{};function hn(e){return console.log("[Modal] modal filling: "+JSON.stringify(e)),function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="modal__overlay" data-modal-close="true"><div class="modal__window"><div class="modal__content-block"><div class="modal__header"><a class="modal__close-btn icon__img" data-modal-close="true"></a></div><div class="modal__content">'+(null==(t=r)?"":t)+'</div></div><div class="modal__footer"><button class="modal__btn" id="modal__btn-ok" type="button" data-modal-close="true">'+(null==(t=i)?"":t)+'</button><button class="modal__btn" id="modal__btn-cancel" type="button" data-modal-close="true">'+(null==(t=e)?"":t)+"</button></div></div></div>"}.call(this,"cancel_sign"in r?r.cancel_sign:"undefined"!=typeof cancel_sign?cancel_sign:void 0,"content"in r?r.content:"undefined"!=typeof content?content:void 0,"ok_sign"in r?r.ok_sign:"undefined"!=typeof ok_sign?ok_sign:void 0),n}({title:e.title||"",content:e.content||"",ok_sign:e.btnOkSign||"Понятно",cancel_sign:e.btnCancelSign||"Отмена"})}const vn=function(e){const t=document.getElementById("modalroot");t.innerHTML=hn(e);const n=t.querySelector("#modal__btn-ok"),r=t=>{t.preventDefault(),"function"==typeof e.onConfirm?e.onConfirm():console.log("[Modal] confirm")};n.addEventListener("click",r),pn=()=>{n.removeEventListener("click",r)};const i=t.querySelector("#modal__btn-cancel"),o=t=>{t.preventDefault(),"function"==typeof e.onDecline?e.onDecline():console.log("[Modal] decline")};return i.addEventListener("click",o),gn=()=>{i.removeEventListener("click",o)},pe.subscribe(u,(()=>{document.title=pe.getState().page.docTitle})),pe.subscribe(d,(()=>{document.title=un})),t}({isEnteractive:!0,isCancelable:!0}),mn={animationTime:200,setDocTitle(e){un=e},close(){if(cn)return void console.warn("[Modal] close: modal has been destroyed");pe.dispatch(ot()),an=!0;const e=vn.querySelector(".modal__overlay");e.classList.add("modal_close"),e.classList.remove("modal_open"),setTimeout((()=>{an=!1}),200)},open(e=!0){if(cn)return void console.warn("[[Modal] open: modal has been destroyed");if(pe.dispatch(it()),an)return void console.warn("[Modal] open: modal is in closing process");const t=vn.querySelector("#modal__btn-ok"),n=vn.querySelector("#modal__btn-cancel");t.className="modal__btn-ok",t.classList.add("modal__btn"),n.className="modal__btn-cancel",n.classList.add("modal__btn"),e||(t.style.display="none",n.style.display="none");const r=vn.querySelector(".modal__overlay");r.classList.remove("modal_close"),r.classList.add("modal_open"),e||setTimeout((()=>{this.close(),setTimeout((()=>{ln&&(t.style.display="block"),dn&&(n.style.display="block")}),200)}),2e3)},getContent(){const e=vn.querySelector(".modal__content");return e||console.warn("[Modal] no .modal__content found"),e},setContent(e){console.log("[Modal]: setContent to ",e);const t=vn.querySelector(".modal__content");"string"==typeof e&&(t.innerHTML=e),e instanceof HTMLElement&&(t.innerHTML="",t.appendChild(e))},appendContent(e){console.log("[Modal]: appendContent:",e);const t=vn.querySelector(".modal__content");"string"==typeof e&&(t.innerHTML+=e),e instanceof HTMLElement&&t.appendChild(e)},setTitle(e){console.log("[Modal]: setTitle to ",e);let t=vn.querySelector(".modal__header");if("string"==typeof e&&(t.innerHTML=e),e instanceof HTMLElement){const n=document.createElement("div");t.className="modal__header",n.appendChild(e),t=n}},configurate(e){vn.innerHTML=hn(e);const t=vn.querySelector("#modal__btn-ok"),n=t=>{t.preventDefault(),"function"==typeof e.onConfirm?e.onConfirm():console.log("[Modal] confirm")};t.addEventListener("click",n),pn=()=>{t.removeEventListener("click",n)};const r=vn.querySelector("#modal__btn-cancel"),i=t=>{t.preventDefault(),"function"==typeof e.onDecline?e.onDecline():console.log("[Modal] decline")};r.addEventListener("click",i),gn=()=>{console.log("[Modal] clear Cancel Listener",{activeCancelEventListener:i}),r.removeEventListener("click",i)},e.isEnteractive||(t.style.display="none",r.style.display="none"),e.isCancelable||(r.style.display="none")},enableOkBtn(){vn.querySelector("#modal__btn-ok").style.display="block",ln=!0},disableOkBtn(){vn.querySelector("#modal__btn-ok").style.display="none",ln=!1},enableCancelBtn(){vn.querySelector("#modal__btn-cancel").style.display="block",dn=!0},disableCancelBtn(){vn.querySelector("#modal__btn-cancel").style.display="none",dn=!1},changeBtnOkSign(e){vn.querySelector("#modal__btn-ok").innerText=e},changeBtnCancelSign(e){vn.querySelector("#modal__btn-cancel").innerText=e},setOkBtnAction(e){pn();const t=vn.querySelector("#modal__btn-ok"),n=t=>{t.preventDefault(),"function"==typeof e?e():console.log("[Modal] confirm")};t.addEventListener("click",n),pn=()=>{t.removeEventListener("click",n)}},setCancelBtnAction(e){gn();const t=vn.querySelector("#modal__btn-cancel"),n=t=>{t.preventDefault(),"function"==typeof e?e():console.log("[Modal] confirm")};t.addEventListener("click",n),gn=()=>{t.removeEventListener("click",n)}}};function fn(e){e.target.dataset.modalClose&&mn.close()}vn.addEventListener("click",fn),Object.assign(mn,{destroy(){this.close(),vn.removeEventListener("click",fn),vn.innerHTML="",cn=!0}});const _n=mn;function yn({currentTarget:e}){const t=pe.getState().mainPage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>xe()||(console.log("[Main Page] scroll trigger"),pe.dispatch(bn))}async function bn(){const e=pe.getState().mainPage,t=pe.getState().authorization;e.isEndFound||e.isLoading?console.log("[Main Page] can't load news asisEndFound state flag is true"):(pe.dispatch(ct()),await fe({url:`/articles/feed?idLastLoaded=${e.idLastLoaded||""}&login=`+(t.isAuthenticated?t.login:"all")}).then((({status:t,response:n})=>{if(t===me.ok)return r=n.data,console.log("[Main Page] more news loaded!"),void pe.dispatch(st(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;t/500==1&&_n.setTitle(`Сервис временно не доступен: ${t}`),t/400==1&&_n.setTitle(`Ошибка ${t}`),_n.setContent(n.msg),_n.open(!1)})).catch((e=>console.warn(e.message))),pe.dispatch(lt()))}function wn(e){var t=""+e,n=Sn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Sn=/["&<>]/;function En(e){var t,n="",r=e||{};return function(e,r,i,o,s){n=n+'<div class="profile"><div class="profile__info"><img class="profile__photo"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' src="src"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),true)?' src="'+(t=wn(t))+'"':" src='"+t.replace(/'/g,"&#39;")+"'"}(0,`${e||"static/img/users/user_icon_loading.svg"}`)+'/><div class="profile__description"><div class="profile__username">'+wn(null==(t=i)?"":t)+" "+wn(null==(t=o)?"":t)+" ("+wn(null==(t=s)?"":t)+')</div><div class="profile__aboutme">Обо мне:</div>'+wn(null==(t=r)?"":t)+'</div></div><div class="profile__articles-title">Статьи</div></div>'}.call(this,"avatarUrl"in r?r.avatarUrl:"undefined"!=typeof avatarUrl?avatarUrl:void 0,"description"in r?r.description:"undefined"!=typeof description?description:void 0,"firstName"in r?r.firstName:"undefined"!=typeof firstName?firstName:void 0,"lastName"in r?r.lastName:"undefined"!=typeof lastName?lastName:void 0,"login"in r?r.login:"undefined"!=typeof login?login:void 0),n}class Ln extends n{constructor(){super(),this.root=document.createElement("div"),this.root.innerHTML="компонент profileCard"}render(e){const t=document.createElement("div");return t.innerHTML=En(e),this.root=t.firstChild,t.firstChild}}class Cn extends r{constructor(){super(),this.view=new Ln,this.unsubscribes.push(pe.subscribe(y,(e=>{this.setUser(e)})),pe.subscribe(_,(e=>{this.setUser(e)})))}render(){super.render();const e=pe.getState().profilePage.user;return this.root=this.view.render(e),this.root}setUser(e){this.root.innerHTML="",this.root.appendChild(this.view.render(e).firstChild)}}class An extends e{constructor(e){super(e),this.pageComponents={profileCard:new Cn,feed:new Wt(Qt,"profilePage",g,h,v,m,yt,(()=>(console.log("{profilePage feed} isEndFound is not been reset"),{type:"__EMPTY__"})))}}render(){super.render(),this.root.appendChild(Mt("",this.pageComponents.profileCard,this.pageComponents.feed))}}var kn=/["&<>]/;function xn(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Tn(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Tn(e){var t=""+e,n=On.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var On=/["&<>]/;function Nn(e){var t,n="",r=e||{};return function(e,r,i,o,s,a,c){n=n+'<div class="form__row"><div class="form__label">'+Tn(null==(t=r)?"":t)+'</div><div class="form__field">',null!=s&&null!=o&&a&&(n=n+'<input class="form__input"'+xn("type",`${c}`,!0,!1)+xn("name",`${i}`,!0,!1)+xn("placeholder",`${s}`,!0,!1)+xn("pattern",`${o}`,!0,!1)+xn("required",`${a}`,!0,!1)+"/>"),null==s||null==o||a||(n=n+'<input class="form__input"'+xn("type",`${c}`,!0,!1)+xn("name",`${i}`,!0,!1)+xn("placeholder",`${s}`,!0,!1)+xn("pattern",`${o}`,!0,!1)+"/>"),null!=s&&null==o&&a&&(n=n+'<input class="form__input"'+xn("type",`${c}`,!0,!1)+xn("name",`${i}`,!0,!1)+xn("placeholder",`${s}`,!0,!1)+xn("required",`${a}`,!0,!1)+"/>"),null==s||null!=o||a||(n=n+'<input class="form__input"'+xn("type",`${c}`,!0,!1)+xn("name",`${i}`,!0,!1)+"/>"),null==s&&null!=o&&a&&(n=n+'<input class="form__input"'+xn("type",`${c}`,!0,!1)+xn("name",`${i}`,!0,!1)+xn("pattern",`${o}`,!0,!1)+xn("required",`${a}`,!0,!1)+"/>"),null!=s||null==o||a||(n=n+'<input class="form__input"'+xn("type",`${c}`,!0,!1)+xn("name",`${i}`,!0,!1)+xn("pattern",`${o}`,!0,!1)+"/>"),null==s&&null==o&&a&&(n=n+'<input class="form__input"'+xn("type",`${c}`,!0,!1)+xn("name",`${i}`,!0,!1)+xn("required",`${a}`,!0,!1)+"/>"),null!=s||null!=o||a||(n=n+'<input class="form__input"'+xn("type",`${c}`,!0,!1)+xn("name",`${i}`,!0,!1)+"/>"),1==e&&(n+='<a class="password__control-btn control-password"></a>'),n+="</div></div>"}.call(this,"eye"in r?r.eye:"undefined"!=typeof eye?eye:void 0,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"pattern"in r?r.pattern:"undefined"!=typeof pattern?pattern:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0,"required"in r?r.required:"undefined"!=typeof required?required:void 0,"type"in r?r.type:"undefined"!=typeof type?type:void 0),n}const Rn={login:/^[a-zA-Z][a-zA-Z0-9_]{4,20}$/,password:/^\S{8,40}$/,firstName:/^[a-zA-Zа-яА-Я]{2,}$/,lastName:/^[a-zA-Zа-яА-Я]{1,}'?-?[a-zA-Zа-яА-Я]{1,}(\s[a-zA-Zа-яА-Я]{1,})?$/,cirillic:/[\u0401\u0451\u0410-\u044f]/};class qn extends n{constructor(){super(),this.root=document.createElement("div"),this.appendWarning=e=>{const t=this.root.querySelector(".form__warning"),n=this.root.querySelector("#form-warning-label");t||console.warn("[SignupFormView]\n          appendWarning call while SignupForm was not rendered"),n.style.display="block",t.style.display="block",t.textContent=e}}render(e,t){let n="";n+=Nn({label:"Логин",type:"text",name:"login",required:!0}),e&&(n+=Nn({label:"e-mail",type:"email",name:"email",required:!0})),n+=Nn({label:"Пароль",type:"password",name:"password",required:!0,eye:!0}),e&&(n+=Nn({label:"Повтор пароля",type:"password",name:"password-repeat",required:!0,eye:!1}));const r=document.createElement("div");r.innerHTML=function(e){var t,n="",r=e||{};return function(e,r){n=n+'<form class="modal__form form"><div class="form__rows">'+(null==(t=e)?"":t)+'</div><div class="form__row"><div class="form__label" id="form-warning-label" style="display: none; color: transparent;">|</div><div class="form__input form__warning">Поля заполнены неверно</div></div><div class="form__row"><div class="form__label" style="color: transparent;">|</div><input class="form__input form__submit-btn" type="submit" name="btn-submit"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=kn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("value",`${r}`,!0,!1)+"/></div></form>"}.call(this,"form_rows"in r?r.form_rows:"undefined"!=typeof form_rows?form_rows:void 0,"submit_btn_placeholder"in r?r.submit_btn_placeholder:"undefined"!=typeof submit_btn_placeholder?submit_btn_placeholder:void 0),n}({title:e?"Регистрация":"Вход",form_rows:n,submit_btn_placeholder:e?"Зарегистрироваться":"Войти"});const i=r.firstChild;return i.querySelector(".control-password").addEventListener("click",(({target:e})=>{const t=i.querySelector('input[name="password"]');"password"===t.getAttribute("type")?(e.classList.add("password__show"),t.type="text"):(e.classList.remove("password__show"),t.type="password")})),i.addEventListener("submit",(n=>{n.preventDefault();const r=i.querySelector(".form__warning"),o=this.root.querySelector("#form-warning-label");r.style.display="none",r.textContent="",o.style.display="none";const s=i.querySelector('input[name="login"]').value,a=i.querySelector('input[name="password"]').value,c=i.querySelector('input[name="email"]')?.value,l=i.querySelector('input[name="password-repeat"]')?.value;return Rn.login.test(s)?Rn.password.test(a)?e&&l!==a?(r.style.display="block",o.style.display="block",void(r.textContent="Удостоверьтесь, что пароли совпадают")):void t(e,s,a,c):(r.style.display="block",o.style.display="block",void(r.textContent="В качестве пароля используйте любую комбинацию непробельных символы длиной более 8")):(r.style.display="block",o.style.display="block",void(r.textContent="Логин - это латинские буквы, цифры инижнее подчеркивание (_). Длина логина - от 4 до 20 символов"))})),this.root=i,i}}class In extends r{constructor(e){super(),this.view=new qn,this.showRegister=e}render(){var e;return super.render(),this.root=this.view.render(this.showRegister,(e=this.view.appendWarning,function(t,n,r,i){_e({url:t?"/user/signup":"/user/login",body:{login:n,email:i||"",password:r}}).then((({status:t,response:n})=>{if(t===me.ok)return pe.dispatch(tt(n.data)),void _n.close();e(n.msg)}))})),this.root}}function Pn(e){const t=document.createElement("a");t.textContent=e?"У меня уже есть аккаунт":"Создать аккаунт",t.href=e?"/login":"/register",t.classList.add("link"),t.addEventListener("click",(t=>{t.preventDefault(),_n.close(),setTimeout((()=>{Pn(!e)}),_n.animationTime)}));const n=new In(e).render(),r=document.createElement("div");r.appendChild(n),r.appendChild(t),_n.setDocTitle("SaberProject | "+(e?"Sign Up":"Login")),_n.setTitle(e?"Регистрация":"Вход"),_n.setContent(r),_n.disableCancelBtn(),_n.disableOkBtn(),_n.open()}class Dn{static show(e=!1){Pn(e)}static appendWarning(e){const t=_n.getContent();t&&(t.innerHTML+=e)}}function $n(e,t){"5"===(e/100+"")[0]&&_n.setTitle(`Сервис временно не доступен: ${e}`),"4"===(e/100+"")[0]&&_n.setTitle(`Ошибка ${e}`),_n.setContent(t),_n.open(!1)}class Mn{static signup(e){Dn.show(e)}static netOrServerError(e,t){$n(e,t)}static informativeMsg(e="",t=""){!function(e="",t=""){_n.setTitle(e),_n.setContent(t),_n.open(!1)}(e,t)}static confirm(e,t,n,r){!function(e,t,n,r=(()=>{})){_n.setTitle(e),_n.setContent(t),_n.changeBtnOkSign("Да"),_n.enableOkBtn(),_n.setOkBtnAction(n),_n.changeBtnCancelSign("Отмена"),_n.enableCancelBtn(),_n.setCancelBtnAction(r),_n.open(!0)}(e,t,n,r)}static warn(e,t,n){!function(e,t,n=(()=>{})){_n.setTitle(e),_n.setContent(t),_n.enableOkBtn(),_n.changeBtnOkSign("Понятно"),_n.setOkBtnAction(n),_n.disableCancelBtn(),_n.open(!0)}(e,t,n)}}function Un({currentTarget:e}){const t=pe.getState().profilePage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>Te.getUserWindowHeight()||(console.log("[Profile Page] scroll trigger"),pe.dispatch(Fn))}async function Fn(){const e=pe.getState().profilePage;e.isEndFound||e.isLoading?console.log("can't load usercards as isEndFound state flag is true"):(pe.dispatch(ft()),await fe({url:`/articles/author?idLastLoaded=${e.idLastLoaded}&login=${e.user.login}`}).then((({status:t,response:n})=>{if(t===me.ok)return r=n.data,console.log("[ProfilePage] more user cards loaded!"),void pe.dispatch(vt(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;$n(t,n.msg)})).catch((e=>console.warn(e.message))),pe.dispatch(_t()))}class Bn extends t{constructor(e){super(e),this.view=new An(e),pe.subscribe(a,(()=>{this.isActive()&&(console.log("[ProfilePage] Logout reaction"),-1!==document.URL.indexOf("/profile")&&Te.redirect("/"))})),pe.subscribe(s,(()=>{this.isActive()&&(console.log("[ProfilePage] Login reaction"),-1===document.URL.indexOf("/profile")&&pe.getState().profilePage.user.login===pe.getState().authorization.login&&Te.redirect("/profile"))})),pe.subscribe(J,(()=>{pe.dispatch(mt())}))}show(){super.show();const e=pe.getState().profilePage,t=pe.getState().authorization;if(-1!==document.URL.indexOf("/profile"))pe.dispatch(ht(t)),pe.dispatch(mt());else{const n=document.URL.slice(document.URL.indexOf("user/")+5);if(console.warn("[ProfilePage] user from Url ",document.URL,n),""===n&&Te.redirect("/404"),n!==e.user.login){if(n===t.login)return void Te.redirect("/profile");pe.dispatch(gt({login:n})),pe.dispatch(mt()),fe({url:`/user?user=${n}`}).then((({status:e,response:t})=>{e!==me.ok?($n(e,t.msg),Te.redirect("/")):pe.dispatch(ht(t.data))})).catch((e=>console.warn(e.message)))}}pe.dispatch(rt("profile",`SaberProject | ${e.user.login}`)),0===pe.getState().profilePage.cards.length&&pe.dispatch(Fn);const n=this.view.root.querySelector(".content");n?n.addEventListener("scroll",Un):console.warn("[ProfilePage] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",Un):console.warn("[ProfilePage] нет дивака .content")}redirect(e){const t=pe.getState().authorization;return-1===document.URL.indexOf("/profile")||t.isAuthenticated?"":"/login"}}function Hn(e){var t=""+e,n=Gn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var Gn=/["&<>]/;function Jn(e){var t=""+e,n=jn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var jn=/["&<>]/;function Wn(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=Vn(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function Vn(e){var t=""+e,n=zn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var zn=/["&<>]/;function Yn(e){var t,n="",r=e||{};return function(e,r,i,o,s,a){n=n+'<div class="settings__row"><div class="settings__label">'+Vn(null==(t=e)?"":t)+'</div><div class="settings__field">',null!=o&&null!=i&&s&&(n=n+'<input class="settings__input"'+Wn("type",`${a}`,!0,!1)+Wn("name",`${r}`,!0,!1)+Wn("placeholder",`${o}`,!0,!1)+Wn("pattern",`${i}`,!0,!1)+Wn("required",`${s}`,!0,!1)+"/>"),null==o||null==i||s||(n=n+'<input class="settings__input"'+Wn("type",`${a}`,!0,!1)+Wn("name",`${r}`,!0,!1)+Wn("placeholder",`${o}`,!0,!1)+Wn("pattern",`${i}`,!0,!1)+"/>"),null!=o&&null==i&&s&&(n=n+'<input class="settings__input"'+Wn("type",`${a}`,!0,!1)+Wn("name",`${r}`,!0,!1)+Wn("placeholder",`${o}`,!0,!1)+Wn("required",`${s}`,!0,!1)+"/>"),null==o||null!=i||s||(n=n+'<input class="settings__input"'+Wn("type",`${a}`,!0,!1)+Wn("name",`${r}`,!0,!1)+"/>"),null==o&&null!=i&&s&&(n=n+'<input class="settings__input"'+Wn("type",`${a}`,!0,!1)+Wn("name",`${r}`,!0,!1)+Wn("pattern",`${i}`,!0,!1)+Wn("required",`${s}`,!0,!1)+"/>"),null!=o||null==i||s||(n=n+'<input class="settings__input"'+Wn("type",`${a}`,!0,!1)+Wn("name",`${r}`,!0,!1)+Wn("pattern",`${i}`,!0,!1)+"/>"),null==o&&null==i&&s&&(n=n+'<input class="settings__input"'+Wn("type",`${a}`,!0,!1)+Wn("name",`${r}`,!0,!1)+Wn("required",`${s}`,!0,!1)+"/>"),null!=o||null!=i||s||(n=n+'<input class="settings__input"'+Wn("type",`${a}`,!0,!1)+Wn("name",`${r}`,!0,!1)+"/>"),n+="</div></div>"}.call(this,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"pattern"in r?r.pattern:"undefined"!=typeof pattern?pattern:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0,"required"in r?r.required:"undefined"!=typeof required?required:void 0,"type"in r?r.type:"undefined"!=typeof type?type:void 0),n}class Zn extends n{render(){let e="";e+=Yn({label:"Имя",type:"text",name:"username"}),e+=Yn({label:"Фамилия",type:"text",name:"surname"}),e+=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="settings__row"><div class="settings__label">'+Jn(null==(t=e)?"":t)+'</div><div class="settings__field"><textarea class="settings__input"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' name="name"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),1)?' name="'+(t=Jn(t))+'"':" name='"+t.replace(/'/g,"&#39;")+"'"}(0,`${r}`)+">"+Jn(null==(t=i||"")?"":t)+"</textarea></div></div>"}.call(this,"label"in r?r.label:"undefined"!=typeof label?label:void 0,"name"in r?r.name:"undefined"!=typeof name?name:void 0,"placeholder"in r?r.placeholder:"undefined"!=typeof placeholder?placeholder:void 0),n}({label:"О себе",name:"description"}),e+=Yn({label:"Фото",type:"file",name:"photo",placeholder:"Загрузите фото"});const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="settings"><div class="settings__links"><a class="settings__other-page"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' href="href"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),1)?' href="'+(t=Hn(t))+'"':" href='"+t.replace(/'/g,"&#39;")+"'"}(0,`${r}`)+">"+Hn(null==(t=i)?"":t)+'</a></div><form class="settings__form"><div class="settings__rows">'+(null==(t=e)?"":t)+'<div class="settings__row"><div class="settings__label" id="settings-warning-label" style="color: transparent;">|</div><div class="settings__field"><div class="settings__input settings__warning">Поля заполнены неверно</div></div></div></div><div class="settings__footer"><input class="btn_color-elementary" type="submit" name="btn-submit" value="Сохранить"/><a href="/"><input class="btn_color-elementary" data-router="ignore" type="button" value="Назад"/></a></div></form></div>'}.call(this,"form_rows"in r?r.form_rows:"undefined"!=typeof form_rows?form_rows:void 0,"other_page_href"in r?r.other_page_href:"undefined"!=typeof other_page_href?other_page_href:void 0,"other_page_name"in r?r.other_page_name:"undefined"!=typeof other_page_name?other_page_name:void 0),n}({other_page_name:"сменить пароль",other_page_href:"",form_rows:e}),t.firstChild}}class Kn extends r{constructor(){super(),this.view=new Zn}render(){return super.render(),this.root=this.view.render(),this.root}appendWarning(e){const t=this.root.querySelector(".settings__warning");t||console.warn("[SignupFormView]\n        appendWarning call while SignupForm was not rendered"),t.style.display="block",t.textContent=e}}class Xn extends e{constructor(e){super(e),this.pageComponents={settingsForm:new Kn}}render(){super.render(),this.root.appendChild(Mt("Настройки пользователя",this.pageComponents.settingsForm))}}var Qn=/["&<>]/;function er(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=nr.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}var tr=Object.prototype.hasOwnProperty,nr=/["&<>]/;function rr(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)tr.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function ir(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=sr.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}var or=Object.prototype.hasOwnProperty,sr=/["&<>]/;function ar(e){if(!e)return"";if("object"==typeof e){var t="";for(var n in e)or.call(e,n)&&(t=t+n+":"+e[n]+";");return t}return e+""}function cr(e){var t,n="",r={},i=e||{};return function(e,i){r.tagMixin=t=function(e,r,i=!1){this&&this.block,this&&this.attributes,n=n+'<div class="tags__tag-content"'+ir("style",ar(`background-color: ${r}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=e)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+ir("style",ar(`background-color: ${r}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=e)?"":t)+"</div>",n+="</div>"},n+='<div class="plate"><div class="categories__search-block"><div class="categories__search"><input class="categories__search-input" type="text" id="categories-search" placeholder="фильтр"/></div></div><div class="tags">',e.isArray(i)&&function(){var e=i;if("number"==typeof e.length)for(var t=0,n=e.length;t<n;t++){var o=e[t];r.tagMixin(o.content,o.color)}else for(var t in n=0,e)n++,o=e[t],r.tagMixin(o.content,o.color)}.call(this),n+="</div></div>"}.call(this,"Array"in i?i.Array:"undefined"!=typeof Array?Array:void 0,"categories"in i?i.categories:"undefined"!=typeof categories?categories:void 0),n}class lr extends n{render(e){const t=document.createElement("div");return t.innerHTML=cr({categories:e.map((e=>({content:e,color:ke()})))}),t.firstChild}}class dr extends r{constructor(e,t,n,r){super(),this.view=new lr,this.setSelection=t,this.clearSelection=n,this.getCurrentSelection=e,this.unsubscribes.push(pe.subscribe(r,(e=>{this.markSelectedCategory(e)})))}render(){super.render(),this.root=this.view.render(qt);const e=this.root.querySelector("div.tags");return this.root.querySelectorAll("div.tags__tag-content").forEach((e=>{e.addEventListener("click",(({target:e})=>{const t=this.getCurrentSelection();e.innerHTML===t?pe.dispatch(this.clearSelection()):pe.dispatch(this.setSelection(e.innerHTML))})),e.textContent.trim()===this.getCurrentSelection()&&e.classList.add("categories__choosen")})),this.root.querySelector("input.categories__search-input").oninput=t=>{const n=t.target.value;""!=n?e.childNodes.forEach((e=>{const t=e.lastChild,r=t.textContent.toLocaleLowerCase().indexOf(n);-1==r?(t.parentElement.style.display="none",t.innerHTML=t.textContent):(t.parentElement.style.display="",t.innerHTML=((e,t,n)=>e.slice(0,t)+'<span class="categories__mark">'+e.slice(t,t+n)+"</span>"+e.slice(t+n))(t.textContent,r,n.length))})):e.childNodes.forEach((e=>{const t=e.lastChild;t.parentElement.style.display="",t.innerHTML=t.textContent}))},this.root}markSelectedCategory(e){const t=this.root.querySelector("div.tags");t?t.childNodes.forEach((t=>{t.classList.remove("categories__choosen"),t.innerText===e&&t.classList.add("categories__choosen")})):console.warn("{CategoryChoiceBar} component hasn't been rendered yet")}}function ur(e=new Date){const t=e=>e<10?"0"+e:e;return[t(e.getHours()),t(e.getMinutes())].join(":")+" "+[t(e.getDate()),t(e.getMonth()+1),e.getFullYear()].join("/")}class pr extends n{constructor(e,t,n,r){super(),this.innerComponents={categoryChoiceBar:new dr(e,t,n,r)},this.tagBox=null,this.previewBox=null,this.textAreaInput=null,this.titleInput=null,this.category=null}render(e){const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r={};return function(e){n=n+'<div class="article-create"><div class="article-create__title">Создание статьи</div><form class="article-create__form"><div class="article-create__category_selector"><div class="article-create__row"><div class="article-create__label">Выберете категорию</div></div></div><div class="article-create__right"><button class="btn_color-elementary article-create__del-btn">Удалить</button><button class="btn_color-elementary article-create__clear-btn">Очистить</button></div><div class="article-create__rows"><div class="article-create__row"><div class="article-create__label">Заголовок</div><div class="article-create__field"><input class="article-create__input" type="text" name="title"/></div></div><div class="article-create__row"><div class="article-create__label">Текст статьи</div><div class="article-create__field"><textarea class="article-create__input article-create__text" name="text"></textarea></div></div><div class="article-create__row"><div class="article-create__label">Теги</div><div class="article-create__tags-actions"><input class="article-create__input-tag" type="text" name="tag" maxlength="20"/><button class="article-create__add-tag">+</button></div><div class="article-create__tags">'+(null==(t=e)?"":t)+'</div></div></div><div class="article-create__right"><input class="btn_color-elementary" type="file" name="photo" value="Заставка"/><input class="btn_color-elementary" type="button" name="clear-photo" value="Удалить картинку"/></div><div class="article-create__preview"><div class="article-create__preview__title">Предпросмотр:</div><div class="article-create__preview__content"></div><div class="article-create__tags-actions"></div></div><div class="article-create__right"><input class="btn_color-elementary" type="submit" name="btn-submit" value="Создать"/></div></form></div>'}.call(this,"tags"in r?r.tags:"undefined"!=typeof tags?tags:void 0),n}(),this.category=t.firstChild.querySelector(".article-create__category_selector"),this.category.querySelector(".article-create__row").appendChild(this.innerComponents.categoryChoiceBar.render()),t.firstChild.querySelector(".plate").className="article-create__category_selector",this.previewBox=t.firstChild.querySelector(".article-create__preview__content"),this.previewBox.innerHTML=Xt({id:"-preview",datetime:ur(),category:"категория не выбрана",author:e,comments:"",likes:""}).replace("card","article-create__preview__card").replace(/style=".*\n.*\n.*\n.*;"/,""),this.tagBox=this.previewBox.querySelector(".tags"),this.textAreaInput=t.firstChild.querySelector("textarea"),this.titleInput=t.firstChild.querySelector('input[name="title"]'),t.firstChild}appendTag(e,t){if(null===this.tagBox)return void console.warn("{Editor} component hasn't been rendered yet");const n=document.createElement("div");n.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i){n=n+'<div class="tags__tag-content"'+er("style",rr(`background-color: ${e}`),!0,!1)+"> ",n=i?n+'<div class="tags__tag tags_with-cross">'+(null==(t=r)?"":t)+'</div><div class="tags__tag__del-btn cross-icon cross-icon_white"'+er("style",rr(`background-color: ${e}`),!0,!1)+"></div>":n+'<div class="tags__tag">'+(null==(t=r)?"":t)+"</div>",n+="</div>"}.call(this,"color"in r?r.color:"undefined"!=typeof color?color:void 0,"content"in r?r.content:"undefined"!=typeof content?content:void 0,"cross"in r?r.cross:"undefined"!=typeof cross?cross:void 0),n}({content:e,color:ke(),cross:!0});const r=n.firstChild;r.querySelector(".tags__tag__del-btn").addEventListener("click",(e=>{t(),r.remove()})),this.tagBox.appendChild(r)}clearTags(){null!==this.tagBox?this.tagBox.innerHTML="":console.warn("{Editor} component hasn't been rendered yet")}changePreviewImage(e){null!==this.previewBox?this.previewBox.querySelector(".article-create__preview__card").style.cssText=function(e){return`background: -webkit-gradient(linear, left top, left bottom,from(rgba(0, 0, 0, 0.7)), to(rgba(0, 0, 0, 0.7))), url(${e});background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),url(${e});\n  background-size: cover;\n  background-repeat: no-repeat;`}(e):console.warn("{Editor} component hasn't been rendered yet")}clearPreviewImage(){this.previewBox.querySelector(".article-create__preview__card").style.cssText=""}changePreviewText(e){null!==this.previewBox?(e=e.slice(0,350),this.previewBox.querySelector(".card__description").textContent=e):console.warn("{Editor} component hasn't been rendered yet")}changePreviewTitle(e){null!==this.previewBox?this.previewBox.querySelector(".preview__title").textContent=e:console.warn("{Editor} component hasn't been rendered yet")}changePreviewCategory(e){null!==this.previewBox?this.previewBox.querySelector(".card__category").textContent=""===e?"категория не выбрана":e:console.warn("{Editor} component hasn't been rendered yet")}setContent(e,t){null!==this.textarea&&null!==this.titleInput?(this.textAreaInput.value=t,this.titleInput.value=e,this.changePreviewText(t),this.changePreviewTitle(e)):console.warn("{Editor} can't use setContent: component hasn't been rendered yet")}}class gr extends r{constructor(){super(),this.view=new pr((()=>{const e=pe.getState().editor;return e[e.currentId]?.category||""}),Nt,Rt,z),this.unsubscribes.push(pe.subscribe(j,(()=>{this.clear()})),pe.subscribe(J,(()=>{this.clear()})),pe.subscribe(H,(()=>{this.changeToCreate(),this.setContent(pe.getState().editor[0])})),pe.subscribe(B,(({id:e})=>{this.changeToUpdate(),this.setContent(pe.getState().editor[e])})),pe.subscribe(z,(e=>{this.view.changePreviewCategory(e)})))}render(){super.render(),this.root=this.view.render(pe.getState().authorization),pe.getState().editor[pe.getState().editor.currentId]||pe.dispatch(St());const e=pe.getState().editor;this.setContent(e[e.currentId]),"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId?this.changeToUpdate():this.changeToCreate(),e[e.currentId].tags.forEach((e=>{this.view.appendTag(e,(()=>pe.dispatch(xt(e))))}));const t=this.root.querySelector("input.article-create__input-tag");this.root.querySelector(".article-create__add-tag").addEventListener("click",(e=>{e.preventDefault();const n=t.value.trim().replace(/\s+/g,"_"),r=pe.getState().editor;""===n||r[r.currentId].tags.includes(n)||(pe.dispatch(kt(n)),this.view.appendTag(n,(()=>pe.dispatch(xt(n)))),t.value="")}));const n=this.root.querySelector("textarea"),r=this.root.querySelector('input[name="title"]'),i=e=>{const t=r.value,i=n.value;pe.dispatch(Ct(pe.getState().editor.currentId,{title:t,text:i}))};return n.addEventListener("change",i),r.addEventListener("input",i),n.addEventListener("input",(e=>{this.view.changePreviewText(n.value)})),r.addEventListener("input",(e=>{const t=r.value;this.view.changePreviewTitle(t)})),this.root.querySelector(".article-create__clear-btn").addEventListener("click",(e=>{e.preventDefault(),Mn.confirm("Вы собираетесь очистить всё","Продолжив, Вы безвозвратно сотрете то, что написали",(()=>{this.clear()}))})),this.root.querySelector(".article-create__del-btn").addEventListener("click",(e=>{e.preventDefault(),Mn.confirm("Точно хотите удалить?","Продолжив, вы удалите статью",(()=>{_e({url:`/articles/delete?id=${pe.getState().editor.currentId}`,body:{}}).then((({status:e,response:t})=>e===me.ok?(pe.dispatch(At(pe.getState().editor.currentId)),Mn.informativeMsg("Успех!","Статья была удалена"),void redirect("/profile")):e===me.invalidSession?(pe.dispatch(nt()),void Mn.signup(!1)):void Mn.netOrServerError(e,t.msg)))}))})),this.root.querySelector("form").addEventListener("submit",(e=>{e.preventDefault();const t=this.root.querySelector("textarea")?.value.trim(),n=this.root.querySelector('input[name="title"]')?.value.trim();if(!t||!n||""===t||""===n)return console.warn("{Editor} пустые статьи - это плохо:",{text:t},{title:n}),void Mn.informativeMsg("Ошибка","Заголовок и текст статьи не должны быть пустыми");const r=pe.getState().editor,i=function(){const e=pe.getState().editor;return"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId}(),o={title:n,text:t,category:r[r.currentId].category,tags:r[r.currentId].tags};i&&Object.assign(o,{id:r.currentId});let s=0;Ee(r[r.currentId].img).then((e=>ye({url:"/img/upload",body:e}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===me.ok?n(t.data.imgId):(s=e,r(new Error(t.msg)))})))).catch((e=>new Promise(((t,n)=>{0===s?t(""):n(e)})))).then((e=>_e({url:"/articles/"+(i?"update":"create"),body:{...o,img:e}}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===me.ok?n(t.data):(s=e,r(new Error(t.msg)))})))).then((e=>{pe.dispatch(Lt(e)),Mn.informativeMsg("Успех!","Статья успешно "+(i?"изменена":"создана")),redirect(`/article/${i?r.currentId:e}`)})).catch((({message:e})=>{if(s===me.invalidSession)return pe.dispatch(nt()),void Mn.signup(!1);console.warn(e),Mn.netOrServerError(s,e)}))})),this.root.querySelector('input[name="photo"]').addEventListener("change",(e=>{const t=e.currentTarget.files[0];t.type.startsWith("image/")?Ce(t).then((e=>{this.view.changePreviewImage(e),pe.dispatch(Tt(e))})):Mn.warn("Ошибка","Выберите изображение")})),this.root.querySelector('input[name="clear-photo"]').addEventListener("click",(e=>{e.preventDefault(),this.view.clearPreviewImage(),pe.dispatch(Ot())})),this.root}setContent({title:e,text:t,img:n,category:r}){(e||t)&&console.log("{EDITOR} set content"),this.view.setContent(e,t),this.view.changePreviewCategory(r),n&&(""!==n?this.view.changePreviewImage(n):this.view.clearPreviewImage())}clear(){console.log("{EDITOR} clear"),this.setContent({title:"",text:"",img:"",category:""})}changeToCreate(){const e=this.root.querySelector('input[name="btn-submit"]');e?(e.value="Создать",this.root.querySelector(".article-create__title").textContent="Создание статьи",this.root.querySelector(".article-create__del-btn").style.display="none",this.view.category.style.display="flex"):console.warn("{Editor} can't use changeToCreate:\n          component hasn't been rendered yet")}changeToUpdate(){const e=this.root.querySelector('input[name="btn-submit"]');e?(e.value="Изменить",this.root.querySelector(".article-create__title").textContent="Изменение статьи",this.root.querySelector(".article-create__del-btn").style.display="flex",this.view.category.style.display="none"):console.warn("{Editor} can't use changeToCreate:\n          component hasn't been rendered yet")}}class hr extends e{constructor(e){super(e),this.pageComponents={editor:new gr}}render(){super.render(),this.root.appendChild(Mt("",this.pageComponents.editor))}}function vr(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=mr(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}function mr(e){var t=""+e,n=fr.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var fr=/["&<>]/;class _r extends n{constructor(){super()}render(e){const t=document.createElement("div");return t.innerHTML=function(e){var t,n="",r=e||{};return function(e,r,i,o,s,a,c,l,d,u){n+='<div class="article-view"><div class="article-view__content"><div class="article-view__top"><a class="article-view__back-btn" id="article-change-btn" style="display:none">Изменить</a><a class="article-view__back-btn" data-section="back">Назад</a></div><div class="article-view__author-time">',"object"==typeof r?n=n+'<div class="article-view__author"> <a'+vr("href",`/user/${r.avatarUrl}`,!0,!1)+">"+mr(null==(t=r.login)?"":t)+"</a></div>":n+='<div class="article-view__author">Ошибка</div>',n=n+'<div class="article-view__time">'+mr(null==(t=s)?"":t)+'</div></div><div class="article-view__title">'+mr(null==(t=u)?"":t)+'</div><div class="article-view__info"><div class="article-view__tags">',e.isArray(l)&&function(){var e=l.length?l:[""];if("number"==typeof e.length)for(var r=0,i=e.length;r<i;r++){var o=e[r];n=n+'<a class="article-view__tag">'+mr(null==(t=o)?"":t)+"</a>"}else for(var r in i=0,e)i++,o=e[r],n=n+'<a class="article-view__tag">'+mr(null==(t=o)?"":t)+"</a>"}.call(this),n=n+'</div><div class="action-btns"><div class="icon action-btns_m-right"><div class="icon__text">'+mr(null==(t=a||"")?"":t)+'</div><div class="action-btns__likes-icon icon__img"></div></div><div class="icon action-btns_m-right"><div class="icon__text">'+mr(null==(t=i||"")?"":t)+'</div><div class="action-btns__comments-icon icon__img"></div></div><div class="icon"><div class="action-btns__share-icon icon__img"></div></div></div></div></div><img class="article-view__main-picture"'+vr("src",`${c}`,!0,!1)+'/><div class="article-view__content"><div class="article-view__text">'+mr(null==(t=d)?"":t)+'</div><div class="article-view__add-comment"><input class="article-view__comment-input" type="text" name="comment" placeholder="Написать комментарий"/><button class="action-btns__send-icon icon__img article-view__send-comment-btn"></button></div><div class="comments-show"><button class="action-btns__arrow-icon icon-small__img comments-show__btn rotate-180"></button><div class="comments-show__text">Скрыть комментарии</div></div><div class="comments" id="comments">'+(null==(t=o)?"":t)+"</div></div></div>"}.call(this,"Array"in r?r.Array:"undefined"!=typeof Array?Array:void 0,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"comments"in r?r.comments:"undefined"!=typeof comments?comments:void 0,"commentsContent"in r?r.commentsContent:"undefined"!=typeof commentsContent?commentsContent:void 0,"datetime"in r?r.datetime:"undefined"!=typeof datetime?datetime:void 0,"likes"in r?r.likes:"undefined"!=typeof likes?likes:void 0,"previewUrl"in r?r.previewUrl:"undefined"!=typeof previewUrl?previewUrl:void 0,"tags"in r?r.tags:"undefined"!=typeof tags?tags:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0,"title"in r?r.title:"undefined"!=typeof title?title:void 0),n}(e),t.firstChild}}function yr(e){var t=""+e,n=br.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}var br=/["&<>]/;function wr(e){var t,n="",r=e||{};return function(e,r,i,o,s,a){n=n+'<div class="comment"><div class="comment__content"><img class="comment__author-photo"'+function(e,t,n,r){if(!1===t||null==t)return"";if(!0===t)return' src="src"';var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),true)?' src="'+(t=yr(t))+'"':" src='"+t.replace(/'/g,"&#39;")+"'"}(0,`${r.avatarUrl}`)+'/><div class="comment__description"><div class="comment__author-name">'+yr(null==(t=r.lastName)?"":t)+" "+yr(null==(t=r.firstName)?"":t)+'</div><div class="comment__text">'+yr(null==(t=a)?"":t)+'</div></div></div><div class="comment__bottom"><div class="action-btns">',n=(n=o?n+'<div class="comment__time">изменено '+yr(null==(t=i)?"":t)+"</div>":n+'<div class="comment__time">'+yr(null==(t=i)?"":t)+"</div>")+'<button class="comment__edit-btn" style="display: none">Изменить</button><button class="comment__answer-btn">Ответить</button><div class="icon-small action-btns_m-right"><div class="icon-small__text">'+yr(null==(t=s)?"":t)+'</div><div class="action-btns__likes-icon icon-small__img"></div></div></div></div><div class="comment__answers">'+(null==(t=e)?"":t)+"</div></div>"}.call(this,"answers"in r?r.answers:"undefined"!=typeof answers?answers:void 0,"author"in r?r.author:"undefined"!=typeof author?author:void 0,"datetime"in r?r.datetime:"undefined"!=typeof datetime?datetime:void 0,"isEdited"in r?r.isEdited:"undefined"!=typeof isEdited?isEdited:void 0,"likes"in r?r.likes:"undefined"!=typeof likes?likes:void 0,"text"in r?r.text:"undefined"!=typeof text?text:void 0),n}const Sr=e=>{e.preventDefault();const t=pe.getState().reader,n=t[t.currentId];pe.dispatch(Et(n.id,n))};class Er extends r{constructor(){super(),this.view=new _r,this.unsubscribes.push(pe.subscribe(Z,(e=>{const t=pe.getState().reader;this.openArticle(t[e])})),pe.subscribe(X,(({id:e,comments:t})=>{pe.getState().reader.currentId===e&&this.setComments(t)})),pe.subscribe(s,(()=>{const e=this.root.querySelector("#article-change-btn");e?this.root.querySelector("div.article-view__author > a").textContent===pe.getState().authorization.login&&(e.style.display="block",e.href="/editor",e.addEventListener("click",Sr)):console.warn("{READER} component hasn't been rendered yet")})),pe.subscribe(a,(()=>{const e=this.root.querySelector("#article-change-btn");e?(e.style.display="none",e.href=void 0,e.removeEventListener("click",Sr)):console.warn("{READER} component hasn't been rendered yet")})))}render(){super.render();const e=pe.getState().reader;return this.root=this.view.render(e[e.currentId]),this.root.querySelectorAll(".article-view__tag").forEach((e=>{e.href="/categories"})),Lr(this.root),this.root}openArticle(e){this.root.innerHTML="",this.view.render(e).childNodes.forEach((e=>{this.root.appendChild(e.cloneNode(!0))})),Lr(this.root),this.root.querySelector("#article-change-btn").href="/user/"+e.author.login,this.root.querySelectorAll(".article-view__tag").forEach((e=>{e.href="/categories"}));const t=pe.getState().authorization.login;if(e.author.login===t){const e=this.root.querySelector("#article-change-btn");e.style.display="block",e.href="/editor",e.addEventListener("click",Sr)}}setComments(e){const t=this.root.querySelector("#comments");e.forEach((e=>{const n=document.createElement("div");n.innerHTML=wr(e);const r=n.firstChild;if(t.appendChild(r),pe.getState().authorization.login===e.author.login){const t=r.querySelector(".comment__edit-btn");t.style.display="block",t.addEventListener("click",(t=>{t.preventDefault();const n=document.createElement("textarea");n.value=e.text;const i=document.createElement("button");i.textContent="Сохранить",i.addEventListener("click",(t=>{if(n.value.trim()===e.text||""===n.value.trim())return;const o={text:n.value.trim(),id:e.id};let s=0;_e({url:"/comments/update",body:o}).then((({status:e,response:t})=>new Promise(((n,r)=>{e===me.ok?n(t.data):(s=e,r(new Error(t.msg)))})))).then((e=>{r.innerHTML=wr({...e,author:pe.getState().authorization,datetime:we(Se(e.dateTime))}),r.removeChild(n),r.removeChild(i)})).catch((e=>{0!==s?Mn.netOrServerError(s,e.message):console.warn(e.message)}))})),r.appendChild(n),r.appendChild(i)}))}}))}}function Lr(e){e.querySelector(".article-view__send-comment-btn").addEventListener("click",(t=>{t.preventDefault(),function(e){if(!pe.getState().authorization.isAuthenticated)return void Mn.warn("Сначала авторизируйтесь","Чтобы оставить комментарий, выполните вход");const t=document.querySelector(".article-view__comment-input");if(""!=t.value.trim()){let n=0;_e({url:"/comments/create",body:{articleId:parseInt(pe.getState().reader.currentId,10),parentId:0,text:t.value.trim()}}).then((({status:e,response:t})=>new Promise(((r,i)=>{e===me.ok?r(t.data):(n=e,i(new Error(t.msg)))})))).then((t=>{const n=wr({...t,author:pe.getState().authorization,datetime:we(Se(t.dateTime))}),r=document.createElement("div");r.className="comments__comment",r.classList.add("comment"),r.innerHTML=n,e.appendChild(r)})).catch((e=>{0!==n?Mn.netOrServerError(n,e.message):console.warn(e.message)}))}}(e.querySelector("#comments"))})),e.querySelector(".comments-show").addEventListener("click",(e=>{e.preventDefault(),function(){let e=!0;const t=document.querySelector(".comments"),n=document.querySelector(".comments-show__text"),r=document.querySelector(".comments-show__btn");r.classList.contains("rotate-180")?(n.innerText="Показать комментарии",r.classList.remove("rotate-180"),e=!0):(n.innerText="Скрыть комментарии",r.classList.add("rotate-180"),e=!1),e?t.classList.add("hide"):t.classList.remove("hide")}()}));const t=e.querySelectorAll(".comments__comment");for(const e of t);}class Cr extends e{constructor(e){super(e),this.pageComponents={reader:new Er}}render(){super.render(),this.root.appendChild(Mt("",this.pageComponents.reader))}}const Ar=function(){return{type:L}},kr=function(){return{type:C}},xr=function(){return{type:S}},Tr=function(){return{type:E}},Or=function(e,t){return t.forEach((e=>{Le(e),Le(e.author)})),{type:b,payload:{idLastLoaded:e,cards:t}}},Nr=function(){return{type:w}},Rr=function(e){return{type:A,payload:e}},qr=function(){return{type:A,payload:""}};class Ir extends e{constructor(e){super(e),this.pageComponents={categoryChoose:new dr((()=>pe.getState().categoryPage.currentCategory),Rr,qr,A),feed:new Wt(Qt,"categoryPage",b,w,S,E,xr,(()=>(console.log("{CategoryPage feed} isEndFound is not been reset"),{type:"__EMPTY__"})))}}render(){super.render(),this.root.appendChild(Mt("Поиск по категориям",this.pageComponents.categoryChoose,this.pageComponents.feed))}}function Pr({currentTarget:e}){const t=pe.getState().categoryPage,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>xe()||(console.log("[Category Page] scroll trigger"),pe.dispatch(Dr))}async function Dr(){const e=pe.getState().categoryPage;e.isEndFound||e.isLoading?console.log("[Category Page] Can't load articles on as isEndFound state flag is true"):(pe.dispatch(Ar()),await fe({url:`/articles/category?idLastLoaded=${e.idLastLoaded}&category=${e.currentCategory}`}).then((({status:t,response:n})=>{if(t===me.ok)return r=n.data,console.log("[Category Page] more news loaded!"),void pe.dispatch(Or(r.length?r[r.length-1].id:e.idLastLoaded,r));var r;t/500==1&&_n.setTitle(`Сервис временно не доступен: ${t}`),t/400==1&&_n.setTitle(`Ошибка ${t}`),_n.setContent(n.msg),_n.open(!1)})).catch((e=>console.warn(e.message))),pe.dispatch(kr()))}class $r extends t{constructor(e){super(e),this.view=new Ir(e),pe.subscribe(A,(e=>{""!==e&&(pe.dispatch(Nr()),pe.dispatch(Tr()),Dr()),history.pushState(null,"","/categories"+(""!==e?"/"+e:"")),pe.dispatch(rt("categories",`SaberProject |\n              ${""!==e?e.charAt(0).toUpperCase()+e.slice(1):"Categories"}`))})),pe.subscribe(J,(()=>{pe.dispatch(Nr())}))}show(){super.show();const e=document.querySelector(".content");e?e.addEventListener("scroll",Pr):console.warn("[Category Page] нет дивака .content")}hide(){super.hide();const e=document.querySelector(".content");e?e.removeEventListener("scroll",Pr):console.warn("[Category Page] нет дивака .content")}isActive(){let e="";const t=document.URL.indexOf("categories/");if(-1!==t){try{e=decodeURI(document.URL.slice(t+11))}catch(e){console.error(e)}console.log("[CategoryPage] (isActive) category from Url:",e),pe.dispatch(Rr(e))}else-1!==document.URL.indexOf("categories")&&pe.dispatch(qr());return""===pe.getState().categoryPage.currentCategory&&pe.dispatch(xr()),super.isActive()}}class Mr extends e{constructor(e){super(e),this.formDiv=null,this.changeFormTypeBtn=null}render(){super.render();const e=document.createElement("div");e.className="background-space";const t=document.createElement("div");t.className="page-space";const n=document.createElement("div");n.className="content-space";const r=document.createElement("div"),i=document.createElement("a");i.innerHTML="SaberNews",i.className="header__title",i.href="/",i.style.cssText="position: absolute;";const o=document.createElement("a");o.textContent="Создать аккаунт",o.dataset.router="ignore",r.appendChild(new In(!1).render()),this.formDiv=r,this.changeFormTypeBtn=o,n.appendChild(r),n.appendChild(o),t.appendChild(i),t.appendChild(n),e.appendChild(t),this.root.appendChild(e)}switchFormType(e){this.formDiv&&this.changeFormTypeBtn?(this.formDiv.innerHTML="",this.formDiv.appendChild(new In(e).render()),this.changeFormTypeBtn.textContent=e?"У меня уже есть аккаунт":"Создать аккаунт"):console.warn("[SignupPage] was not rendered yet")}}function Ur(e,t){0!==t.length&&("login"in t[0]?t.forEach((t=>{Le(t);const n=document.createElement("div");n.innerHTML=En(t),e.appendChild(n.firstChild)})):Qt(e,t))}class Fr extends e{constructor(e){super(e),this.pageComponents={feed:new Wt(Ur,"search",k,x,T,O,Ie,Pe)}}render(){super.render(),this.root.appendChild(Mt("",this.pageComponents.feed))}}function Br({currentTarget:e}){const t=pe.getState().search,n=e.querySelector("#feed__loading");t.isLoading||t.isEndFound||n.getBoundingClientRect().y>xe()||(console.log("[Search Page] scroll trigger"),pe.dispatch(Hr))}async function Hr(){const e=pe.getState().search;e.isEndFound||e.isLoading?console.log("[Search Page] can't load news asisEndFound state flag is true"):(pe.dispatch(Re()),await fe({url:`/search/${e.group}?q=${e.value||""}&idLastLoaded=${e.idLastLoaded||""}`}).then((({status:e,response:t})=>{if(e===me.ok)return n=t.data,console.log("[Search Page] more news loaded!"),n.forEach((e=>{"login"in e&&(e.id=e.login)})),void pe.dispatch(Oe("",n));var n;e/500==1&&_n.setTitle(`Сервис временно не доступен: ${e}`),e/400==1&&_n.setTitle(`Ошибка ${e}`),_n.setContent(t.msg),_n.open(!1)})).catch((e=>console.warn(e.message))),pe.dispatch(qe()))}const Gr={};function Jr(e){const{target:t}=e;if("outer"!==t.dataset.router&&("ignore"===t.dataset.router&&(e.preventDefault(),console.log("[linkController]",{target:t},"ignored")),t instanceof HTMLAnchorElement)){e.preventDefault(),console.log({targeter:t.dataset.section});const n=Gr[t.dataset.section]?.props,r=Gr[t.dataset.section]?.action;"function"==typeof r&&r.call(null,n)}}class jr extends n{render(){const e=document.createElement("div");return e.style="\n    display: none;\n\n    position:fixed; \n    box-sizing: border-box;\n    border-radius: 5px;\n    padding: 5px;\n    top: 105px;\n    left: 20px;\n    background-color: #dee4ea;\n    color: red;\n    font-weight: bold;\n    ",e}}const Wr=new class extends r{constructor(){super(),this.view=new jr}render(){return super.render(),this.root=this.view.render(),this.root}setMessage(e){this.root.innerHTML=e}getMessage(){return this.root.innerHTML}show(e){this.root.style.display="block",e&&(this.root.innerHTML=e)}hide(){this.root.style.display="none"}};document.getElementById("warningroot").appendChild(Wr.render());const Vr={show(e){Wr.show(e)},hide(){Wr.hide()},setMessage(e){Wr.setMessage(e)},getMessage:()=>Wr.getMessage(),init(){pe.subscribe($,(()=>Vr.show("Сервис недоступен"))),pe.subscribe(M,(()=>{"Сервис недоступен"===Vr.getMessage()&&(Vr.setMessage(""),Vr.hide())}))}},zr=Vr,Yr=[],Zr={upload(e){Yr.push(...e);for(let t=0;t<e.length;t++){const n=new Image;n.onload=()=>{const e=Yr.indexOf(n);-1!==e&&Yr.splice(e,1)},Yr.push(n),n.src=e[t]}}};function Kr(){return _e({url:"/",body:{}}).then((({status:e,response:t})=>{e===me.ok&&pe.dispatch(tt(t.data)),pe.dispatch(bt())})).catch((e=>{console.warn("[AJAX]",e.message),pe.dispatch(wt()),pe.dispatch(((e,t)=>{setTimeout(Kr,3e4)}))}))}const Xr=function(e){return e.forEach((e=>{Le(e.author)})),{type:P,payload:e}},Qr=new WebSocket("ws://89.208.197.247:8081/api/v1/ws");Qr.onopen=function(e){console.log("webSocket: Соединение установлено")},Qr.onmessage=function(e){console.log(`webSocket: Данные получены с сервера: ${e.data}`);let t="";try{t=JSON.parse(e.data)}catch(e){return void console.warn(e.message)}(t.type="stream-comment")&&function(e){Le(e.author),pe.dispatch(Xr([e]))}(t)},Qr.onclose=function(e){e.wasClean?console.log(`webSocket: Соединение закрыто чисто,       код=${e.code} причина=${e.reason}`):console.warn("Соединение прервано")},Qr.onerror=function(e){console.warn(`webSocket: error: ${e.message}`)},Zr.upload(["static/img/background-space.png","static/img/background.png","static/img/icons/cross.svg","static/img/icons/eye-closed.svg","static/img/icons/eye-open.svg","static/img/icons/key.svg","static/img/icons/mail.svg","static/img/icons/username.svg","static/img/icons/like.svg","static/img/icons/like_hover.svg","static/img/icons/comment.svg","static/img/icons/comment_hover.svg","static/img/icons/share.svg","static/img/icons/share_hover.svg","static/img/icons/trash.svg","static/img/icons/trash_hover.svg","static/img/icons/search.svg","static/img/icons/search_hover.svg","static/img/icons/send.svg"]),navigator,console.warn("ServiceWorker is unable in navigator");const ei=document.getElementById("root"),ti=new class{constructor(e){this.routes={},this.routesPatterned=[],this.root=e}register(e,t){for(const n in this.routes)if(this.routes[n].PageClass===t)return console.warn(`[ROUTER] paths ${n} and ${e} point to the same ${t.name}`),this.routes[e]=this.routes[n],this;return this.routes[e]={PageClass:t,page:null,root:null},this}registerPattern(e,t){e=e.slice(0,e.indexOf("<")),this.routesPatterned.push(e);for(const n in this.routes)if(this.routes[n].PageClass===t)return console.warn(`[ROUTER] paths ${n} and ${e} point to the same ${t.name}`),this.routes[e]=this.routes[n],this;return this.routes[e]={PageClass:t,page:null,root:null},this}open(e){let t=e;this.routesPatterned.forEach((e=>{t.startsWith(e)&&(console.log(`[ROUTER] ${t} matched pattern ${e}`),t=e)}));const n=this.routes[t];if(!n)return console.warn("[ROUTER] путь",t,"не зарегистрирован"),void this.open("/");let{PageClass:r,page:i,root:o}=n;o||(o=document.createElement("section"),o.className="view",this.root.appendChild(o)),i||(i=new r(o),console.warn("[ROUTER] создал вьюху",i));const s=i.redirect(window.location.pathname);if(""!==s)return console.warn("[ROUTER]",i.constructor.name+" | redirectRoute: "+s),this.open(s),void(this.routes[t]={PageClass:r,page:i,root:o});window.location.pathname!==e&&window.history.pushState(null,"",e),console.log("[ROUTER] !page.isActive():",!i.isActive()),i.isActive()||(Object.values(this.routes).forEach((({page:e})=>{e&&e.isActive()&&e.hide()})),i.show()),this.routes[t].page=i,this.routes[t].root=o}start(){pe.subscribe(Q,(e=>{this.open(e)})),this.root.addEventListener("click",(e=>{const t=e.target;if(!(t instanceof HTMLAnchorElement||"ignore"===t.dataset.router)||"outer"===t.dataset.router)return;console.warn("[ROUTER]",{target:t}),e.preventDefault();const n=t.pathname||t.parentElement.pathname;console.warn("link:",n),console.log({pathname:n||"[ROUTER] empty path (ignored)"}),n&&this.open(n)})),window.addEventListener("popstate",(()=>{const e=window.location.pathname;this.open(e)}));const e=window.location.pathname;console.log("[ROUTER] start page:",e),this.open(e)}}(ei),ni=new class{constructor(e){this.root=e,this.enabled=!1}register(e,t=(()=>{}),n=null){return Gr[e]={action:t,props:n},this}enable(){this.enabled||(this.enabled=!0,this.root.addEventListener("click",Jr))}disable(){this.enabled&&(this.enabled=!1,this.root.removeEventListener("click",Jr))}}(ei),ri=new class{constructor(){this.progressValue=0,this.root=document.createElement("div"),this.root.className="background",this.root.innerHTML=function(e){var t="",n=e||{};return function(e){t=t+'<div class="loading-page"><div class="loading-page__title">Загрузка</div><progress class="progress__loading"'+function(e,t,n,r){if(!1===t||null==t||!t&&("class"===e||"style"===e))return"";if(!0===t)return" "+(r?e:e+'="'+e+'"');var i=typeof t;return"object"!==i&&"function"!==i||"function"!=typeof t.toJSON||(t=t.toJSON()),"string"==typeof t||(t=JSON.stringify(t),n||-1===t.indexOf('"'))?(n&&(t=function(e){var t=""+e,n=Qn.exec(t);if(!n)return e;var r,i,o,s="";for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:o="&quot;";break;case 38:o="&amp;";break;case 60:o="&lt;";break;case 62:o="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=o}return i!==r?s+t.substring(i,r):s}(t))," "+e+'="'+t+'"'):" "+e+"='"+t.replace(/'/g,"&#39;")+"'"}("value",`${e}`,!0,!1)+' max="100"></progress></div>'}.call(this,"progressValue"in n?n.progressValue:"undefined"!=typeof progressValue?progressValue:void 0),t}({progressValue:this.progressValue}),this.progressBar=this.root.querySelector("progress"),this.animationId=0}async start(){const e=document.getElementById("root");e.innerHTML="",e.appendChild(this.root);let t=performance.now(),n=400;const r=e=>{this.progressValue+=(e-t)*n/1e4,t=e,this.progressValue<75&&(n--,n<100&&(n=100),this.progressBar.value=this.progressValue,window.requestAnimationFrame(r))};this.animationId=window.requestAnimationFrame(r)}async end(){window.cancelAnimationFrame(this.animationId),await new Promise((e=>{let t=performance.now();const n=r=>{this.progressValue+=1e3*(r-t)/1e4,t=r,this.progressValue<100?(this.progressBar.value=this.progressValue,window.requestAnimationFrame(n)):e()};n(performance.now())})),document.getElementById("root").innerHTML=""}};zr.init(),ti.register("/",class extends t{constructor(e){super(e),this.view=new sn(e),pe.subscribe(J,(()=>{pe.dispatch(at())}))}show(){super.show(),pe.dispatch(rt("main","SaberProject")),0===pe.getState().mainPage.cards.length&&pe.dispatch(bn);const e=this.view.root.querySelector(".content");e?e.addEventListener("scroll",yn):console.warn("[Main Page] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",yn):console.warn("[MainPage] нет дивака .content")}}).register("/profile",Bn).registerPattern("/user/<login>",Bn).registerPattern("/article/<id>",class extends t{constructor(e){super(e),this.view=new Cr(e)}show(){super.show(),pe.dispatch(rt("reader","SaberProject | Article View"));const e=document.URL.slice(document.URL.indexOf("article/")+8);console.warn("[ArticleReaderPage] id from Url ",document.URL,e),pe.dispatch(Gt({id:e})),pe.dispatch(Ht(e));let t=0;fe({url:`/articles?id=${e}`}).then((({status:e,response:n})=>new Promise(((r,i)=>{e===me.ok?r(n.data):(t=e,i(new Error(n.msg)))})))).then((e=>{pe.dispatch(Bt(e)),pe.dispatch(Ht(e.id))})).then((()=>fe({url:`/comments?id=${e}`}))).then((({status:e,response:n})=>new Promise(((r,i)=>{e===me.ok?r(n.data):(t=e,i(new Error(`Комментарии загрузить не удалось\n            ${n.msg}`)))})))).then((t=>{t.forEach((e=>{Le(e.author),e.datetimeMS=Se(e.dateTime),delete e.dateTime,e.datetime=we(e.datetimeMS)})),t.filter((e=>0===e.parentId)).forEach((e=>{e.answers=t.filter((t=>t.parentId===e.id)).sort(((e,t)=>e.datetimeMS<t.datetimeMS?-1:1))})),pe.dispatch(Jt(e,t))})).catch((e=>{0!==t?$n(t,e.message):console.warn(e.message)}))}}).register("/profile/settings",class extends t{constructor(e){super(e),this.view=new Xn(e),pe.subscribe(a,(()=>{this.isActive()&&(console.log("[ProfileSettingsPage] Logout reaction"),Ae("/"))}))}show(){super.show();const e=this.view.root.querySelector("form");e.addEventListener("submit",(t=>{t.preventDefault();const n=e.querySelector('input[name="username"]')?.value.trim(),r=e.querySelector('input[name="surname"]')?.value.trim(),i=e.querySelector('textarea[name="description"]')?.value.trim(),o=e.querySelector('input[type="file"]')?.files[0];if(""!==n&&!Rn.firstName.test(n))return void this.view.pageComponents.settingsForm.appendWarning("Такое имя выбрать нельзя");if(""!==r&&!Rn.lastName.test(r))return void this.view.pageComponents.settingsForm.appendWarning("Такую фамилию выбрать нельзя");if(o&&!o.type.startsWith("image/"))return void Mn.warn("Ошибка","Выберите изображение");let s=0,a="";new Promise(((e,t)=>{o?e(o):t(new Error("Картинка не прекреплена"))})).then((()=>ye({url:"/img/upload",body:o}))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===me.ok?n(t.data.imgId):(s=e,r(new Error(t.msg)))})))).catch((e=>new Promise(((t,n)=>{0===s?t(""):n(e)})))).then((e=>(a=e,_e({url:"/user/profile/update",body:{firstName:n,lastName:r,avatarUrl:e,description:i}})))).then((({status:e,response:t})=>new Promise(((n,r)=>{e===me.ok?n(t.data):(s=e,r(new Error(t.msg)))})))).then((e=>{""!==a&&(e.avatarUrl=be+"/img/"+a),pe.dispatch(tt(e)),Mn.informativeMsg("Успех!","Профиль обновлен"),Ae("/profile")})).catch((({message:e})=>{if(s===me.invalidSession)return pe.dispatch(nt()),Mn.informativeMsg("Сессия устарела","Пройдите авторизацию"),void Ae("/login");console.warn(e),"5"!==(s+"")[0]?this.view.pageComponents.settingsForm.appendWarning(msg):Mn.netOrServerError(s,e)}))})),pe.dispatch(rt("profileSettings",`Settings | ${pe.getState().authorization.login}`))}redirect(e){return""!==pe.getState().authorization.login?"":"/login"}}).register("/editor",class extends t{constructor(e){super(e),this.view=new hr(e),pe.subscribe(a,(()=>{console.log("[ArticleEditorPage] Logout reaction"),this.isActive()&&Mn.warn("Вы неавторизованы","Чтобы продолжить редактирование, выполните повторный вход.\n            Текущее состояние сохранено. Не перезагружайте страницу.",(()=>Ae("/")))}))}show(){super.show(),pe.dispatch(rt("editor",`SaberProject | ${function(){const e=pe.getState().editor;return"string"==typeof e.currentId&&"0"!==e.currentId||"number"==typeof e.currentId&&0!==e.currentId}()?"Edit":"Create"} article`))}redirect(e){return pe.getState().authorization.isAuthenticated?"":"/login"}}).registerPattern("/categories/<сategory>",$r).register("/categories",$r).register("/login",class extends t{constructor(e){super(e),this.view=new Mr(e),this.showRegister=!1,this.unsubscribeLogin=()=>{}}show(){super.show(),this.showRegister=!1,this.unsubscribeLogin=pe.subscribe(s,(()=>{Ae("/")})),this.view.changeFormTypeBtn.addEventListener("click",(e=>{e.preventDefault(),this.showRegister=!this.showRegister,this.view.switchFormType(this.showRegister)})),pe.dispatch(rt("signup","SaberProjects | "+(this.showRegister?"Signup":"Login")))}hide(){super.hide(),this.unsubscribeLogin()}}).register("/search",class extends t{constructor(e){super(e),this.view=new Fr(e);const t=e=>{""!==e&&(pe.dispatch(Ne()),pe.dispatch(Pe()),Hr())};pe.subscribe(q,t),pe.subscribe(R,t)}show(){super.show(),pe.dispatch(rt("search","SaberProject | Search")),0===pe.getState().search.cards.length&&pe.dispatch(Hr);const e=this.view.root.querySelector(".content");e?e.addEventListener("scroll",Br):console.warn("[Search Page] нет дивака .content")}hide(){super.hide();const e=this.view.root.querySelector(".content");e?e.removeEventListener("scroll",Br):console.warn("[SearchPage] нет дивака .content")}isActive(){return super.isActive()}}),ni.register("signupModal",Dn.show,!0).register("loginModal",Dn.show,!1).register("logout",(()=>{pe.getState().authorization.isAuthenticated&&_e({url:"/user/logout",body:{}}).then((()=>pe.dispatch(nt())))})).register("back",(()=>window.history.back())),ri.start(),async function(){await Kr(),await ri.end(),ni.enable(),ti.start()}()})();